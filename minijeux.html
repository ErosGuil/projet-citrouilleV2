<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MINI-JEUX BONUS - PROJET CITROUILLE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a0a00 0%, #0a0a0a 100%);
            color: #0f0;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ff6600;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255, 102, 0, 0.5);
        }

            .header h1 {
                color: #ff6600;
                font-size: 32px;
                text-shadow: 0 0 20px #ff6600;
                margin-bottom: 10px;
            }

            .header p {
                color: #0f0;
                font-size: 14px;
            }

        .games-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(350px, 100%), 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .game-card {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            transition: all 0.3s;
            overflow: hidden;
            position: relative;
        }

            .game-card:hover {
                border-color: #ff6600;
                box-shadow: 0 0 30px rgba(255, 102, 0, 0.5);
                transform: translateY(-5px);
            }

            .game-card h2 {
                color: #ff6600;
                margin-bottom: 15px;
                font-size: 24px;
                text-align: center;
            }

        .game-area {
            margin: 20px 0;
            min-height: 300px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #ff6600;
            color: #000;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            margin-top: 10px;
        }

            button:hover {
                background: #ff8800;
                box-shadow: 0 0 20px rgba(255, 102, 0, 0.8);
            }

        /* Tir aux citrouilles */
        #shootingGame {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
            border: 2px solid #0f0;
            border-radius: 5px;
            overflow: hidden;
            cursor: crosshair;
        }

        .pumpkin-target {
            position: absolute;
            font-size: 40px;
            cursor: pointer;
            animation: float-pumpkin 3s ease-in-out infinite;
            user-select: none;
        }

        @keyframes float-pumpkin {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(10deg);
            }
        }

        .explosion {
            position: absolute;
            font-size: 60px;
            animation: explode 0.5s ease-out forwards;
            pointer-events: none;
        }

        @keyframes explode {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: scale(2) rotate(360deg);
                opacity: 0;
            }
        }

        .score-display {
            text-align: center;
            font-size: 24px;
            color: #ff6600;
            margin: 10px 0;
            font-weight: bold;
        }


        /* Typing Game */
        #typingGame {
            text-align: center;
        }

        .typing-target {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 24px;
            color: #ff6600;
            letter-spacing: 2px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #typingInput {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0f0;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            text-align: center;
            border-radius: 5px;
        }

            #typingInput:focus {
                outline: none;
                border-color: #ff6600;
                box-shadow: 0 0 20px rgba(255, 102, 0, 0.5);
            }

        .timer {
            font-size: 32px;
            color: #f00;
            margin: 10px 0;
            font-weight: bold;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-box {
            background: rgba(255, 102, 0, 0.2);
            border: 2px solid #ff6600;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-label {
            color: #0f0;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #ff6600;
            font-size: 20px;
            font-weight: bold;
        }

        .message {
            text-align: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }

            .message.success {
                background: rgba(0, 255, 0, 0.2);
                border: 2px solid #0f0;
                color: #0f0;
            }

            .message.error {
                background: rgba(255, 0, 0, 0.2);
                border: 2px solid #f00;
                color: #f00;
            }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        .shake {
            animation: shake 0.3s;
        }

        @keyframes fadeUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        .shooting-target {
            animation: pulse 0.5s infinite alternate;
        }

            .shooting-target.gold {
                filter: drop-shadow(0 0 10px #ffaa00);
            }

            .shooting-target.bad:hover {
                filter: brightness(1.5);
            }

        /* Media queries pour mobile */
        @media (max-width: 768px) {
            .games-container {
                grid-template-columns: 1fr;
            }

            .game-card {
                padding: 15px;
            }

                .game-card h2 {
                    font-size: 20px;
                }

            #shootingGame {
                height: 300px;
            }


            #diffImage1, #diffImage2 {
                max-width: 100% !important;
                height: 250px !important;
            }

            .stats {
                gap: 5px;
            }

            .stat-box {
                padding: 8px;
            }

            .stat-label {
                font-size: 10px;
            }

            .stat-value {
                font-size: 16px;
            }

            #mazeContainer {
                max-width: 100% !important;
                width: calc(100vw - 60px) !important;
                margin: 15px auto !important;
            }

            body {
                padding: 10px !important;
            }

        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéÉ ARCHIVES DU DOCTEUR HALLOWEEN üéÉ</h1>
        <p style="font-size: 16px; color: #ff6600; margin: 15px 0;">PROJET CITROUILLE - √âPREUVES NON RETENUES</p>
        
        <div style="max-width: 800px; margin: 20px auto; padding: 20px; background: rgba(0, 0, 0, 0.7); border: 2px solid #ff6600; border-radius: 10px; text-align: left; line-height: 1.6;">
            <p style="color: #0f0; margin-bottom: 15px; font-size: 14px;">
                <strong style="color: #ff6600;">üìÅ DOSSIER CLASS√â üìÅ</strong><br>
                <em style="color: #888;">Section : √âpreuves Abandonn√©es - Acc√®s Libre</em>
            </p>
            
            <p style="color: #0f0; font-size: 14px; margin-bottom: 12px;">
                Bienvenue dans les <strong style="color: #ff6600;">archives secr√®tes</strong> du Dr Halloween. Cette section contient les <strong style="color: #ff6600;">mini-jeux exp√©rimentaux</strong> qui ont √©t√© cr√©√©s lors de la conception de l'escape game principal.
            </p>
            
            <p style="color: #0f0; font-size: 14px; margin-bottom: 12px;">
                Pour diverses raisons (trop complexes, trop longs, ou simplement jug√©s <em style="color: #888;">"pas assez effrayants"</em> par le docteur), ces √©preuves n'ont <strong style="color: #ff6600;">pas √©t√© retenues</strong> pour l'exp√©rience finale et ont √©t√© <strong style="color: #ff6600;">mises de c√¥t√©</strong> dans cette base de donn√©es.
            </p>
            
            <p style="color: #0f0; font-size: 14px; margin-bottom: 12px;">
                Cependant, le Dr Halloween √©tait trop attach√© √† ses cr√©ations pour les supprimer d√©finitivement. Il les a donc <strong style="color: #ff6600;">archiv√©es ici</strong>, dans ce laboratoire virtuel, pour que ses assistants puissent s'y amuser pendant leurs pauses... <em style="color: #888;">ou pour tester leurs comp√©tences</em>.
            </p>
            
            <p style="color: #ff6600; font-size: 15px; margin-top: 20px; text-align: center; font-weight: bold; padding: 10px; background: rgba(255, 102, 0, 0.1); border-radius: 5px;">
                üéÆ PROFITEZ DE CES √âPREUVES BONUS ! üéÆ
            </p>
        </div>
    </div>

    <div class="games-container">
        <!-- Tir aux citrouilles -->
        <div class="game-card">
            <h2>üéØ TIR AUX CITROUILLES</h2>
            <div class="score-display">
                Score: <span id="shootScore">0</span> | Temps: <span id="shootTime">30</span>s
            </div>
            <div id="shootingGame"></div>
            <button onclick="startShooting()">D√âMARRER</button>
        </div>



        <!-- Typing Game -->
        <div class="game-card">
            <h2>‚å®Ô∏è TYPING GAME</h2>
            <div class="timer">Temps: <span id="typingTimer">60</span>s</div>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="typingScore">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Pr√©cision</div>
                    <div class="stat-value" id="typingAccuracy">100%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">WPM</div>
                    <div class="stat-value" id="typingWPM">0</div>
                </div>
            </div>
            <div id="typingGame">
                <div class="typing-target" id="typingTarget">Cliquez sur D√âMARRER</div>
                <input type="text" id="typingInput" placeholder="Tapez ici..." disabled>
                <div id="typingMessage"></div>
            </div>
            <button onclick="startTyping()">D√âMARRER</button>
        </div>
        <!-- Endless Runner -->
        <div class="game-card">
            <h2>üèÉ ENDLESS RUNNER MAUDIT</h2>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Distance</div>
                    <div class="stat-value" id="runnerDistance">0m</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Record</div>
                    <div class="stat-value" id="runnerBest">0m</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Vitesse</div>
                    <div class="stat-value" id="runnerSpeed">1x</div>
                </div>
            </div>
            <div id="runnerGame" style="position: relative; width: 100%; height: 350px; background: linear-gradient(to bottom, #1a0a2e 0%, #0f0520 50%, #16213e 100%); border: 2px solid #0f0; border-radius: 5px; overflow: hidden; cursor: pointer;">
                <div id="runnerGround" style="position: absolute; bottom: 0; width: 100%; height: 80px; background: #2d1810; border-top: 3px solid #ff6600;"></div>
                <div id="runnerPlayer" style="position: absolute; bottom: 80px; left: 50px; font-size: 40px; transition: bottom 0.1s;">
                    üéÉ
                </div>
                <div id="runnerStartText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ff6600; font-size: 24px; text-align: center; z-index: 100;">
                    Cliquez ou ESPACE pour sauter<br>
                    <span style="font-size: 16px; color: #0f0;">√âvitez les obstacles !</span>
                </div>
            </div>
            <button onclick="startRunner()" id="runnerStartBtn">D√âMARRER LA COURSE</button>
        </div>




        <!-- D√©tecteur d'Objets -->
        <div class="game-card">
            <h2>üì∑ D√âTECTEUR D'OBJETS MAUDIT</h2>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Trouv√©s</div>
                    <div class="stat-value" id="detectFound">0/5</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Confiance</div>
                    <div class="stat-value" id="detectConfidence">0%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Temps</div>
                    <div class="stat-value" id="detectTime">90s</div>
                </div>
            </div>

            <div style="text-align: center; color: #ff6600; margin: 15px 0; font-size: 16px; font-weight: bold; background: rgba(255, 102, 0, 0.1); padding: 10px; border-radius: 5px;" id="detectTarget">
                üéÉ Cliquez sur D√âMARRER pour commencer
            </div>

            <!-- Cam√©ra -->
            <div style="position: relative; max-width: 500px; margin: 20px auto;">
                <video id="detectVideo" autoplay playsinline style="width: 100%; border: 3px solid #0f0; border-radius: 10px; background: #000; display: none;"></video>
                <canvas id="detectCanvas" style="width: 100%; border: 3px solid #0f0; border-radius: 10px; background: #000;"></canvas>
                <div id="detectOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
            </div>

            <div id="detectMessage" style="text-align: center; min-height: 40px; font-weight: bold; margin: 15px 0; font-size: 14px;"></div>

            <div id="detectResults" style="background: rgba(0, 0, 0, 0.8); border: 2px solid #0f0; border-radius: 5px; padding: 15px; margin: 15px 0; max-height: 150px; overflow-y: auto;">
                <div style="color: #0f0; font-size: 14px; margin-bottom: 10px; text-align: center;">üîç D√âTECTIONS :</div>
                <div id="detectList" style="color: #ffaa00; font-size: 12px; font-family: monospace;"></div>
            </div>

            <button onclick="startDetection()" id="detectStartBtn">üì∑ D√âMARRER LA D√âTECTION</button>
        </div>

        <!-- PAC-CITROUILLE -->
        <div class="game-card">
            <h2>üéÉ PAC-CITROUILLE</h2>
            <div class="game-area">
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">SCORE</div>
                        <div class="stat-value" id="pacmanScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">VIES</div>
                        <div class="stat-value" id="pacmanLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">RESTANT</div>
                        <div class="stat-value" id="pacmanRemaining">0</div>
                    </div>
                </div>

                <canvas id="pacmanCanvas" style="
                    width: 100%; 
                    height: auto; 
                    border: 2px solid #0f0; 
                    border-radius: 5px; 
                    background: #000;
                    image-rendering: pixelated;
                    max-width: 100%;
                    display: block;
                    margin: 15px auto;
                    touch-action: none;
                "></canvas>

                <div class="score-display" id="pacmanStatus">
                    üéÉ Collectez tout !
                </div>

                <div id="pacmanMessage" class="message"></div>

                <!-- Contr√¥les tactiles -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 200px; margin: 15px auto; user-select: none;">
                    <div></div>
                    <button onclick="movePacman(3)" style="padding: 20px; font-size: 24px; touch-action: manipulation;">‚¨ÜÔ∏è</button>
                    <div></div>
                    <button onclick="movePacman(2)" style="padding: 20px; font-size: 24px; touch-action: manipulation;">‚¨ÖÔ∏è</button>
                    <button onclick="movePacman(1)" style="padding: 20px; font-size: 24px; touch-action: manipulation;">‚¨áÔ∏è</button>
                    <button onclick="movePacman(0)" style="padding: 20px; font-size: 24px; touch-action: manipulation;">‚û°Ô∏è</button>
                </div>

                <div style="text-align: center; margin: 10px 0; color: #888; font-size: 12px;">
                    ‚öôÔ∏è Pi√®ces = 10pts | üëª √Çmes = 20pts<br>
                    üí´ Power-up : mangez les esprits ! (200pts)
                </div>
            </div>
            <button id="pacmanStartBtn" onclick="startPacman()" style="touch-action: manipulation;">‚ñ∂Ô∏è D√âMARRER</button>
            <button onclick="resetPacmanGame(); document.getElementById('pacmanMessage').innerHTML = '';" style="touch-action: manipulation;">üîÑ RECOMMENCER</button>
        </div>
    </div>

    <script>
        // ==================== TIR AUX CITROUILLES ====================
        let shootingActive = false;
        let shootScore = 0;
        let shootTimeLeft = 30;
        let shootInterval;
        let targetInterval;
        let shootCombo = 0;
        let shootMaxCombo = 0;

        function startShooting() {
            if (shootingActive) return;

            shootingActive = true;
            shootScore = 0;
            shootTimeLeft = 30;
            shootCombo = 0;
            shootMaxCombo = 0;
            document.getElementById('shootScore').textContent = shootScore;
            document.getElementById('shootTime').textContent = shootTimeLeft;

            const game = document.getElementById('shootingGame');
            game.innerHTML = '';
            game.style.cursor = 'crosshair';

            shootInterval = setInterval(() => {
                shootTimeLeft--;
                document.getElementById('shootTime').textContent = shootTimeLeft;

                if (shootTimeLeft <= 0) {
                    endShooting();
                }
            }, 1000);

            // D√©marrer avec spawn toutes les 600ms
            targetInterval = setInterval(() => {
                spawnTarget();
                // Acc√©l√©rer progressivement
                if (shootTimeLeft < 20 && shootTimeLeft % 5 === 0) {
                    clearInterval(targetInterval);
                    const newSpeed = Math.max(300, 600 - (30 - shootTimeLeft) * 20);
                    targetInterval = setInterval(spawnTarget, newSpeed);
                }
            }, 600);
        }

        function spawnTarget() {
            if (!shootingActive) return;

            const game = document.getElementById('shootingGame');

            // Types de cibles avec probabilit√©s
            const random = Math.random();
            let targetType;

            if (random < 0.6) {
                // 60% - Citrouille normale (+1 point)
                targetType = { emoji: 'üéÉ', points: 1, class: 'good', duration: 1500 };
            } else if (random < 0.8) {
                // 20% - Citrouille dor√©e (+3 points, plus rapide)
                targetType = { emoji: 'üåü', points: 3, class: 'gold', duration: 1000 };
            } else if (random < 0.9) {
                // 10% - Fant√¥me (-2 points)
                targetType = { emoji: 'üëª', points: -2, class: 'bad', duration: 2000 };
            } else {
                // 10% - Cr√¢ne (-5 points)
                targetType = { emoji: 'üíÄ', points: -5, class: 'bad', duration: 2500 };
            }

            const target = document.createElement('div');
            target.className = 'shooting-target ' + targetType.class;
            target.textContent = targetType.emoji;
            target.style.position = 'absolute';
            target.style.left = Math.random() * (game.offsetWidth - 50) + 'px';
            target.style.top = Math.random() * (game.offsetHeight - 50) + 'px';
            target.style.fontSize = '40px';
            target.style.cursor = 'crosshair';
            target.style.transition = 'all 0.1s';
            target.style.userSelect = 'none';

            // Animation d'apparition
            target.style.transform = 'scale(0)';
            target.style.opacity = '0';

            target.onclick = (e) => {
                e.stopPropagation();
                if (!shootingActive) return;

                const points = targetType.points;
                shootScore += points;
                document.getElementById('shootScore').textContent = shootScore;

                // Gestion du combo
                if (points > 0) {
                    shootCombo++;
                    if (shootCombo > shootMaxCombo) {
                        shootMaxCombo = shootCombo;
                    }
                } else {
                    shootCombo = 0;
                }

                // Effet visuel selon le type
                const feedback = document.createElement('div');
                feedback.style.position = 'absolute';
                feedback.style.left = target.style.left;
                feedback.style.top = target.style.top;
                feedback.style.fontSize = '24px';
                feedback.style.fontWeight = 'bold';
                feedback.style.pointerEvents = 'none';
                feedback.style.zIndex = '1000';
                feedback.style.animation = 'fadeUp 1s forwards';

                if (points > 0) {
                    feedback.textContent = '+' + points;
                    feedback.style.color = points === 1 ? '#ff6600' : '#ffaa00';

                    const explosion = document.createElement('div');
                    explosion.textContent = 'üí•';
                    explosion.style.position = 'absolute';
                    explosion.style.left = target.style.left;
                    explosion.style.top = target.style.top;
                    explosion.style.fontSize = '50px';
                    explosion.style.pointerEvents = 'none';
                    game.appendChild(explosion);
                    setTimeout(() => explosion.remove(), 300);
                } else {
                    feedback.textContent = points;
                    feedback.style.color = '#f00';

                    // Flash rouge pour les mauvaises cibles
                    game.style.background = 'rgba(255, 0, 0, 0.3)';
                    setTimeout(() => {
                        game.style.background = '';
                    }, 100);
                }

                game.appendChild(feedback);
                setTimeout(() => feedback.remove(), 1000);

                target.remove();
            };

            game.appendChild(target);

            // Animation d'apparition
            setTimeout(() => {
                target.style.transform = 'scale(1)';
                target.style.opacity = '1';
            }, 10);

            // Retrait automatique
            setTimeout(() => {
                if (target.parentElement) {
                    target.style.transform = 'scale(0)';
                    target.style.opacity = '0';
                    setTimeout(() => target.remove(), 200);
                }
            }, targetType.duration);
        }

        function endShooting() {
            shootingActive = false;
            clearInterval(shootInterval);
            clearInterval(targetInterval);

            const game = document.getElementById('shootingGame');
            game.style.cursor = 'default';

            // Nettoyer toutes les cibles restantes
            const targets = game.querySelectorAll('.shooting-target');
            targets.forEach(t => t.remove());

            game.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; flex-direction: column; color: #ff6600;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üéØ</div>
                    <div style="font-size: 24px;">TERMIN√â !</div>
                    <div style="font-size: 32px; margin-top: 10px; color: ${shootScore >= 0 ? '#0f0' : '#f00'};">Score: ${shootScore}</div>
                    <div style="font-size: 18px; margin-top: 10px; color: #ffaa00;">Combo Max: ${shootMaxCombo}x</div>
                </div>`;
        }


        // ==================== TYPING GAME ====================
        const typingPhrases = [
            "FUYEZ DES CITROUILLES",
            "PROJET CITROUILLE ACTIF",
            "HALLOWEEN EST ARRIVE",
            "LES CITROUILLES ATTENDENT",
            "PROTOCOLE D EVACUATION",
            "LABORATOIRE COMPROMIS",
            "SYSTEME DE SECURITE",
            "TERMINAL DE CONTROLE",
            "CONFINEMENT ROMPU",
            "NIVEAU DE DANGER MAXIMUM"
        ];

        let typingActive = false;
        let typingTimeLeft = 60;
        let typingScore = 0;
        let typingCorrect = 0;
        let typingTotal = 0;
        let typingInterval;
        let typingStartTime;

        function startTyping() {
            if (typingActive) return;

            typingActive = true;
            typingTimeLeft = 60;
            typingScore = 0;
            typingCorrect = 0;
            typingTotal = 0;
            typingStartTime = Date.now();

            document.getElementById('typingInput').disabled = false;
            document.getElementById('typingInput').value = '';
            document.getElementById('typingInput').focus();
            document.getElementById('typingMessage').innerHTML = '';

            updateTypingStats();
            nextTypingPhrase();

            typingInterval = setInterval(() => {
                typingTimeLeft--;
                document.getElementById('typingTimer').textContent = typingTimeLeft;

                if (typingTimeLeft <= 0) {
                    endTyping();
                }
            }, 1000);
        }

        function nextTypingPhrase() {
            if (!typingActive) return;

            const phrase = typingPhrases[Math.floor(Math.random() * typingPhrases.length)];
            document.getElementById('typingTarget').textContent = phrase;
            document.getElementById('typingInput').value = '';
        }

        document.getElementById('typingInput').addEventListener('input', (e) => {
            if (!typingActive) return;

            const target = document.getElementById('typingTarget').textContent;
            const input = e.target.value.toUpperCase();

            if (input === target) {
                typingScore++;
                typingCorrect++;
                typingTotal++;

                const msg = document.getElementById('typingMessage');
                msg.innerHTML = '<div class="message success">‚úì CORRECT !</div>';
                setTimeout(() => msg.innerHTML = '', 500);

                nextTypingPhrase();
                updateTypingStats();
            } else if (input.length > target.length) {
                e.target.value = input.slice(0, target.length);
                typingTotal++;
                updateTypingStats();
            }
        });

        function updateTypingStats() {
            document.getElementById('typingScore').textContent = typingScore;

            const accuracy = typingTotal > 0 ? Math.round((typingCorrect / typingTotal) * 100) : 100;
            document.getElementById('typingAccuracy').textContent = accuracy + '%';

            const timeElapsed = (Date.now() - typingStartTime) / 1000 / 60;
            const wpm = timeElapsed > 0 ? Math.round(typingScore / timeElapsed) : 0;
            document.getElementById('typingWPM').textContent = wpm;
        }

        function endTyping() {
            typingActive = false;
            clearInterval(typingInterval);
            document.getElementById('typingInput').disabled = true;

            const msg = document.getElementById('typingMessage');
            msg.innerHTML = `<div class="message success">
                    üéâ TERMIN√â !<br>
                    Score: ${typingScore} phrases<br>
                    Pr√©cision: ${document.getElementById('typingAccuracy').textContent}<br>
                    Vitesse: ${document.getElementById('typingWPM').textContent} WPM
                </div>`;

            document.getElementById('typingTarget').textContent = 'Partie termin√©e !';
        }

        // ==================== ENDLESS RUNNER ====================
        let runnerActive = false;
        let runnerDistance = 0;
        let runnerBestDistance = 0;
        let runnerSpeed = 5;
        let runnerSpeedMultiplier = 1;
        let runnerPlayerBottom = 80;
        let runnerIsJumping = false;
        let runnerObstacles = [];
        let runnerGameLoop;
        let runnerObstacleInterval;
        let runnerMessageTimeout;

        const runnerObstacleTypes = ['ü™¶', '‚ö∞Ô∏è', 'üíÄ', 'üï∑Ô∏è', 'ü¶á', 'üëª'];
        const runnerJumpHeight = 200; // Augment√© de 150 √† 200
        const runnerGravity = 2; // R√©duit pour un saut plus doux

        function startRunner() {
            if (runnerActive) return;

            runnerActive = true;
            runnerDistance = 0;
            runnerSpeed = 5;
            runnerSpeedMultiplier = 1;
            runnerPlayerBottom = 80;
            runnerIsJumping = false;
            runnerObstacles = [];

            // Annuler tout timeout en attente
            if (runnerMessageTimeout) {
                clearTimeout(runnerMessageTimeout);
                runnerMessageTimeout = null;
            }

            // Nettoyer les anciens messages et obstacles
            const game = document.getElementById('runnerGame');
            const oldObstacles = game.querySelectorAll('.runner-obstacle');
            oldObstacles.forEach(obs => obs.remove());
            
            // Supprimer tous les messages de game over existants
            const oldMessages = game.querySelectorAll('.runner-gameover-message');
            oldMessages.forEach(msg => msg.remove());
            
            // Cacher le texte de d√©part et s'assurer qu'il reste cach√©
            const startText = document.getElementById('runnerStartText');
            if (startText) {
                startText.style.display = 'none';
            }
            
            // R√©initialiser l'affichage
            document.getElementById('runnerDistance').textContent = '0m';
            document.getElementById('runnerSpeed').textContent = '1.0x';
            document.getElementById('runnerStartBtn').disabled = true;

            // R√©initialiser la position du joueur
            const player = document.getElementById('runnerPlayer');
            player.style.bottom = '80px';

            // D√©marrer les boucles
            runnerGameLoop = setInterval(updateRunner, 20);
            runnerObstacleInterval = setInterval(spawnObstacle, 1500);
        }

        function updateRunner() {
            if (!runnerActive) return;

            // Augmenter la distance
            runnerDistance += runnerSpeed / 60;
            document.getElementById('runnerDistance').textContent = Math.floor(runnerDistance) + 'm';

            // Augmenter la vitesse progressivement
            if (Math.floor(runnerDistance) % 50 === 0 && runnerDistance > 0) {
                runnerSpeed += 0.5;
                runnerSpeedMultiplier = (runnerSpeed / 5).toFixed(1);
                document.getElementById('runnerSpeed').textContent = runnerSpeedMultiplier + 'x';
            }

            // D√©placer les obstacles
            const game = document.getElementById('runnerGame');
            const obstacles = game.querySelectorAll('.runner-obstacle');

            obstacles.forEach((obstacle, index) => {
                let left = parseInt(obstacle.style.left);
                left -= runnerSpeed;
                obstacle.style.left = left + 'px';

                // Supprimer si hors √©cran
                if (left < -50) {
                    obstacle.remove();
                    runnerObstacles.splice(index, 1);
                }

                // V√©rifier collision - CORRIG√â
                const playerLeft = 50;
                const playerRight = playerLeft + 40; // Largeur de la citrouille
                const playerBottom = runnerPlayerBottom; // Position bottom du joueur
                const playerTop = runnerPlayerBottom + 40; // Hauteur de la citrouille

                const obsLeft = left;
                const obsRight = left + 40; // Largeur de l'obstacle
                const obsBottom = parseInt(obstacle.style.bottom); // Position bottom de l'obstacle
                const obsTop = obsBottom + 40; // Hauteur de l'obstacle

                // Collision horizontale ET verticale
                const horizontalCollision = playerRight > obsLeft + 10 && playerLeft < obsRight - 10; // Marges de 10px
                const verticalCollision = playerTop > obsBottom + 5 && playerBottom < obsTop - 5; // Marges de 5px

                if (horizontalCollision && verticalCollision) {
                    gameOverRunner();
                }
            });
        }

        function spawnObstacle() {
            if (!runnerActive) return;

            const game = document.getElementById('runnerGame');
            const obstacle = document.createElement('div');
            obstacle.className = 'runner-obstacle';

            const type = runnerObstacleTypes[Math.floor(Math.random() * runnerObstacleTypes.length)];
            obstacle.textContent = type;
            obstacle.style.position = 'absolute';
            obstacle.style.fontSize = '40px';
            obstacle.style.left = game.offsetWidth + 'px';

            // Obstacles au sol ou en l'air
            if (Math.random() > 0.8 && ['ü¶á', 'üëª'].includes(type)) {
                // Obstacles volants - hauteur entre 120 et 180px
                obstacle.style.bottom = (120 + Math.random() * 60) + 'px';
            } else {
                // Obstacles au sol
                obstacle.style.bottom = '80px';
            }

            game.appendChild(obstacle);
            runnerObstacles.push(obstacle);
        }

        function runnerJump() {
            if (!runnerActive || runnerIsJumping) return;

            runnerIsJumping = true;
            const player = document.getElementById('runnerPlayer');
            let jumpVelocity = 30; // Augment√© de 20 √† 30 pour sauter plus haut

            const jumpInterval = setInterval(() => {
                runnerPlayerBottom += jumpVelocity;
                jumpVelocity -= 2; // Gravit√© r√©duite de 5 √† 2 pour un saut plus doux

                player.style.bottom = runnerPlayerBottom + 'px';

                // Atterrissage
                if (runnerPlayerBottom <= 80) {
                    runnerPlayerBottom = 80;
                    player.style.bottom = '80px';
                    runnerIsJumping = false;
                    clearInterval(jumpInterval);
                }
            }, 20);
        }

        function gameOverRunner() {
            runnerActive = false;
            clearInterval(runnerGameLoop);
            clearInterval(runnerObstacleInterval);

            // Mise √† jour du record
            if (Math.floor(runnerDistance) > runnerBestDistance) {
                runnerBestDistance = Math.floor(runnerDistance);
                document.getElementById('runnerBest').textContent = runnerBestDistance + 'm';
            }

            // Supprimer les anciens messages de game over s'il y en a
            const game = document.getElementById('runnerGame');
            const oldMessages = game.querySelectorAll('.runner-gameover-message');
            oldMessages.forEach(msg => msg.remove());

            // Message de fin
            const gameOverMsg = document.createElement('div');
            gameOverMsg.className = 'runner-gameover-message';
            gameOverMsg.style.position = 'absolute';
            gameOverMsg.style.top = '50%';
            gameOverMsg.style.left = '50%';
            gameOverMsg.style.transform = 'translate(-50%, -50%)';
            gameOverMsg.style.color = '#f00';
            gameOverMsg.style.fontSize = '32px';
            gameOverMsg.style.fontWeight = 'bold';
            gameOverMsg.style.textAlign = 'center';
            gameOverMsg.style.zIndex = '1000';
            gameOverMsg.style.background = 'rgba(0, 0, 0, 0.9)';
            gameOverMsg.style.padding = '30px';
            gameOverMsg.style.borderRadius = '10px';
            gameOverMsg.style.border = '3px solid #f00';
            gameOverMsg.innerHTML = `
                    üíÄ GAME OVER üíÄ<br>
                    <span style="font-size: 20px; color: #ff6600;">Distance: ${Math.floor(runnerDistance)}m</span><br>
                    <span style="font-size: 16px; color: #0f0;">Record: ${runnerBestDistance}m</span>
                `;
            game.appendChild(gameOverMsg);

            document.getElementById('runnerStartBtn').disabled = false;

            // Retirer le message apr√®s 3 secondes et r√©afficher le texte SEULEMENT si le jeu n'a pas √©t√© relanc√©
            runnerMessageTimeout = setTimeout(() => {
                gameOverMsg.remove();
                // Ne r√©afficher le texte que si le jeu n'est toujours pas actif
                if (!runnerActive) {
                    const startText = document.getElementById('runnerStartText');
                    if (startText) {
                        startText.style.display = 'block';
                    }
                }
            }, 3000);
        }

        // Contr√¥les du runner
        document.getElementById('runnerGame').addEventListener('click', runnerJump);

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && runnerActive) {
                e.preventDefault();
                runnerJump();
            }
        });



        // ==================== D√âTECTEUR D'OBJETS ====================
        let detectActive = false;
        let detectVideo, detectCanvas, detectCtx;
        let detectModel = null;
        let detectStream = null;
        let detectFound = 0;
        let detectTargetObjects = [];
        let detectFoundObjects = [];
        let detectTimeLeft = 90;
        let detectTimerInterval;
        let detectAnimationFrame;

        // Liste d'objets √† trouver (COCO dataset)
        const detectObjectPool = [
            { name: 'person', emoji: 'üßç', fr: 'Une personne' },
            { name: 'cell phone', emoji: 'üì±', fr: 'Un t√©l√©phone' },
            { name: 'book', emoji: 'üìñ', fr: 'Un livre' },
            { name: 'bottle', emoji: 'üçæ', fr: 'Une bouteille' },
            { name: 'cup', emoji: '‚òï', fr: 'Une tasse' },
            { name: 'keyboard', emoji: '‚å®Ô∏è', fr: 'Un clavier' },
            { name: 'mouse', emoji: 'üñ±Ô∏è', fr: 'Une souris' },
            { name: 'laptop', emoji: 'üíª', fr: 'Un ordinateur' },
            { name: 'chair', emoji: 'ü™ë', fr: 'Une chaise' },
            { name: 'clock', emoji: 'üïê', fr: 'Une horloge' },
            { name: 'scissors', emoji: '‚úÇÔ∏è', fr: 'Des ciseaux' },
            { name: 'teddy bear', emoji: 'üß∏', fr: 'Un ours en peluche' },
            { name: 'toothbrush', emoji: 'ü™•', fr: 'Une brosse √† dents' },
            { name: 'spoon', emoji: 'ü•Ñ', fr: 'Une cuill√®re' },
            { name: 'fork', emoji: 'üç¥', fr: 'Une fourchette' },
            { name: 'knife', emoji: 'üî™', fr: 'Un couteau' },
            { name: 'bowl', emoji: 'ü•£', fr: 'Un bol' },
            { name: 'banana', emoji: 'üçå', fr: 'Une banane' },
            { name: 'apple', emoji: 'üçé', fr: 'Une pomme' },
            { name: 'orange', emoji: 'üçä', fr: 'Une orange' }
        ];

        async function startDetection() {
            document.getElementById('detectStartBtn').disabled = true;
            document.getElementById('detectStartBtn').textContent = '‚è≥ Chargement du mod√®le IA...';
            document.getElementById('detectMessage').innerHTML = '<div style="color: #ffaa00;">ü§ñ Chargement de TensorFlow.js et COCO-SSD...</div>';

            try {
                // Charger TensorFlow.js et COCO-SSD
                if (!window.cocoSsd) {
                    // Charger les scripts si pas d√©j√† charg√©s
                    await loadScript('https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0');
                    await loadScript('https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3');
                }

                document.getElementById('detectMessage').innerHTML = '<div style="color: #ffaa00;">üì∑ Activation de la cam√©ra...</div>';

                // Initialiser les √©l√©ments
                detectVideo = document.getElementById('detectVideo');
                detectCanvas = document.getElementById('detectCanvas');
                detectCtx = detectCanvas.getContext('2d');

                // Demander acc√®s cam√©ra
                detectStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                detectVideo.srcObject = detectStream;

                await new Promise(resolve => {
                    detectVideo.onloadedmetadata = resolve;
                });

                // Ajuster taille canvas
                detectCanvas.width = detectVideo.videoWidth;
                detectCanvas.height = detectVideo.videoHeight;

                document.getElementById('detectMessage').innerHTML = '<div style="color: #ffaa00;">üß† Chargement du mod√®le de d√©tection...</div>';

                // Charger le mod√®le
                detectModel = await cocoSsd.load();

                // Initialiser le jeu
                detectActive = true;
                detectFound = 0;
                detectFoundObjects = [];
                detectTimeLeft = 90;

                // S√©lectionner 5 objets al√©atoires
                const shuffled = [...detectObjectPool].sort(() => Math.random() - 0.5);
                detectTargetObjects = shuffled.slice(0, 5);

                document.getElementById('detectFound').textContent = '0/5';
                document.getElementById('detectConfidence').textContent = '0%';
                document.getElementById('detectTime').textContent = detectTimeLeft + 's';

                updateTargetDisplay();

                document.getElementById('detectMessage').innerHTML = '<div style="color: #0f0;">‚úÖ Pr√™t ! Montrez les objets √† la cam√©ra</div>';
                document.getElementById('detectStartBtn').textContent = 'üõë ARR√äTER';
                document.getElementById('detectStartBtn').onclick = stopDetection;
                document.getElementById('detectStartBtn').disabled = false;

                // Timer
                clearInterval(detectTimerInterval);
                detectTimerInterval = setInterval(() => {
                    if (detectActive) {
                        detectTimeLeft--;
                        document.getElementById('detectTime').textContent = detectTimeLeft + 's';

                        if (detectTimeLeft <= 0) {
                            loseDetection();
                        } else if (detectTimeLeft <= 15) {
                            document.getElementById('detectTime').style.color = '#f00';
                        }
                    }
                }, 1000);

                // Lancer la d√©tection
                detectLoop();

            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('detectMessage').innerHTML = `
                        <div style="color: #f00;">
                            ‚ùå Erreur: ${error.message}<br>
                            <span style="font-size: 12px;">V√©rifiez que vous avez autoris√© l'acc√®s √† la cam√©ra</span>
                        </div>
                    `;
                document.getElementById('detectStartBtn').disabled = false;
                document.getElementById('detectStartBtn').textContent = 'üì∑ R√âESSAYER';
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        async function detectLoop() {
            if (!detectActive) return;

            // Dessiner la vid√©o sur le canvas
            detectCtx.drawImage(detectVideo, 0, 0, detectCanvas.width, detectCanvas.height);

            // D√©tecter les objets
            const predictions = await detectModel.detect(detectCanvas);

            // Traiter les pr√©dictions
            let maxConfidence = 0;
            predictions.forEach(prediction => {
                const [x, y, width, height] = prediction.bbox;
                const objectName = prediction.class;
                const confidence = prediction.score;

                maxConfidence = Math.max(maxConfidence, confidence);

                // V√©rifier si c'est un objet recherch√©
                const targetIndex = detectTargetObjects.findIndex(obj =>
                    obj.name === objectName && !detectFoundObjects.includes(obj.name)
                );

                if (targetIndex !== -1 && confidence > 0.6) {
                    // Objet trouv√© !
                    const target = detectTargetObjects[targetIndex];
                    detectFoundObjects.push(target.name);
                    detectFound++;

                    document.getElementById('detectFound').textContent = detectFound + '/5';

                    // Flash vert
                    detectCanvas.style.borderColor = '#0f0';
                    setTimeout(() => {
                        detectCanvas.style.borderColor = '#0f0';
                    }, 500);

                    // Message
                    document.getElementById('detectMessage').innerHTML = `
                            <div style="color: #0f0; font-size: 16px;">
                                ‚úÖ ${target.emoji} ${target.fr} trouv√© ! (${Math.floor(confidence * 100)}%)
                            </div>
                        `;

                    updateTargetDisplay();

                    // V√©rifier victoire
                    if (detectFound >= 5) {
                        setTimeout(winDetection, 1000);
                        return;
                    }
                }

                // Dessiner les bo√Ætes de d√©tection
                detectCtx.strokeStyle = targetIndex !== -1 && !detectFoundObjects.includes(objectName) ? '#0f0' : '#ff6600';
                detectCtx.lineWidth = 3;
                detectCtx.strokeRect(x, y, width, height);

                // Label
                detectCtx.fillStyle = detectCtx.strokeStyle;
                detectCtx.font = '16px Arial';
                detectCtx.fillText(
                    `${objectName} ${Math.floor(confidence * 100)}%`,
                    x, y > 20 ? y - 5 : y + height + 20
                );
            });

            document.getElementById('detectConfidence').textContent = Math.floor(maxConfidence * 100) + '%';

            // Liste des d√©tections
            updateDetectionList(predictions);

            detectAnimationFrame = requestAnimationFrame(detectLoop);
        }

        function updateTargetDisplay() {
            let html = '';
            detectTargetObjects.forEach(obj => {
                const found = detectFoundObjects.includes(obj.name);
                const style = found ?
                    'text-decoration: line-through; color: #666; opacity: 0.5;' :
                    'color: #ff6600; font-weight: bold;';
                html += `<div style="${style}">${found ? '‚úÖ' : 'üéØ'} ${obj.emoji} ${obj.fr}</div>`;
            });
            document.getElementById('detectTarget').innerHTML = html;
        }

        function updateDetectionList(predictions) {
            if (predictions.length === 0) {
                document.getElementById('detectList').textContent = '‚ö†Ô∏è Aucun objet d√©tect√©';
                return;
            }

            let html = '';
            predictions.forEach(pred => {
                html += `‚Ä¢ ${pred.class}: ${Math.floor(pred.score * 100)}%<br>`;
            });
            document.getElementById('detectList').innerHTML = html;
        }

        function stopDetection() {
            detectActive = false;
            clearInterval(detectTimerInterval);
            cancelAnimationFrame(detectAnimationFrame);

            if (detectStream) {
                detectStream.getTracks().forEach(track => track.stop());
            }

            detectCtx.clearRect(0, 0, detectCanvas.width, detectCanvas.height);

            document.getElementById('detectStartBtn').textContent = 'üì∑ D√âMARRER LA D√âTECTION';
            document.getElementById('detectStartBtn').onclick = startDetection;
            document.getElementById('detectMessage').innerHTML = '<div style="color: #666;">‚èπÔ∏è D√©tection arr√™t√©e</div>';
        }

        function winDetection() {
            detectActive = false;
            clearInterval(detectTimerInterval);

            const timeBonus = detectTimeLeft * 10;

            document.getElementById('detectMessage').innerHTML = `
                    <div style="color: #0f0; font-size: 18px;">
                        üéâ MISSION ACCOMPLIE !<br>
                        <span style="font-size: 14px;">Tous les objets trouv√©s ! Bonus: ${timeBonus}pts</span>
                    </div>
                `;

            setTimeout(stopDetection, 3000);
        }

        function loseDetection() {
            detectActive = false;
            clearInterval(detectTimerInterval);

            document.getElementById('detectMessage').innerHTML = `
                    <div style="color: #f00; font-size: 18px;">
                        ‚è∞ TEMPS √âCOUL√â !<br>
                        <span style="font-size: 14px;">Objets trouv√©s: ${detectFound}/5</span>
                    </div>
                `;

            setTimeout(stopDetection, 3000);
        }


        // ================ PAC-MAN GAME ================
        let pacmanCanvas, pacmanCtx;
        let pacmanGame = {
            running: false,
            score: 0,
            lives: 3,
            player: { x: 1, y: 1, dir: 0, nextDir: 0 },
            ghosts: [],
            dots: [],
            powerPellets: [],
            powerMode: false,
            powerTimer: 0,
            animFrame: 0,
            gameLoop: null
        };

        const CELL_SIZE = 22;
        const DIRECTIONS = [
            { x: 1, y: 0 },  // DROITE
            { x: 0, y: 1 },  // BAS
            { x: -1, y: 0 }, // GAUCHE
            { x: 0, y: -1 }  // HAUT
        ];

        // Labyrinthe agrandi (1 = mur, 0 = vide) - 16x13
        const MAZE = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,0,1,1,1,1,1,1,0,1,1,0,1],
            [1,0,1,1,0,0,0,0,0,0,0,0,1,1,0,1],
            [1,0,0,0,0,1,1,0,0,1,1,0,0,0,0,1],
            [1,0,1,1,0,1,1,0,0,1,1,0,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,0,1,1,0,1,1,0,1,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,0,1,1,0,0,1,1,0,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,0,1,1,1,1,1,1,0,1,1,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        function initPacman() {
            pacmanCanvas = document.getElementById('pacmanCanvas');
            if (!pacmanCanvas) return;
            
            pacmanCtx = pacmanCanvas.getContext('2d');
            pacmanCanvas.width = MAZE[0].length * CELL_SIZE;
            pacmanCanvas.height = MAZE.length * CELL_SIZE;

            // Emp√™cher le zoom sur mobile
            pacmanCanvas.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });
            
            document.addEventListener('keydown', handlePacmanKey);
            resetPacmanGame();
        }

        function resetPacmanGame() {
            if (pacmanGame.gameLoop) {
                clearInterval(pacmanGame.gameLoop);
                pacmanGame.gameLoop = null;
            }
            
            pacmanGame.running = false;
            pacmanGame.score = 0;
            pacmanGame.lives = 3;
            pacmanGame.player = { x: 1, y: 1, dir: 0, nextDir: 0, mouthOpen: true };
            pacmanGame.powerMode = false;
            pacmanGame.powerTimer = 0;
            pacmanGame.animFrame = 0;

            // R√©initialiser le texte du bouton
            document.getElementById('pacmanStartBtn').textContent = '‚ñ∂Ô∏è D√âMARRER';

            // Cr√©er les points et power pellets
            pacmanGame.dots = [];
            pacmanGame.powerPellets = [];
            
            for (let y = 0; y < MAZE.length; y++) {
                for (let x = 0; x < MAZE[0].length; x++) {
                    if (MAZE[y][x] === 0) {
                        // Power pellets aux 4 coins
                        if ((x === 1 && y === 1) || (x === 14 && y === 1) || 
                            (x === 1 && y === 11) || (x === 14 && y === 11)) {
                            pacmanGame.powerPellets.push({ x, y });
                        } else {
                            // Alterner entre pi√®ces et √¢mes
                            const type = Math.random() > 0.5 ? 'gear' : 'soul';
                            pacmanGame.dots.push({ x, y, type });
                        }
                    }
                }
            }

            // 3 fant√¥mes avec des ic√¥nes diff√©rentes
            pacmanGame.ghosts = [
                { x: 7, y: 6, dir: 0, color: '#ff0000', scared: false, name: 'üíÄ' },
                { x: 8, y: 6, dir: 2, color: '#ff69b4', scared: false, name: '‚ò†Ô∏è' },
                { x: 7, y: 7, dir: 1, color: '#00ffff', scared: false, name: 'üòà' }
            ];

            updatePacmanDisplay();
            drawPacman();
        }

        function startPacman() {
            if (pacmanGame.running) {
                stopPacman();
                return;
            }

            pacmanGame.running = true;
            document.getElementById('pacmanStartBtn').textContent = '‚è∏Ô∏è PAUSE';
            
            if (pacmanGame.gameLoop) clearInterval(pacmanGame.gameLoop);
            pacmanGame.gameLoop = setInterval(updatePacmanGame, 150);
        }

        function stopPacman() {
            pacmanGame.running = false;
            if (pacmanGame.gameLoop) {
                clearInterval(pacmanGame.gameLoop);
                pacmanGame.gameLoop = null;
            }
            document.getElementById('pacmanStartBtn').textContent = '‚ñ∂Ô∏è D√âMARRER';
        }

        function movePacman(direction) {
            if (!pacmanGame.running) return;
            pacmanGame.player.nextDir = direction;
        }

        function handlePacmanKey(e) {
            if (!pacmanGame.running) return;
            
            switch(e.key) {
                case 'ArrowRight': pacmanGame.player.nextDir = 0; break;
                case 'ArrowDown': pacmanGame.player.nextDir = 1; break;
                case 'ArrowLeft': pacmanGame.player.nextDir = 2; break;
                case 'ArrowUp': pacmanGame.player.nextDir = 3; break;
                case 'z': case 'Z': pacmanGame.player.nextDir = 3; break;
                case 's': case 'S': pacmanGame.player.nextDir = 1; break;
                case 'q': case 'Q': pacmanGame.player.nextDir = 2; break;
                case 'd': case 'D': pacmanGame.player.nextDir = 0; break;
            }
        }

        function updatePacmanGame() {
            if (!pacmanGame.running) return;

            pacmanGame.animFrame++;

            if (pacmanGame.powerMode) {
                pacmanGame.powerTimer--;
                if (pacmanGame.powerTimer <= 0) {
                    pacmanGame.powerMode = false;
                    pacmanGame.ghosts.forEach(g => g.scared = false);
                }
            }

            movePlayer();

            if (pacmanGame.animFrame % 2 === 0) {
                pacmanGame.ghosts.forEach(moveGhost);
            }

            checkCollisions();
            drawPacman();
            updatePacmanDisplay();

            if (pacmanGame.dots.length === 0 && pacmanGame.powerPellets.length === 0) {
                winPacman();
            }
        }

        function movePlayer() {
            const p = pacmanGame.player;
            
            const nextDir = DIRECTIONS[p.nextDir];
            const newX = p.x + nextDir.x;
            const newY = p.y + nextDir.y;
            
            if (canMove(newX, newY)) {
                p.dir = p.nextDir;
            }

            const dir = DIRECTIONS[p.dir];
            const moveX = p.x + dir.x;
            const moveY = p.y + dir.y;
            
            if (canMove(moveX, moveY)) {
                p.x = moveX;
                p.y = moveY;
            }

            if (pacmanGame.animFrame % 3 === 0) {
                p.mouthOpen = !p.mouthOpen;
            }
        }

        function moveGhost(ghost) {
            const possibleDirs = [];
            
            for (let i = 0; i < 4; i++) {
                const dir = DIRECTIONS[i];
                const newX = ghost.x + dir.x;
                const newY = ghost.y + dir.y;
                
                if (canMove(newX, newY) && i !== (ghost.dir + 2) % 4) {
                    possibleDirs.push(i);
                }
            }

            if (possibleDirs.length > 0) {
                if (ghost.scared) {
                    ghost.dir = possibleDirs[Math.floor(Math.random() * possibleDirs.length)];
                } else {
                    const p = pacmanGame.player;
                    let bestDir = ghost.dir;
                    let bestDist = Infinity;
                    
                    possibleDirs.forEach(d => {
                        const dir = DIRECTIONS[d];
                        const newX = ghost.x + dir.x;
                        const newY = ghost.y + dir.y;
                        const dist = Math.abs(newX - p.x) + Math.abs(newY - p.y);
                        
                        if (dist < bestDist) {
                            bestDist = dist;
                            bestDir = d;
                        }
                    });
                    
                    ghost.dir = bestDir;
                }
            }

            const dir = DIRECTIONS[ghost.dir];
            ghost.x += dir.x;
            ghost.y += dir.y;
        }

        function canMove(x, y) {
            if (y < 0 || y >= MAZE.length || x < 0 || x >= MAZE[0].length) {
                return false;
            }
            return MAZE[y][x] === 0;
        }

        function checkCollisions() {
            const p = pacmanGame.player;

            for (let i = pacmanGame.dots.length - 1; i >= 0; i--) {
                const dot = pacmanGame.dots[i];
                if (dot.x === p.x && dot.y === p.y) {
                    pacmanGame.dots.splice(i, 1);
                    pacmanGame.score += dot.type === 'gear' ? 10 : 20;
                }
            }

            for (let i = pacmanGame.powerPellets.length - 1; i >= 0; i--) {
                const pellet = pacmanGame.powerPellets[i];
                if (pellet.x === p.x && pellet.y === p.y) {
                    pacmanGame.powerPellets.splice(i, 1);
                    pacmanGame.score += 50;
                    pacmanGame.powerMode = true;
                    pacmanGame.powerTimer = 40;
                    pacmanGame.ghosts.forEach(g => g.scared = true);
                }
            }

            pacmanGame.ghosts.forEach((ghost) => {
                if (ghost.x === p.x && ghost.y === p.y) {
                    if (ghost.scared) {
                        pacmanGame.score += 200;
                        ghost.x = 7;
                        ghost.y = 6;
                        ghost.scared = false;
                    } else {
                        losePacmanLife();
                    }
                }
            });
        }

        function losePacmanLife() {
            pacmanGame.lives--;
            
            if (pacmanGame.lives <= 0) {
                gameOverPacman();
            } else {
                pacmanGame.player.x = 1;
                pacmanGame.player.y = 1;
                pacmanGame.player.dir = 0;
                pacmanGame.ghosts.forEach((g, i) => {
                    g.x = 7 + (i % 2);
                    g.y = 6 + Math.floor(i / 2);
                    g.scared = false;
                });
                pacmanGame.powerMode = false;
            }
        }

        function drawPacman() {
            const ctx = pacmanCtx;
            ctx.clearRect(0, 0, pacmanCanvas.width, pacmanCanvas.height);

            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, pacmanCanvas.width, pacmanCanvas.height);

            for (let y = 0; y < MAZE.length; y++) {
                for (let x = 0; x < MAZE[0].length; x++) {
                    if (MAZE[y][x] === 1) {
                        ctx.fillStyle = '#0f0';
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                        ctx.strokeStyle = '#000';
                        ctx.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    }
                }
            }

            pacmanGame.dots.forEach(dot => {
                ctx.font = '13px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(
                    dot.type === 'gear' ? '‚öôÔ∏è' : 'üëª',
                    dot.x * CELL_SIZE + CELL_SIZE / 2,
                    dot.y * CELL_SIZE + CELL_SIZE / 2
                );
            });

            pacmanGame.powerPellets.forEach(pellet => {
                ctx.font = '18px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const glow = Math.sin(pacmanGame.animFrame * 0.3) * 3;
                ctx.shadowColor = '#ff6600';
                ctx.shadowBlur = 10 + glow;
                ctx.fillText(
                    'üí´',
                    pellet.x * CELL_SIZE + CELL_SIZE / 2,
                    pellet.y * CELL_SIZE + CELL_SIZE / 2
                );
                ctx.shadowBlur = 0;
            });

            const p = pacmanGame.player;
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = '#ff6600';
            ctx.shadowBlur = 15;
            ctx.fillText(
                p.mouthOpen ? 'üéÉ' : 'üü†',
                p.x * CELL_SIZE + CELL_SIZE / 2,
                p.y * CELL_SIZE + CELL_SIZE / 2
            );
            ctx.shadowBlur = 0;

            pacmanGame.ghosts.forEach(ghost => {
                ctx.font = '19px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (ghost.scared) {
                    ctx.shadowColor = '#00ffff';
                    ctx.shadowBlur = 10;
                    ctx.fillText(
                        'üò±',
                        ghost.x * CELL_SIZE + CELL_SIZE / 2,
                        ghost.y * CELL_SIZE + CELL_SIZE / 2
                    );
                } else {
                    ctx.shadowColor = ghost.color;
                    ctx.shadowBlur = 10;
                    ctx.fillText(
                        ghost.name,
                        ghost.x * CELL_SIZE + CELL_SIZE / 2,
                        ghost.y * CELL_SIZE + CELL_SIZE / 2
                    );
                }
                ctx.shadowBlur = 0;
            });
        }

        function updatePacmanDisplay() {
            document.getElementById('pacmanScore').textContent = pacmanGame.score;
            document.getElementById('pacmanLives').textContent = '‚ù§Ô∏è'.repeat(pacmanGame.lives);
            
            const remaining = pacmanGame.dots.length + pacmanGame.powerPellets.length;
            document.getElementById('pacmanRemaining').textContent = remaining;

            if (pacmanGame.powerMode) {
                document.getElementById('pacmanStatus').innerHTML = 
                    `<span style="color: #00ffff;">‚ö° MODE POUVOIR ! (${Math.ceil(pacmanGame.powerTimer / 10)}s)</span>`;
            } else {
                document.getElementById('pacmanStatus').innerHTML = 
                    `<span style="color: #ff6600;">üéÉ Collectez tout !</span>`;
            }
        }

        function winPacman() {
            stopPacman();
            document.getElementById('pacmanMessage').innerHTML = `
                <div style="color: #0f0; font-size: 18px;">
                    üéâ VICTOIRE !<br>
                    <span style="font-size: 14px;">Score final: ${pacmanGame.score}</span>
                </div>
            `;
            
            setTimeout(() => {
                resetPacmanGame();
                document.getElementById('pacmanMessage').innerHTML = '';
            }, 3000);
        }

        function gameOverPacman() {
            stopPacman();
            document.getElementById('pacmanMessage').innerHTML = `
                <div style="color: #f00; font-size: 20px;">
                    üíÄ GAME OVER !<br>
                    <span style="font-size: 14px;">Score final: ${pacmanGame.score}</span>
                </div>
            `;
            
            setTimeout(() => {
                resetPacmanGame();
                document.getElementById('pacmanMessage').innerHTML = '';
                document.getElementById('pacmanStartBtn').textContent = '‚ñ∂Ô∏è D√âMARRER';
            }, 3000);
        }

        window.addEventListener('load', initPacman);


    </script>
</body>
</html>