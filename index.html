<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJET CITROUILLE - ACCÈS RESTREINT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            font-size: 20px;
            opacity: 0.3;
            animation: float 15s infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.3;
            }

            90% {
                opacity: 0.3;
            }

            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .blood-drip {
            position: fixed;
            top: 0;
            width: 2px;
            height: 0;
            background: linear-gradient(to bottom, transparent, #8B0000, #FF0000);
            animation: drip 3s ease-in infinite;
            pointer-events: none;
            z-index: 2;
        }

        @keyframes drip {
            0% {
                height: 0;
                top: 0;
            }

            50% {
                height: 100px;
            }

            100% {
                height: 100px;
                top: 100vh;
                opacity: 0;
            }
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a0a00 0%, #0a0a0a 100%);
            position: relative;
            z-index: 10;
        }

        .pumpkin-bg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 300px;
            opacity: 0.1;
            z-index: 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 0.1;
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                opacity: 0.2;
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        .login-box {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #ff6600;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(255, 102, 0, 0.5);
            z-index: 1;
            max-width: 500px;
            width: 90%;
        }

            .login-box h1 {
                color: #ff6600;
                text-align: center;
                margin-bottom: 10px;
                font-size: 28px;
                text-shadow: 0 0 20px #ff6600;
            }

            .login-box .subtitle {
                color: #f00;
                text-align: center;
                margin-bottom: 30px;
                font-size: 12px;
                letter-spacing: 2px;
            }

        .warning {
            background: rgba(255, 0, 0, 0.2);
            border-left: 4px solid #f00;
            padding: 15px;
            margin-bottom: 20px;
            color: #f00;
            font-size: 13px;
        }

        input[type="password"], input[type="text"] {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ff6600;
            color: #ff6600;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            text-align: center;
            letter-spacing: 5px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        input::placeholder {
            color: rgba(255, 102, 0, 0.4);
            letter-spacing: normal;
        }

        button {
            width: 100%;
            padding: 15px;
            background: #ff6600;
            color: #000;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }

            button:hover:not(:disabled) {
                background: #ff8800;
                box-shadow: 0 0 30px rgba(255, 102, 0, 0.8);
            }

            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

        .error-msg, .success-msg {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
        }

        .error-msg {
            color: #f00;
        }

        .success-msg {
            color: #0f0;
        }

        .activation-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #000;
            z-index: 1000;
            overflow: hidden;
        }

        .matrix-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .activation-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #0f0;
        }

        .pumpkin-flash {
            font-size: 200px;
            animation: flash 0.5s infinite;
            margin: 20px;
        }

        @keyframes flash {
            0%, 100% {
                opacity: 1;
                color: #ff6600;
            }

            50% {
                opacity: 0.3;
                color: #ff0000;
            }
        }

        .activation-text {
            font-size: 32px;
            margin: 20px;
            text-shadow: 0 0 10px #0f0;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% {
                opacity: 1;
            }

            25%, 75% {
                opacity: 0;
            }
        }

        .progress-bar {
            width: 80%;
            height: 30px;
            border: 2px solid #0f0;
            margin: 20px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f0, #ff6600);
            width: 0%;
            animation: progressAnim 3s forwards;
        }

        @keyframes progressAnim {
            to {
                width: 100%;
            }
        }

        .terminal-screen {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .terminal-header {
            background: linear-gradient(135deg, #1a0a00, #0a0a0a);
            border: 2px solid #ff6600;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 0 30px rgba(255, 102, 0, 0.3);
        }

            .terminal-header h1 {
                color: #ff6600;
                text-shadow: 0 0 10px #ff6600;
                margin-bottom: 5px;
            }

            .terminal-header .status {
                color: #0f0;
                font-size: 14px;
            }

        .progress-tracker {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #0f0;
            border-radius: 5px;
            flex-wrap: wrap;
        }

        .progress-step {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s;
            min-width: 100px;
            margin: 5px;
        }

            .progress-step.locked {
                opacity: 0.3;
                color: #666;
            }

            .progress-step.active {
                background: rgba(255, 102, 0, 0.3);
                border: 2px solid #ff6600;
                color: #ff6600;
            }

            .progress-step.completed {
                background: rgba(0, 255, 0, 0.2);
                border: 2px solid #0f0;
                color: #0f0;
            }

        .terminal-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .terminal-module {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            transition: all 0.3s;
            position: relative;
        }

            .terminal-module.locked {
                opacity: 0.4;
                pointer-events: none;
            }

                .terminal-module.locked::after {
                    content: '🔒';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 60px;
                    opacity: 0.5;
                }

            .terminal-module:hover:not(.locked) {
                border-color: #ff6600;
                box-shadow: 0 0 30px rgba(255, 102, 0, 0.4);
            }

        .module-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #0f0;
        }

        .module-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .module-title {
            color: #ff6600;
            font-size: 18px;
            font-weight: bold;
        }

        .module-content {
            color: #0f0;
        }

        .file-list {
            list-style: none;
        }

        .file-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 255, 0, 0.1);
            border-left: 3px solid #0f0;
            cursor: pointer;
            transition: all 0.3s;
        }

            .file-item:hover {
                background: rgba(255, 102, 0, 0.2);
                border-left-color: #ff6600;
                padding-left: 15px;
            }

        .audio-player {
            width: 100%;
            margin: 10px 0;
        }

        .lock-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .lock-wheel {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ff6600;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.3);
        }

        .wheel-numbers {
            width: 60px;
            height: 80px;
            overflow: hidden;
            position: relative;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .number {
            font-size: 36px;
            font-weight: bold;
            color: #0f0;
            text-align: center;
            line-height: 80px;
            width: 100%;
            opacity: 0.3;
            transition: all 0.3s;
        }

            .number.active {
                opacity: 1;
                color: #ff6600;
                text-shadow: 0 0 10px #ff6600;
                font-size: 42px;
            }

        .wheel-buttons {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
        }

        .wheel-btn {
            width: 60px;
            padding: 8px;
            background: #0f0;
            color: #000;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }

            .wheel-btn:hover {
                background: #ff6600;
                box-shadow: 0 0 15px rgba(255, 102, 0, 0.8);
            }

            .wheel-btn:active {
                transform: scale(0.95);
            }

        .simon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .simon-button {
            aspect-ratio: 1;
            background: rgba(0, 255, 0, 0.2);
            border: 3px solid #0f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

            .simon-button:hover {
                background: rgba(255, 102, 0, 0.3);
                border-color: #ff6600;
                transform: scale(1.05);
            }

        .simon-icon {
            font-size: 60px;
        }

        .simon-button.active {
            background: rgba(255, 255, 0, 0.5);
            border-color: #ff0;
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.8);
        }

        .simon-button.correct {
            background: rgba(0, 255, 0, 0.5);
            border-color: #0f0;
            animation: successPulse 0.5s;
        }

        .simon-button.wrong {
            background: rgba(255, 0, 0, 0.5);
            border-color: #f00;
            animation: shake 0.5s;
        }

        .puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin: 20px auto;
            max-width: 300px;
        }

        .puzzle-piece {
            aspect-ratio: 1;
            border: 2px solid #ff6600;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.8);
        }

            .puzzle-piece canvas {
                width: 100%;
                height: 100%;
                display: block;
            }

            .puzzle-piece.empty {
                background: rgba(0, 0, 0, 0.8);
                border: 2px dashed #666;
                cursor: default;
            }

            .puzzle-piece:hover:not(.empty) {
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(255, 102, 0, 0.8);
                border-color: #0f0;
            }

        .puzzle-piece-number {
            position: absolute;
            top: 2px;
            left: 2px;
            background: rgba(0, 0, 0, 0.9);
            color: #ff6600;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            display: none;
            border: 1px solid #ff6600;
            z-index: 10;
        }

        .puzzle-container.show-numbers .puzzle-piece-number {
            display: block;
        }

        /* Amélioration du bouton d'aide */
        button.help-btn {
            background: rgba(0, 255, 0, 0.2);
            color: #0f0;
            border: 2px solid #0f0;
        }

            button.help-btn:hover {
                background: rgba(0, 255, 0, 0.4);
            }

        .puzzle-piece:hover {
            background: rgba(255, 102, 0, 0.5);
            transform: scale(1.05);
        }

        .puzzle-piece.selected {
            background: rgba(0, 255, 0, 0.3);
            border-color: #0f0;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.8);
        }

        #mazeCanvas {
            image-rendering: pixelated;
        }

        .enigma-box {
            background: rgba(255, 102, 0, 0.1);
            border: 2px solid #ff6600;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

            .enigma-box h3 {
                color: #ff6600;
                margin-bottom: 15px;
            }

            .enigma-box p {
                color: #0f0;
                line-height: 1.6;
                margin: 10px 0;
            }

        .quiz-option {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }

            .quiz-option:hover {
                background: rgba(255, 102, 0, 0.2);
                border-color: #ff6600;
                transform: translateX(5px);
            }

            .quiz-option.correct {
                background: rgba(0, 255, 0, 0.3);
                border-color: #0f0;
                animation: successPulse 0.5s;
            }

            .quiz-option.wrong {
                background: rgba(255, 0, 0, 0.3);
                border-color: #f00;
                animation: shake 0.5s;
            }

        @keyframes successPulse {
            0%, 100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: #000;
            border: 3px solid #ff6600;
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(255, 102, 0, 0.5);
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f00;
            color: #fff;
            border: none;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 20px;
            border-radius: 50%;
        }

        .modal-content img {
            width: 100%;
            height: auto;
            border: 2px solid #0f0;
            margin: 10px 0;
        }

        .glitch {
            animation: glitch 0.3s infinite;
        }

        @keyframes glitch {
            0% {
                transform: translate(0);
            }

            20% {
                transform: translate(-2px, 2px);
            }

            40% {
                transform: translate(-2px, -2px);
            }

            60% {
                transform: translate(2px, 2px);
            }

            80% {
                transform: translate(2px, -2px);
            }

            100% {
                transform: translate(0);
            }
        }

        .jumpscare {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

            .jumpscare.active {
                display: flex;
                animation: flashScreen 0.1s 5;
            }

        @keyframes flashScreen {
            0%, 100% {
                background: #000;
            }

            50% {
                background: #f00;
            }
        }

        .jumpscare-img {
            font-size: 300px;
            animation: scream 0.5s;
        }

        .intro-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #1a0a00 0%, #0a0a0a 100%);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .intro-box {
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #ff6600;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(255, 102, 0, 0.5);
            max-width: 900px;
            width: 100%;
            animation: fadeIn 1s;
            margin: auto;
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .intro-box h1 {
            color: #0f0;
            font-size: 18px;
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 3px solid #0f0;
            border-radius: 5px;
            text-shadow: 0 0 10px #0f0;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            background: rgba(0, 255, 0, 0.05);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }

        .intro-message {
            color: #0f0;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .signature {
            color: #ff6600;
            font-size: 16px;
            text-align: right;
            margin: 15px 0;
            font-style: italic;
        }

        /* Responsive mobile */
        @media (max-width: 768px) {
            .intro-screen {
                padding: 10px;
            }

            .intro-box {
                padding: 20px;
                width: 95%;
            }

                .intro-box h1 {
                    font-size: 14px;
                    padding: 15px;
                    margin-bottom: 20px;
                    letter-spacing: 1px;
                }

                .intro-box h1 {
                    font-size: 14px;
                    padding: 15px;
                    margin-bottom: 20px;
                    letter-spacing: 1px;
                }

            .intro-message {
                font-size: 13px;
                line-height: 1.5;
                margin-bottom: 15px;
            }

                .intro-message p {
                    margin-bottom: 15px !important;
                }

            .signature {
                font-size: 14px;
                margin: 10px 0;
            }

            .warning-box {
                margin: 15px 0;
                padding: 15px;
                font-size: 16px;
            }

            .intro-box button {
                font-size: 14px !important;
                padding: 12px !important;
            }
        }

        /* NE PAS réutiliser @keyframes pulse ici */
        @keyframes warnPulse {
            0%, 100% {
                opacity: 0.1;
            }

            50% {
                opacity: 0.5;
                box-shadow: 0 0 20px rgba(255,0,0,0.35);
            }
        }

        .warning-box {
            background: rgba(255, 0, 0, 0.2);
            border: 3px solid #f00;
            padding: 20px;
            text-align: center;
            color: #f00;
            font-size: 20px;
            font-weight: bold;
            margin: 25px 0;
            border-radius: 5px;
            animation: warnPulse 2s infinite;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
            letter-spacing: 2px;
            width: 100%;
            box-sizing: border-box; /* évite le débordement avec la bordure */
        }

        .final-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

            .final-screen.active {
                display: flex;
            }

        .final-box {
            max-width: 700px;
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #0f0;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.8);
            animation: finalAppear 0.5s;
        }

        @keyframes finalAppear {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .final-box h1 {
            color: #0f0;
            text-align: center;
            font-size: 32px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #0f0;
        }

        .admin-btn {
            width: 100%;
            padding: 10px;
            background: rgba(102, 126, 234, 0.3);
            color: #fff;
            border: 2px solid #667eea;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

            .admin-btn:hover {
                background: #667eea;
                transform: translateX(5px);
            }

            .admin-btn:active {
                transform: scale(0.98);
            }

        #adminPanel::-webkit-scrollbar {
            width: 10px;
        }

        #adminPanel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        #adminPanel::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

            #adminPanel::-webkit-scrollbar-thumb:hover {
                background: #764ba2;
            }

        #adminFloatingBtn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .maze-btn {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.3), rgba(0, 255, 0, 0.1));
            color: #0f0;
            border: 2px solid #0f0;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

            .maze-btn:active {
                transform: scale(0.95);
                background: linear-gradient(135deg, rgba(0, 255, 0, 0.5), rgba(0, 255, 0, 0.3));
                box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
            }

            .maze-btn:hover:not(:active) {
                background: linear-gradient(135deg, rgba(0, 255, 0, 0.4), rgba(0, 255, 0, 0.2));
                border-color: #ff6600;
                color: #ff6600;
                box-shadow: 0 0 15px rgba(255, 102, 0, 0.4);
            }

            .maze-btn:disabled {
                opacity: 0.3;
                cursor: not-allowed;
                background: rgba(100, 100, 100, 0.2);
                border-color: #666;
                color: #666;
            }

        /* Animation quand on appuie sur un bouton */
        @keyframes buttonPress {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
            }
        }

        .maze-btn.pressed {
            animation: buttonPress 0.3s;
        }

        /* Style responsive pour petits écrans */
        @media (max-width: 768px) {
            .maze-btn {
                width: 70px !important;
                height: 70px !important;
                font-size: 28px;
            }

            #mazeCanvas {
                width: 100% !important;
                height: auto !important;
                max-width: 300px;
            }
        }

        /* Empêcher le scroll lors du swipe sur mobile */
        .terminal-module#mazeModule {
            touch-action: auto;
        }

        /* Maze Button Styles */
        .maze-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 102, 0, 0.3);
            color: #ff6600;
            border: 2px solid #ff6600;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .maze-btn:hover:not(:disabled) {
            background: rgba(255, 102, 0, 0.5);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.6);
        }

        .maze-btn:active:not(:disabled) {
            transform: scale(0.95);
            background: rgba(255, 102, 0, 0.7);
        }

        .maze-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .maze-btn.pressed {
            background: rgba(255, 102, 0, 0.8);
            transform: scale(0.9);
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.8);
        }

        @media (max-width: 600px) {
            .maze-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }


        /* Memory Game */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .memory-card {
            aspect-ratio: 1;
            background: rgba(255, 102, 0, 0.3);
            border: 2px solid #ff6600;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

            .memory-card:hover:not(.flipped):not(.matched) {
                background: rgba(255, 102, 0, 0.5);
                transform: scale(1.05);
            }

            .memory-card.flipped {
                background: rgba(0, 255, 0, 0.3);
                border-color: #0f0;
            }

            .memory-card.matched {
                background: rgba(0, 255, 0, 0.5);
                border-color: #0f0;
                opacity: 0.7;
            }

            .memory-card .back {
                display: block;
            }

            .memory-card .front {
                display: none;
            }

            .memory-card.flipped .back {
                display: none;
            }

            .memory-card.flipped .front {
                display: block;
            }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-box {
            background: rgba(255, 102, 0, 0.2);
            border: 2px solid #ff6600;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-label {
            color: #0f0;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #ff6600;
            font-size: 20px;
            font-weight: bold;
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        .shake {
            animation: shake 0.3s;
        }

        @keyframes scream {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Faux Crash Screen */
        .crash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 99999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .crash-screen.active {
            display: flex;
        }

        .crash-text {
            color: #f00;
            font-family: 'Courier New', monospace;
            font-size: clamp(16px, 4vw, 32px);
            text-align: center;
            letter-spacing: 2px;
            text-shadow: 0 0 20px #f00, 0 0 40px #f00;
            margin: 20px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .crash-glitch {
            animation: glitch 0.3s infinite;
        }

        @keyframes glitch {
            0%, 100% {
                transform: translate(0);
                text-shadow: 0 0 20px #f00, 0 0 40px #f00;
            }
            25% {
                transform: translate(-2px, 2px);
                text-shadow: 2px 0 #0ff, -2px 0 #f0f;
            }
            50% {
                transform: translate(2px, -2px);
                text-shadow: -2px 0 #0ff, 2px 0 #f0f;
            }
            75% {
                transform: translate(-2px, -2px);
                text-shadow: 2px 2px #0ff, -2px -2px #f0f;
            }
        }

        .crash-cursor {
            display: inline-block;
            width: 10px;
            height: 1em;
            background: #f00;
            margin-left: 5px;
            animation: blink 0.7s infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .crash-static {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255, 255, 255, 0.03) 2px,
                rgba(255, 255, 255, 0.03) 4px
            );
            pointer-events: none;
            opacity: 0.5;
            animation: static-noise 0.2s infinite;
        }

        @keyframes static-noise {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        .crash-error {
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 30px;
            opacity: 0.5;
            text-align: center;
        }

        /* === INDICATEUR REC === */
        .rec-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #f00;
            padding: 10px 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #f00;
            z-index: 9999;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            display: none; /* Caché par défaut jusqu'à startTests() */
            align-items: center;
            gap: 10px;
        }

        .rec-dot {
            width: 12px;
            height: 12px;
            background: #f00;
            border-radius: 50%;
            animation: rec-blink 1s infinite;
            box-shadow: 0 0 10px #f00;
        }

        @keyframes rec-blink {
            0%, 50% {
                opacity: 1;
            }
            51%, 100% {
                opacity: 0.3;
            }
        }

        /* === MESSAGES DU DR. HALLOWEEN === */
        .dr-message-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 700px;
            z-index: 9998;
            pointer-events: none;
        }

        .dr-message {
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #ff6600;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 10px;
            box-shadow: 0 0 30px rgba(255, 102, 0, 0.6);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .dr-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .dr-message.hide {
            opacity: 0;
            transform: translateY(20px);
        }

        .dr-message-header {
            color: #ff6600;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dr-typing-indicator {
            display: inline-flex;
            gap: 4px;
        }

        .dr-typing-dot {
            width: 6px;
            height: 6px;
            background: #ff6600;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .dr-typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dr-typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-5px);
            }
        }

        .dr-message-text {
            color: #0f0;
            font-size: 16px;
            line-height: 1.6;
            min-height: 20px;
        }

        .dr-message-text::after {
            content: '|';
            animation: cursor-blink 0.7s infinite;
            margin-left: 2px;
        }

        .dr-message-text.typing-done::after {
            content: '';
        }

        @keyframes cursor-blink {
            0%, 50% {
                opacity: 1;
            }
            51%, 100% {
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <!-- === INDICATEUR REC === -->
    <div class="rec-indicator" id="recIndicator">
        <div class="rec-dot"></div>
        <span>REC <span id="recTimer">00:00:00</span></span>
    </div>

    <!-- === MESSAGES DU DR. HALLOWEEN === -->
    <div class="dr-message-container" id="drMessageContainer"></div>

    <!-- 1. BOUTON FLOTTANT ADMIN (à ajouter après la balise <body>) -->
    <div id="adminFloatingBtn" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: 3px solid #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10001;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    transition: all 0.3s;
    font-size: 24px;
" onclick="toggleAdminPanel()">
        🔧
    </div>

    <!-- 2. PANNEAU ADMIN (à ajouter après le bouton) -->
    <div id="adminPanel" style="
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
    border: 3px solid #667eea;
    border-radius: 15px;
    padding: 30px;
    z-index: 10002;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="color: #667eea; margin: 0; font-size: 24px;">
                🔧 PANNEAU ADMINISTRATEUR
            </h2>
            <button onclick="closeAdminPanel()" style="
            background: #f00;
            color: #fff;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
        ">
                ×
            </button>
        </div>

        <!-- Authentification Admin -->
        <div id="adminAuth" style="text-align: center;">
            <p style="color: #fff; margin-bottom: 15px;">Entrez le code administrateur :</p>
            <input type="password" id="adminPassword" placeholder="Code Admin" style="
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #667eea;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 15px;
        " onkeypress="if(event.key === 'Enter') checkAdminPassword()">
            <button onclick="checkAdminPassword()" style="
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: #fff;
            border: none;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        ">
                DÉVERROUILLER
            </button>
            <div id="adminAuthError" style="color: #f00; margin-top: 10px;"></div>
        </div>

        <!-- Contrôles Admin (masqué par défaut) -->
        <div id="adminControls" style="display: none;">

            <!-- Section État du jeu -->
            <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #0f0; margin-bottom: 15px; font-size: 18px;">📊 ÉTAT DU JEU</h3>
                <div id="gameStatus" style="color: #fff; font-size: 14px; line-height: 1.8;"></div>
            </div>

            <!-- Section Contrôles rapides -->
            <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #ff6600; margin-bottom: 15px; font-size: 18px;">⚡ CONTRÔLES RAPIDES</h3>

                <button onclick="adminResetGame()" style="
                width: 100%;
                padding: 12px;
                background: #f00;
                color: #fff;
                border: none;
                font-weight: bold;
                cursor: pointer;
                border-radius: 5px;
                margin-bottom: 10px;
            ">
                    🔄 RÉINITIALISER TOUT LE JEU
                </button>

                <button onclick="adminUnlockAll()" style="
                width: 100%;
                padding: 12px;
                background: #0f0;
                color: #000;
                border: none;
                font-weight: bold;
                cursor: pointer;
                border-radius: 5px;
                margin-bottom: 10px;
            ">
                    🔓 DÉBLOQUER TOUTES LES ÉTAPES
                </button>

                <button onclick="adminSkipToFiles()" style="
                width: 100%;
                padding: 12px;
                background: #667eea;
                color: #fff;
                border: none;
                font-weight: bold;
                cursor: pointer;
                border-radius: 5px;
            ">
                    ⏭️ ALLER AUX DOSSIERS FINAUX
                </button>
            </div>

            <!-- Section Déblocage par étape -->
            <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #667eea; margin-bottom: 15px; font-size: 18px;">🎯 DÉBLOCAGE PAR ÉTAPE</h3>

                <div class="admin-step-control" style="margin-bottom: 10px;">
                    <button onclick="adminUnlockStep('quiz')" class="admin-btn">
                        🧩 Débloquer Énigmes
                    </button>
                </div>

                <div class="admin-step-control" style="margin-bottom: 10px;">
                    <button onclick="adminUnlockStep('hangman')" class="admin-btn">
                        🎃 Débloquer Pendu
                    </button>
                </div>
                <div class="admin-step-control" style="margin-bottom: 10px;">
                    <button onclick="adminUnlockStep('code')" class="admin-btn">
                        🔐 Débloquer Code Sécurité
                    </button>
                </div>

                <div class="admin-step-control" style="margin-bottom: 10px;">
                    <button onclick="adminUnlockStep('simon')" class="admin-btn">
                        🎮 Débloquer Simon Says
                    </button>
                </div>

                <div class="admin-step-control" style="margin-bottom: 10px;">
                    <button onclick="adminUnlockStep('puzzle')" class="admin-btn">
                        🧩 Débloquer Puzzle
                    </button>
                </div>

                <div class="admin-step-control" style="margin-bottom: 10px;">
                    <button onclick="adminUnlockStep('maze')" class="admin-btn">
                        🗺️ Débloquer Labyrinthe
                    </button>
                </div>

                <div class="admin-step-control" style="margin-bottom: 10px;">
                    <button onclick="adminUnlockStep('memory')" class="admin-btn">
                        🧠 Débloquer Memory
                    </button>
                </div>

                <div class="admin-step-control">
                    <button onclick="adminUnlockStep('files')" class="admin-btn">
                        📁 Débloquer Dossiers
                    </button>
                </div>
            </div>



            <!-- Section Difficulté du Pendu -->
            <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #ff6600; margin-bottom: 15px; font-size: 18px;">🎃 MODE PENDU</h3>
                <button onclick="adminToggleHangmanDifficulty()" id="hangmanDifficultyBtn" style="
                width: 100%;
                padding: 12px;
                background: #ff6600;
                color: #000;
                border: none;
                font-weight: bold;
                cursor: pointer;
                border-radius: 5px;
                font-size: 14px;
            ">
                    🔄 Mode: DIFFICILE → FACILE
                </button>
            </div>
            <!-- Section Codes et Réponses -->
            <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 10px;">
                <h3 style="color: #ff6600; margin-bottom: 15px; font-size: 18px;">🔑 CODES ET RÉPONSES</h3>
                <div style="color: #0f0; font-size: 13px; line-height: 2;">
                    <div>🔒 Cadenas: <span style="color: #ff6600; font-weight: bold;">3-7-8-8 (3 Rires à son anniversaire, 78 Chauves-souris, 8 Vehicules)</span></div>
                    <div>🧮 Code additif: <span style="color: #ff6600; font-weight: bold;">124</span></div>
                    <div>📝 Quiz N°1 citrouilles: <span style="color: #ff6600; font-weight: bold;">C) 96 citrouilles</span></div>
                    <div>📝 Quiz N°2 citrouilles: <span style="color: #ff6600; font-weight: bold;">C) 96 citrouilles</span></div>
                    <div>🔐 Code cadenas final: <span style="color: #ff6600; font-weight: bold;">?-?-?-?</span></div>
                </div>
            </div>

        </div>
    </div>

    <div class="particles" id="particles"></div>
    <div id="bloodDrips"></div>
    <div class="jumpscare" id="jumpscare">
        <div class="jumpscare-img">💀</div>
    </div>

    <div class="login-screen" id="loginScreen">
        <div class="pumpkin-bg">🎃</div>
        <div class="login-box">
            <h1>🎃 PROJET CITROUILLE 🎃</h1>
            <p class="subtitle">SYSTÈME DE SÉCURITÉ NIVEAU 5</p>

            <div class="warning">
                ⚠️ AVERTISSEMENT : Accès restreint au personnel autorisé uniquement. Toute tentative d'intrusion sera enregistrée et signalée.
            </div>

            <input type="password" id="passwordInput" placeholder="CODE D'ACCÈS" maxlength="8" autocomplete="off">
            <button onclick="checkPassword()">ACTIVER LE PROTOCOLE</button>

            <div class="error-msg" id="errorMsg"></div>
        </div>
    </div>

    <div class="intro-screen" id="introScreen">
        <div class="intro-box">
            <h1>PROTOCOLES DE SÉLECTION ACTIVÉS</h1>

            <div class="intro-message">
                <p style="margin-bottom: 20px;">
                    "Avant que mes assistants ne disparaissent un à un, je les testais.
                    Seuls les plus compétents pouvaient accéder à mon atelier secret
                    et découvrir la véritable nature de mon projet.
                </p>

                <p style="margin-bottom: 20px;">
                    Vous avez trouvé le code <span style="color: #ff6600; font-weight: bold;">CYLINDRE</span>.
                    Vous avez déchiffré mes messages.
                </p>

                <p style="margin-bottom: 20px;">
                    Maintenant, prouvez-moi que vous méritez d'accéder aux documents finaux.
                    Prouvez que vous auriez pu survivre à mes côtés... et que vous êtes dignes d'accéder à ma création final !"
                </p>
            </div>

            <div class="signature">
                - Le Mécanicien
            </div>

            <div class="warning-box">
                ⚠️ 8 TESTS À RÉUSSIR ⚠️
            </div>

            <button onclick="startTests()" style="font-size: 18px; padding: 15px;">
                COMMENCER LES TESTS
            </button>
        </div>
    </div>

    <div class="activation-screen" id="activationScreen">
        <canvas class="matrix-bg" id="matrixCanvas"></canvas>
        <div class="activation-content">
            <div class="pumpkin-flash">🎃</div>
            <div class="activation-text">PROTOCOLE ACTIVÉ</div>
            <div class="activation-text" style="font-size: 20px;">Initialisation du système...</div>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <div class="terminal-screen" id="terminalScreen">
        <div class="terminal-header">
            <h1>🎃 PROJET CITROUILLE - TERMINAL DE CONTRÔLE 🎃</h1>
            <p class="status">STATUS: ✓ SYSTÈME OPÉRATIONNEL | DATE: 31/10/2025 | NIVEAU D'ALERTE: ÉLEVÉ</p>
        </div>

        <div class="progress-tracker">
            <div class="progress-step active" id="step1">
                <div style="font-size: 30px;">🔊</div>
                <div>ÉTAPE 1</div>
                <div style="font-size: 12px;">Cadenas</div>
            </div>
            <div class="progress-step locked" id="step2">
                <div style="font-size: 30px;">🧩</div>
                <div>ÉTAPE 2</div>
                <div style="font-size: 12px;">Quiz</div>
            </div>
            <div class="progress-step locked" id="step3">
                <div style="font-size: 30px;">🎮</div>
                <div>ÉTAPE 3</div>
                <div style="font-size: 12px;">Mini-jeux</div>
            </div>
            <div class="progress-step locked" id="step4">
                <div style="font-size: 30px;">📁</div>
                <div>ÉTAPE 4</div>
                <div style="font-size: 12px;">Dossiers</div>
            </div>
        </div>

        <div class="terminal-content">
            <div class="terminal-module" id="audioModule">
                <div class="module-header">
                    <span class="module-icon">🔊</span>
                    <span class="module-title">ENREGISTREMENT VOCAL</span>
                </div>
                <div class="module-content">
                    <p style="color: #ff6600; margin-bottom: 10px;">⚠️ MESSAGE DU DR. HALLOWEEN</p>
                    <audio class="audio-player" controls id="mainAudio">
                        <source src="EnregistrementVocal.mp3" type="audio/mpeg">
                    </audio>
                    <p style="font-size: 12px; margin-top: 15px; color: #0f0; line-height: 1.6;">
                        📝 Instructions : Écoutez attentivement le message et comptez les éléments mentionnés dans l'ordre. <br>
                        ☸️ Des Indices peuvent être récupérer à la Roue des Gages, contre un sacrifice ...
                    <p style="font-size: 12px; margin-top: 10px; color: #f00;">
                        🎃 Enregistré le 31/10/2025 à 23:47
                    </p>
                </div>
            </div>

            <div class="terminal-module" id="lockModule">
                <div class="module-header">
                    <span class="module-icon">🔒</span>
                    <span class="module-title">CADENAS DE SÉCURITÉ</span>
                </div>
                <div class="module-content">
                    <p style="color: #ff6600; margin-bottom: 20px; text-align: center;">
                        Entrez le code à 4 chiffres pour débloquer l'étape suivante
                    </p>

                    <div class="lock-container">
                        <div class="lock-wheel" id="wheel0">
                            <div class="wheel-numbers">
                                <div class="number">9</div>
                                <div class="number active">0</div>
                                <div class="number">1</div>
                            </div>
                            <div class="wheel-buttons">
                                <button class="wheel-btn up" onclick="rotateWheel(0, 1)">▲</button>
                                <button class="wheel-btn down" onclick="rotateWheel(0, -1)">▼</button>
                            </div>
                        </div>

                        <div class="lock-wheel" id="wheel1">
                            <div class="wheel-numbers">
                                <div class="number">9</div>
                                <div class="number active">0</div>
                                <div class="number">1</div>
                            </div>
                            <div class="wheel-buttons">
                                <button class="wheel-btn up" onclick="rotateWheel(1, 1)">▲</button>
                                <button class="wheel-btn down" onclick="rotateWheel(1, -1)">▼</button>
                            </div>
                        </div>

                        <div class="lock-wheel" id="wheel2">
                            <div class="wheel-numbers">
                                <div class="number">9</div>
                                <div class="number active">0</div>
                                <div class="number">1</div>
                            </div>
                            <div class="wheel-buttons">
                                <button class="wheel-btn up" onclick="rotateWheel(2, 1)">▲</button>
                                <button class="wheel-btn down" onclick="rotateWheel(2, -1)">▼</button>
                            </div>
                        </div>

                        <div class="lock-wheel" id="wheel3">
                            <div class="wheel-numbers">
                                <div class="number">9</div>
                                <div class="number active">0</div>
                                <div class="number">1</div>
                            </div>
                            <div class="wheel-buttons">
                                <button class="wheel-btn up" onclick="rotateWheel(3, 1)">▲</button>
                                <button class="wheel-btn down" onclick="rotateWheel(3, -1)">▼</button>
                            </div>
                        </div>
                    </div>

                    <button onclick="checkLockCode()" style="margin-top: 30px; width: 100%;">
                        🔓 DÉVERROUILLER
                    </button>

                    <div id="lockResult" style="text-align: center; margin-top: 15px;"></div>

                    <p style="font-size: 12px; margin-top: 20px; color: #ff6600; text-align: center;">
                        💡 Indice : Comptez ce que le Dr. Halloween vous demande de compter dans l'audio
                    </p>
                </div>
            </div>

            <div class="terminal-module locked" id="quizModule">
                <div class="module-header">
                    <span class="module-icon">🎃</span>
                    <span class="module-title">ÉNIGMES DU LABORATOIRE</span>
                </div>
                <div class="module-content">
                    <div style="background: rgba(255, 102, 0, 0.1); border: 2px solid #ff6600; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: center;">
                        <p style="color: #ff6600; font-weight: bold; font-size: 16px;">
                            🧩 PROTOCOLE DE VALIDATION<br>
                            <span style="font-size: 14px; color: #0f0;">Résoudre les 2 énigmes pour débloquer le PENDU</span>
                        </p>
                        <div style="margin-top: 10px;">
                            <span style="color: #0f0; font-size: 18px;" id="quizProgress">0/2 ✓</span>
                        </div>
                    </div>

                    <!-- QUESTION 1 : Quiz -->
                    <div class="enigma-box" style="border: 2px solid #ff6600; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h3 style="color: #ff6600;">📊 Question 1 - Calcul :</h3>
                        <p style="color: #ff6600; font-size: 16px; margin: 20px 0;">
                        Le Docteur Halloween travaillait sur une création mystérieuse.<br>
                        Pour l’alimenter, il a produit 12 rangées de 10 batterie-citrouilles, chacune capable de stocker une énergie vitale inconnue.

                        Mais d’après son carnet, 3 par rangée ont été jugées défectueuses et mises hors service.

                        Combien de citrouilles encore actives alimentent la création ?
                        </p>

                        <div style="margin: 20px 0;">
                            <button onclick="checkQuizAnswer('A')" class="quiz-btn quiz1-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                A) 78 citrouilles
                            </button>
                            <button onclick="checkQuizAnswer('B')" class="quiz1-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                B) 84 citrouilles
                            </button>
                            <button onclick="checkQuizAnswer('C')" class="quiz1-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                C) 92 citrouilles
                            </button>
                            <button onclick="checkQuizAnswer('D')" class="quiz1-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                D) 100 citrouilles
                            </button>
                        </div>

                        <div id="quizResult" style="text-align: center; margin-top: 15px; font-size: 16px; font-weight: bold;"></div>
                    </div>

                    <!-- QUESTION 2 : Énigme -->
                    <div class="enigma-box" style="border: 2px solid #ff6600; padding: 15px; border-radius: 5px;">
                        <h3 style="color: #ff6600;">🧪 Question 2 - Énigme du Dr. Halloween :</h3>
                        <p style="color: #ff6600; font-size: 16px; margin: 20px 0;">
                            Jour 1 — Note du Docteur Halloween <br>
                            Activation réussie de 3 batteries-citrouilles.<br>
                            Elles tirent leur énergie de… ce qu’il reste de ceux qui n’ont pas supporté l’expérience.<br>
                            Chaque nuit, une fois chargée,<br>
                            chaque batterie en fait naître une nouvelle.<br>

                            Après 5 nuits de croissance contrôlée :<br>

                            Combien de batteries-citrouilles sont désormais actives ?<br>
                        </p>

                        <div style="margin: 20px 0;">
                            <button onclick="checkEnigmaAnswer('A')" class="quiz2-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                A) 15 citrouilles
                            </button>
                            <button onclick="checkEnigmaAnswer('B')" class="quiz2-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                B) 36 citrouilles
                            </button>
                            <button onclick="checkEnigmaAnswer('C')" class="quiz2-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                C) 48 citrouilles
                            </button>
                            <button onclick="checkEnigmaAnswer('D')" class="quiz2-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                D) 96 citrouilles
                            </button>
                            <button onclick="checkEnigmaAnswer('E')" class="quiz2-btn" style="width: 100%; margin: 5px 0; padding: 12px; background: rgba(255, 102, 0, 0.3); border: 2px solid #ff6600; color: #ff6600; cursor: pointer; border-radius: 5px; font-size: 16px;">
                                E) 128 citrouilles
                            </button>
                        </div>

                        <div id="enigmaResult" style="text-align: center; margin-top: 15px; font-size: 16px; font-weight: bold;"></div>
                    </div>
                </div>
            </div>

            <div class="terminal-module locked" id="hangmanModule">
                <div class="module-header">
                    <span class="module-icon">🎃</span>
                    <span class="module-title">PENDU DES ÉNIGMES - NIVEAU 5</span>
                </div>
                <div class="module-content">
                    <div class="enigma-box">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h3 style="color: #ff6600;">PROTOCOLE DE DÉVERROUILLAGE</h3>
                            <p style="color: #0f0; font-size: 14px; margin: 10px 0;">
                                ⚠️ 6 énigmes à résoudre pour débloquer l'étape suivante<br>
                            </p>
                            <div style="background: rgba(0, 255, 0, 0.1); border: 2px solid #0f0; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                <span style="color: #0f0; font-size: 16px; font-weight: bold;">Progression: </span>
                                <span id="hangmanProgress" style="color: #ff6600; font-size: 20px; font-weight: bold;">0/6</span>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <div style="flex: 1; background: rgba(255, 0, 0, 0.2); border: 2px solid #f00; padding: 10px; border-radius: 5px; text-align: center;">
                                <div style="color: #0f0; font-size: 12px;">Erreurs</div>
                                <div id="hangmanErrorsDisplay" style="color: #f00; font-size: 20px; font-weight: bold;">0/6</div>
                            </div>
                            <div style="flex: 1; background: rgba(102, 126, 234, 0.2); border: 2px solid #667eea; padding: 10px; border-radius: 5px; text-align: center;">
                                <div style="color: #0f0; font-size: 12px;">Mode</div>
                                <div id="hangmanModeDisplay" style="color: #667eea; font-size: 16px; font-weight: bold;">DIFFICILE</div>
                            </div>
                        </div>

                        <div id="hangmanDrawing" style="font-size: 100px; text-align: center; min-height: 120px; margin: 15px 0;">
                            🎃
                        </div>

                        <div id="hangmanWord" style="text-align: center; font-size: 24px; letter-spacing: 4px; margin: 15px 0; color: #ff6600; min-height: 40px; word-wrap: break-word;">
                            _ _ _ _ _
                        </div>

                        <div id="hangmanHint" style="text-align: center; color: #0f0; margin: 10px 0; font-size: 13px; min-height: 40px; line-height: 1.4; padding: 10px; background: rgba(0, 255, 0, 0.05); border-radius: 5px;">
                            💡 Cliquez sur COMMENCER pour débuter
                        </div>

                        <div id="hangmanKeyboard" style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; margin: 15px 0;">
                        </div>

                        <div id="hangmanMessage" style="text-align: center; margin: 15px 0; font-size: 16px; font-weight: bold; min-height: 25px;"></div>

                        <button onclick="startHangmanGame()" id="hangmanStartBtn" style="width: 100%; margin-top: 10px;">
                            🎮 COMMENCER LE PENDU
                        </button>
                    </div>
                </div>
            </div>

            <div class="terminal-module locked" id="codeModule">
                <div class="module-header">
                    <span class="module-icon">🔐</span>
                    <span class="module-title">CODE DE SÉCURITÉ</span>
                </div>
                <div class="module-content">
                    <div class="enigma-box">
                        <h3>Déchiffrez le code :</h3>
                        <p style="color: #ff6600; font-size: 18px; text-align: center; margin: 20px 0;">
                            C=3 | I=9 | T=20 | R=18 | O=15 | U=21 | L=12 | E=5
                        </p>
                        <p>Additionnez toutes les lettres du mot "CITROUILLE"</p>

                        <input type="text" id="codeInput" placeholder="Entrez le code" style="margin-top: 15px;">
                        <button onclick="checkCode()">VALIDER</button>
                        <div id="codeResult"></div>
                    </div>
                </div>
            </div>

            <div class="terminal-module locked" id="simonModule">
                <div class="module-header">
                    <span class="module-icon">🎮</span>
                    <span class="module-title">SÉQUENCE DE RECONNAISSANCE</span>
                </div>
                <div class="module-content">
                    <div class="enigma-box">
                        <h3>Simon Says - Version Halloween</h3>
                        <p>Mémorisez et répétez la séquence de symboles !</p>
                        <p style="color: #ff6600; margin: 10px 0;">Niveau: <span id="simonLevel">1</span></p>

                        <div class="simon-grid">
                            <div class="simon-button" data-icon="0" onclick="simonClick(0)">
                                <span class="simon-icon">🎃</span>
                            </div>
                            <div class="simon-button" data-icon="1" onclick="simonClick(1)">
                                <span class="simon-icon">👻</span>
                            </div>
                            <div class="simon-button" data-icon="2" onclick="simonClick(2)">
                                <span class="simon-icon">💀</span>
                            </div>
                            <div class="simon-button" data-icon="3" onclick="simonClick(3)">
                                <span class="simon-icon">🦇</span>
                            </div>
                        </div>

                        <button onclick="startSimon()" id="simonStartBtn" style="margin-top: 15px; width: 100%;">
                            DÉMARRER NIVEAU 1
                        </button>
                        <div id="simonResult" style="text-align: center; margin-top: 10px;"></div>
                    </div>
                </div>
            </div>

            <div class="terminal-module locked" id="puzzleModule">
                <div class="module-header">
                    <span class="module-icon">🧩</span>
                    <span class="module-title">RECONSTRUCTION D'IMAGE</span>
                </div>
                <div class="module-content">
                    <div class="enigma-box">
                        <h3>Puzzle du Laboratoire</h3>
                        <p>Reconstituez l'image du Projet Citrouille !</p>

                        <div class="puzzle-container" id="puzzleContainer">
                            <!-- Généré dynamiquement -->
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="shufflePuzzle()" style="flex: 1;">
                                🔀 MÉLANGER
                            </button>
                            <button onclick="togglePuzzleNumbers()" class="help-btn" style="flex: 1;">
                                🔢 AIDE
                            </button>
                        </div>

                        <div id="puzzleResult" style="text-align: center; margin-top: 10px;"></div>

                        <p style="font-size: 12px; margin-top: 15px; color: #ff6600; text-align: center;">
                            💡 Cliquez sur une pièce adjacente à la case vide
                        </p>
                    </div>
                </div>
            </div>

            <div class="terminal-module locked" id="mazeModule">
                <div class="module-header">
                    <span class="module-icon">🗺️</span>
                    <span class="module-title">LABYRINTHE DANS LE NOIR</span>
                </div>
                <div class="module-content">
                    <div class="enigma-box">
                        <h3>🔦 Trouvez la sortie dans l'obscurité</h3>
                        <p>Utilisez les flèches du clavier ou les boutons ci-dessous</p>
                        
                        <div class="stats">
                            <div class="stat-box">
                                <div class="stat-label">Vies</div>
                                <div class="stat-value" id="mazeHP" style="color: #f00;">❤️❤️❤️</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Sortie</div>
                                <div class="stat-value" id="mazeProgress">0%</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Temps</div>
                                <div class="stat-value" id="mazeTime">0s</div>
                            </div>
                        </div>

                        <div style="text-align: center; color: #0f0; margin: 15px 0; font-size: 14px;" id="mazeHint">
                            Utilisez les flèches du clavier ou les boutons ci-dessous
                        </div>

                        <div id="mazeContainer" style="position: relative; width: 100%; max-width: 500px; aspect-ratio: 1; margin: 20px auto; background: #000; border: 3px solid #0f0; border-radius: 5px; overflow: hidden;">
                            <canvas id="mazeCanvas" width="500" height="500" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                            <div id="mazeFlashlight" style="position: absolute; width: 30%; height: 30%; border-radius: 50%; pointer-events: none; background: radial-gradient(circle, rgba(255, 255, 200, 0.8) 0%, rgba(255, 255, 200, 0.4) 40%, transparent 70%); box-shadow: 0 0 60px rgba(255, 255, 200, 0.6); z-index: 10;"></div>
                        </div>

                        <!-- CONTRÔLES TACTILES -->
                        <div style="display: flex; flex-direction: column; align-items: center; margin: 20px 0; gap: 5px;">
                            <!-- Bouton Haut -->
                            <button onclick="moveMazePlayerButton('up')" class="maze-btn" id="mazeBtnUp">
                                ▲
                            </button>

                            <!-- Boutons Gauche, Centre, Droite -->
                            <div style="display: flex; gap: 5px;">
                                <button onclick="moveMazePlayerButton('left')" class="maze-btn" id="mazeBtnLeft">
                                    ◀
                                </button>

                                <div style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); border: 2px solid #666; border-radius: 5px; font-size: 20px;">
                                    🔦
                                </div>

                                <button onclick="moveMazePlayerButton('right')" class="maze-btn" id="mazeBtnRight">
                                    ▶
                                </button>
                            </div>

                            <!-- Bouton Bas -->
                            <button onclick="moveMazePlayerButton('down')" class="maze-btn" id="mazeBtnDown">
                                ▼
                            </button>
                        </div>

                        <div id="mazeMessage" style="text-align: center; min-height: 30px; font-weight: bold; margin: 10px 0;"></div>

                        <button onclick="startMaze()" style="width: 100%; margin-top: 10px;">NOUVELLE PARTIE</button>
                    </div>
                </div>
            </div>

            <!-- Module Memory Game -->
            <div class="terminal-module locked" id="memoryModule">
                <div class="module-header">
                    <span class="module-icon">🧠</span>
                    <span class="module-title">MEMORY HALLOWEEN</span>
                </div>

                <div class="module-content">
                    <div class="enigma-box">
                        <h3>Trouvez les paires</h3>
                        <p>🎃 Memoriser et assembler les symboles Halloween !</p>

                        <div class="challenge-description">
                            <p style="color: #ff6600; font-size: 14px;">⚠️ Attention : vous n'avez que 9 vies !</p>
                        </div>

                        <!-- Statistiques -->
                        <div class="stats">
                            <div class="stat-box">
                                <div class="stat-label">Coups</div>
                                <div class="stat-value" id="memoryMoves">0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Paires</div>
                                <div class="stat-value" id="memoryPairs">0/8</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Vies</div>
                                <div class="stat-value" id="memoryLives" style="color: #f00;">❤️❤️❤️❤️❤️❤️❤️❤️❤️</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Temps</div>
                                <div class="stat-value" id="memoryTime">0s</div>
                            </div>
                        </div>

                        <!-- Grille du jeu -->
                        <div class="memory-grid" id="memoryGrid"></div>

                        <!-- Bouton -->
                        <button class="game-button" onclick="startMemory()">NOUVELLE PARTIE</button>

                        <!-- Message de résultat -->
                        <div id="memoryResult" style="text-align: center; margin-top: 20px; font-weight: bold;"></div>
                    </div>
                </div>
            </div>

            <div class="terminal-module locked" id="filesModule">
                <div class="module-header">
                    <span class="module-icon">📁</span>
                    <span class="module-title">DOSSIERS CLASSIFIÉS</span>
                </div>
                <div class="module-content">
                    <ul class="file-list">
                        <li class="file-item" onclick="openFile('secret')">
                            🎃 PROJET_CITROUILLE_PLAN.img
                        </li>
                        <li class="file-item" onclick="openFile('specimen')">
                            🧪 DOSSIER_SPECIMEN_001.img
                        </li>
                        <li class="file-item" onclick="openFile('lab')">
                            🔬 LABORATOIRE_PHOTOS.img
                        </li>
                        <li class="file-item" onclick="openFile('warning')">
                            ⚠️🔦 AVERTISSEMENT_FINAL.img
                        </li>

                    </ul>
                </div>
            </div>

            <div class="terminal-module">
                <div class="module-header">
                    <span class="module-icon">📝</span>
                    <span class="module-title">NOTES DU LABORATOIRE</span>
                </div>
                <div class="module-content">
                    <p style="color: #ff6600;">JOURNAL DU DR. HALLOWEEN</p>
                    <p style="margin: 10px 0; line-height: 1.6;">
                        Jour 31 : L'expérience a dépassé toutes nos attentes...
                        ou nos pires cauchemars...<br>
                        Les citrouilles-batteries absorbent les âmes perdues et se greffent au métal.<br>
                        La structure gonfle, se courbe, se muscle.<br>
                        Chaque nuit, elle se soulève un peu plus du sol…
                        comme si elle testait sa capacité à bouger.

                        La machine n’a presque plus son ancienne forme.<br>
                        Elle répond désormais à des pulsations que je ne contrôle pas.<br>
                        Parfois… elle reprend sa forme d’origine. Elle se dissimule. Elle attend.<Br>

                        Vous qui lirez cette note…
                        faites attention.

                        Parce qu’elle est déjà parmi vous.<br>
                        <span class="glitch" style="color: #f00;">Bientôt, elle avancera seule.</span>
                    </p>
                    <p style="color: #f00; font-size: 12px;">
                        ⚠️ DERNIER CONTACT: 31/10/2025 - 23:59
                    </p>
                </div>
            </div>

            <div class="terminal-module" style="border-color: #ff6600; box-shadow: 0 0 20px rgba(255, 102, 0, 0.3);">
                <div class="module-header">
                    <span class="module-icon">🎮</span>
                    <span class="module-title">ZONE DE DÉTENTE</span>
                </div>
                <div class="module-content">
                    <p style="color: #ff6600; font-weight: bold; text-align: center; font-size: 18px; margin-bottom: 10px;">
                        🎃 MINI-JEUX BONUS 🎃
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; text-align: center;">
                        <div style="background: rgba(255, 102, 0, 0.2); padding: 10px; border: 1px solid #ff6600; border-radius: 5px;">
                            <div style="font-size: 24px;">🎯</div>
                            <div style="font-size: 12px; color: #0f0;">Tir aux citrouilles</div>
                        </div>
                        <div style="background: rgba(255, 102, 0, 0.2); padding: 10px; border: 1px solid #ff6600; border-radius: 5px;">
                            <div style="font-size: 24px;">🏃</div>
                            <div style="font-size: 12px; color: #0f0;">Runner</div>
                        </div>
                        <div style="background: rgba(255, 102, 0, 0.2); padding: 10px; border: 1px solid #ff6600; border-radius: 5px;">
                            <div style="font-size: 24px;">⌨️</div>
                            <div style="font-size: 12px; color: #0f0;">Typing</div>
                        </div>
                    </div>
                    <a href="minijeux.html" target="_blank" style="display: block; padding: 15px; background: #ff6600; color: #000; text-align: center; text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 15px; transition: all 0.3s; font-size: 16px;">
                        🎮 JOUER MAINTENANT
                    </a>
                </div>
            </div>

            <div class="terminal-module" style="border-color: #f00;">
                <div class="module-header">
                    <span class="module-icon">⚠️</span>
                    <span class="module-title" style="color: #f00;">ALERTE CRITIQUE</span>
                </div>
                <div class="module-content" style="color: #f00;">
                    <p class="glitch" style="font-weight: bold;">
                        🎃 CONFINEMENT COMPROMIS 🎃
                    </p>
                    <p style="line-height: 1.6; margin-top: 10px;">
                        PROTOCOLE D'ÉVACUATION ACTIVÉ<br>
                        TEMPS RESTANT: [INCONNU]<br>
                        NIVEAU DE DANGER: MAXIMUM<br>
                        <span style="color: #ff6600;">NE RESTEZ PAS SEUL DANS LE NOIR</span><br>
                        Le projet à pris vie !
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="imageModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">×</button>
            <h2 style="color: #ff6600; margin-bottom: 20px;" id="modalTitle"></h2>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>

        // ======================================
        // === SYSTÈME DE MESSAGES DR. HALLOWEEN ===
        // ======================================

        let recStartTime = Date.now();
        let recTimerInterval;
        let drMessageQueue = [];
        let isTypingMessage = false;
        let messageHistory = [];
        let drSystemInitialized = false;
        let stepTimers = {};
        let storyMessagesShown = [];

        const drMessages = {
            initial: [
                "Je vous observe depuis le début...",
                "Bienvenue dans mon laboratoire. Faites comme chez vous... pendant qu'il est encore temps.",
                "Cette session est maintenant sous surveillance active.",
            ],
            story: [
                "Vous savez... les précédents candidats pensaient aussi pouvoir réussir.",
                "13 avant vous ont tenté ces tests. Aucun n'a terminé... vivant.",
                "Chaque test révèle quelque chose sur vous. Je prends des notes détaillées.",
                "Vous approchez du point de non-retour. Êtes-vous certain de vouloir continuer ?",
                "Les dossiers que vous cherchez... ils contiennent ma plus grande création.",
                "Quelque chose a pris vie dans ce laboratoire. Quelque chose d'affamé.",
                "Le temps presse. Après minuit, les règles changent...",
            ],
            success: [
                "Impressionnant. Vous dépassez mes attentes.",
                "Excellent. Continuez sur cette voie.",
                "Bravo. Peu de candidats arrivent aussi loin.",
                "Vous auriez fait un excellent assistant...",
                "Fascinant. Absolument fascinant.",
                "Remarquable performance.",
                "Je note cette réussite dans votre dossier.",
            ],
            struggle: [
                "Des difficultés ? C'est... prévisible.",
                "Hmm, vous hésitez. La peur, peut-être ?",
                "Les autres aussi ont eu du mal à cette étape.",
                "Intéressant... Votre stress augmente.",
                "Je sens votre frustration d'ici.",
                "Encore une erreur... Instructif.",
                "Le temps presse. Concentrez-vous.",
            ],
            takingTooLong: [
                "Vous prenez beaucoup de temps sur cette étape...",
                "Toujours bloqué ? Intéressant.",
                "Le temps s'écoule. Tick tock...",
                "Vous semblez en difficulté. C'est normal.",
                "Cette étape pose problème ? Les autres aussi ont bloqué ici.",
                "Hmm... Vous réfléchissez trop peut-être.",
            ],
            pressure: [
                "Dépêchez-vous. Quelque chose se réveille.",
                "Vous sentez cette présence ? Elle vous observe aussi...",
                "Le laboratoire devient... agité. Continuez vite.",
                "Tick tock... Le compte à rebours a commencé.",
            ],
            final: [
                "Vous y êtes presque. Les dossiers révèlent TOUT.",
                "Presque là... Mais à quel prix ?",
                "La vérité est à portée de main. Êtes-vous prêt ?",
            ],
        };

        const storyTimeline = [
            { delay: 3000, category: 'initial', label: 'initial' },
            { delay: 60000, category: 'story', label: 'story1' },
            { delay: 150000, category: 'story', label: 'story2' },
            { delay: 240000, category: 'pressure', label: 'pressure1' },
            { delay: 360000, category: 'story', label: 'story3' },
            { delay: 480000, category: 'pressure', label: 'pressure2' },
        ];

        function startRecTimer() {
            recTimerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - recStartTime) / 1000);
                const hours = Math.floor(elapsed / 3600).toString().padStart(2, '0');
                const minutes = Math.floor((elapsed % 3600) / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                const timerEl = document.getElementById('recTimer');
                if (timerEl) {
                    timerEl.textContent = `${hours}:${minutes}:${seconds}`;
                }
            }, 1000);
        }

        function typeMessage(element, text, speed = 50) {
            return new Promise((resolve) => {
                let index = 0;
                element.textContent = '';
                element.classList.remove('typing-done');
                
                const typeInterval = setInterval(() => {
                    if (index < text.length) {
                        element.textContent += text[index];
                        index++;
                    } else {
                        element.classList.add('typing-done');
                        clearInterval(typeInterval);
                        resolve();
                    }
                }, speed);
            });
        }

        async function showDrMessage(text, category = 'general') {
            // Vérifier si le système est toujours actif
            if (!drSystemInitialized) {
                return;
            }
            
            if (isTypingMessage) {
                drMessageQueue.push({ text, category });
                return;
            }

            isTypingMessage = true;
            const container = document.getElementById('drMessageContainer');
            if (!container) {
                isTypingMessage = false;
                return;
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'dr-message';
            messageDiv.innerHTML = `
                <div class="dr-message-header">
                    🎃 Dr. Halloween
                    <div class="dr-typing-indicator">
                        <div class="dr-typing-dot"></div>
                        <div class="dr-typing-dot"></div>
                        <div class="dr-typing-dot"></div>
                    </div>
                </div>
                <div class="dr-message-text"></div>
            `;

            container.appendChild(messageDiv);
            setTimeout(() => messageDiv.classList.add('show'), 100);
            await new Promise(resolve => setTimeout(resolve, 1500));

            const typingIndicator = messageDiv.querySelector('.dr-typing-indicator');
            if (typingIndicator) typingIndicator.style.display = 'none';
            
            const textElement = messageDiv.querySelector('.dr-message-text');
            if (textElement) await typeMessage(textElement, text);

            messageHistory.push({ text, category, timestamp: Date.now() });

            setTimeout(() => {
                messageDiv.classList.add('hide');
                setTimeout(() => {
                    messageDiv.remove();
                    isTypingMessage = false;
                    
                    if (drMessageQueue.length > 0) {
                        const next = drMessageQueue.shift();
                        showDrMessage(next.text, next.category);
                    }
                }, 500);
            }, 8000);
        }

        function getRandomMessage(category) {
            const messages = drMessages[category] || drMessages.story;
            return messages[Math.floor(Math.random() * messages.length)];
        }

        function trackStepTime(stepId) {
            if (!stepTimers[stepId]) {
                stepTimers[stepId] = Date.now();
                
                setTimeout(() => {
                    if (stepTimers[stepId]) {
                        showDrMessage(getRandomMessage('takingTooLong'), 'takingTooLong');
                    }
                }, 45000);
                
                setTimeout(() => {
                    if (stepTimers[stepId]) {
                        showDrMessage(getRandomMessage('takingTooLong'), 'takingTooLong');
                    }
                }, 90000);
            }
        }

        function completeStep(stepId) {
            if (stepTimers[stepId]) {
                delete stepTimers[stepId];
            }
        }

        function initDrMessageSystem() {
            if (drSystemInitialized) return;
            drSystemInitialized = true;
            console.log('🎃 Système de messages Dr. Halloween initialisé !');

            storyTimeline.forEach(({ delay, category, label }) => {
                setTimeout(() => {
                    if (!storyMessagesShown.includes(label)) {
                        showDrMessage(getRandomMessage(category), category);
                        storyMessagesShown.push(label);
                    }
                }, delay);
            });
        }

        // Fonction pour arrêter le système de messages Dr Halloween
        function stopDrMessageSystem() {
            drSystemInitialized = false;
            drMessageQueue = [];
            isTypingMessage = false;
            console.log('🎃 Système de messages Dr. Halloween arrêté !');
        }

        // NOUVELLE MÉTHODE : Intercepter showNotification directement
        function setupNotificationInterceptor() {
            // Sauvegarder la fonction originale
            const originalShowNotification = window.showNotification;
            
            if (originalShowNotification) {
                // Remplacer par notre version
                window.showNotification = function(message, color) {
                    // Appeler la fonction originale
                    originalShowNotification(message, color);
                    
                    if (!drSystemInitialized) return;
                    
                    console.log('🎃 Notification détectée:', message, color);
                    
                    // Détection des succès (couleur verte #0f0)
                    if (color === '#0f0' || message.includes('✓') || message.includes('✅')) {
                        if (Math.random() < 0.85) {
                            setTimeout(() => {
                                console.log('🎃 Déclenchement message de succès');
                                showDrMessage(getRandomMessage('success'), 'success');
                            }, 1500);
                        }
                    }
                    
                    // Détection des échecs (couleur rouge #f00)
                    if (color === '#f00' || message.includes('✗') || message.includes('❌')) {
                        if (Math.random() < 0.80) {
                            setTimeout(() => {
                                console.log('🎃 Déclenchement message d\'échec');
                                showDrMessage(getRandomMessage('struggle'), 'struggle');
                            }, 1500);
                        }
                    }
                };
                console.log('🎃 Interception de showNotification activée !');
            }
        }

        function monitorSteps() {
            setInterval(() => {
                const modules = document.querySelectorAll('.module:not(.locked)');
                modules.forEach(module => {
                    if (module.offsetParent !== null) {
                        const moduleId = module.id;
                        trackStepTime(moduleId);
                    }
                });
            }, 5000);
        }

        function initializeSystem() {
            startRecTimer();
            
            function tryInitMessages() {
                const loginScreen = document.querySelector('.login-screen');
                const gameContainer = document.querySelector('.game-container');
                
                if ((loginScreen && loginScreen.style.display === 'none') || 
                    (gameContainer && gameContainer.style.display !== 'none')) {
                    console.log('🎃 Jeu détecté, initialisation des messages...');
                    initDrMessageSystem();
                    setupNotificationInterceptor();
                    monitorSteps();
                    return true;
                }
                return false;
            }
            
            if (!tryInitMessages()) {
                const checkInterval = setInterval(() => {
                    if (tryInitMessages()) {
                        clearInterval(checkInterval);
                    }
                }, 1000);
                
                setTimeout(() => {
                    if (!drSystemInitialized) {
                        console.log('🎃 Initialisation forcée des messages...');
                        initDrMessageSystem();
                        setupNotificationInterceptor();
                        monitorSteps();
                    }
                    clearInterval(checkInterval);
                }, 10000);
            }
        }

        //         if (document.readyState === 'loading') {
        //             document.addEventListener('DOMContentLoaded', initializeSystem);
        //         } else {
        //             initializeSystem();
        //         }

        const PASSWORD = "CYLINDRE";
        let quizAnswered = false;
        let enigmaAnswered = false;
        window.attemptCount = 0;
        window.filesOpened = new Set();
        window.errorCount = 0;

        let wheelValues = [0, 0, 0, 0];
        const CORRECT_CODE = [3, 7, 8, 8];

        let simonSequence = [];
        let simonPlayerSequence = [];
        let simonRound = 0;
        const simonIcons = ['🎃', '👻', '💀', '🦇'];

        let puzzlePieces = [];
        let puzzleSolved = false;
        let showNumbers = false;
        let masterCanvas = null;


        function triggerJumpscare() {
            const jumpscare = document.getElementById('jumpscare');
            const img = jumpscare.querySelector('.jumpscare-img');

            const scares = [
                { emoji: '💀', duration: 800 },
                { emoji: '👻', duration: 1000 },
                { emoji: '🎃', duration: 1200 },
                { emoji: '🔪', duration: 1500 },
                { emoji: '😱', duration: 2000 },
                { emoji: '🧟', duration: 900 },
                { emoji: '☠️', duration: 1100 },
                { emoji: '👹', duration: 1300 }
            ];

            // Sélection aléatoire d'un jumpscare
            const randomScare = scares[Math.floor(Math.random() * scares.length)];

            img.textContent = randomScare.emoji;
            img.style.fontSize = (200 + Math.random() * 100) + 'px';

            jumpscare.classList.add('active');
            jumpscare.style.animationDuration = '0.05s';
            jumpscare.style.animationIterationCount = Math.floor(5 + Math.random() * 10);

            setTimeout(() => {
                jumpscare.classList.remove('active');
                jumpscare.style.animationDuration = '0.1s';
                jumpscare.style.animationIterationCount = '5';
                // Réinitialiser l'icône pour qu'elle ne reste pas visible
                img.textContent = '';
                img.style.fontSize = '300px';
            }, randomScare.duration);
        }

        function rotateWheel(wheelIndex, direction) {
            wheelValues[wheelIndex] = (wheelValues[wheelIndex] + direction + 10) % 10;
            updateWheelDisplay(wheelIndex);
        }

        function updateWheelDisplay(wheelIndex) {
            const wheel = document.getElementById('wheel' + wheelIndex);
            const numbers = wheel.querySelectorAll('.number');
            const currentValue = wheelValues[wheelIndex];

            numbers[0].textContent = (currentValue - 1 + 10) % 10;
            numbers[1].textContent = currentValue;
            numbers[2].textContent = (currentValue + 1) % 10;

            numbers.forEach(num => num.classList.remove('active'));
            numbers[1].classList.add('active');
        }

        function checkLockCode() {
            const result = document.getElementById('lockResult');

            if (JSON.stringify(wheelValues) === JSON.stringify(CORRECT_CODE)) {
                result.innerHTML = '<p style="color: #0f0; font-weight: bold; font-size: 18px;">✓ CADENAS DÉVERROUILLÉ !</p>';

                setTimeout(() => {
                    document.getElementById('step1').classList.remove('active');
                    document.getElementById('step1').classList.add('completed');
                    document.getElementById('step2').classList.remove('locked');
                    document.getElementById('step2').classList.add('active');
                    document.getElementById('quizModule').classList.remove('locked');
                    showNotification('✓ ÉTAPE 1 COMPLÉTÉE - Énigmes débloquées !', '#0f0');

                    document.querySelectorAll('.lock-wheel').forEach(wheel => {
                        wheel.style.borderColor = '#0f0';
                        wheel.style.boxShadow = '0 0 30px rgba(0, 255, 0, 0.5)';
                    });
                }, 500);
            } else {
                result.innerHTML = '<p style="color: #f00; font-weight: bold;">✗ CODE INCORRECT</p>';

                document.querySelectorAll('.lock-wheel').forEach(wheel => {
                    wheel.style.animation = 'shake 0.5s';
                });

                triggerJumpscare();

                setTimeout(() => {
                    result.innerHTML = '';
                    document.querySelectorAll('.lock-wheel').forEach(wheel => {
                        wheel.style.animation = '';
                    });
                }, 2000);
            }
        }

        function createParticles() {
            const particles = document.getElementById('particles');
            const emojis = ['🎃', '🍂', '🍁', '💀', '🦇', '🕷️'];

            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (10 + Math.random() * 10) + 's';
                particles.appendChild(particle);
            }
        }

        function createBloodDrips() {
            const container = document.getElementById('bloodDrips');

            setInterval(() => {
                const drip = document.createElement('div');
                drip.className = 'blood-drip';
                drip.style.left = Math.random() * 100 + '%';
                container.appendChild(drip);
                setTimeout(() => drip.remove(), 3000);
            }, 2000);
        }


        function checkPassword() {
            const input = document.getElementById('passwordInput').value.toUpperCase();
            const errorMsg = document.getElementById('errorMsg');

            if (input === PASSWORD) {
                errorMsg.className = 'success-msg';
                errorMsg.textContent = '✓ ACCÈS AUTORISÉ';
                setTimeout(startActivation, 500);
            } else {
                errorMsg.className = 'error-msg';
                errorMsg.textContent = '✗ CODE INCORRECT';
                document.getElementById('passwordInput').value = '';
                window.attemptCount++;
                if (window.attemptCount === 3) {
                    triggerJumpscare();
                    window.attemptCount = 0;
                }
                setTimeout(() => errorMsg.textContent = '', 2000);
            }
        }

        document.getElementById('passwordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        function startActivation() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('activationScreen').style.display = 'block';

            const canvas = document.getElementById('matrixCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const columns = Math.floor(canvas.width / 20);
            const drops = Array(columns).fill(1);

            function drawMatrix() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#0f0';
                ctx.font = '15px monospace';

                for (let i = 0; i < drops.length; i++) {
                    const text = Math.random() > 0.5 ? '1' : '0';
                    ctx.fillText(text, i * 20, drops[i] * 20);
                    if (drops[i] * 20 > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }

            const matrixInterval = setInterval(drawMatrix, 50);

            setTimeout(() => {
                clearInterval(matrixInterval);
                document.getElementById('activationScreen').style.display = 'none';
                document.getElementById('introScreen').style.display = 'flex';
                createParticles();
                createBloodDrips();
                // Timer et REC seront démarrés dans startTests()
            }, 3000);
        }
        function startTests() {
            document.getElementById('introScreen').style.display = 'none';
            document.getElementById('terminalScreen').style.display = 'block';
            
            // Afficher le REC et réinitialiser le timer à 0
            const recIndicator = document.getElementById('recIndicator');
            if (recIndicator) {
                recIndicator.style.display = 'flex';
            }
            recStartTime = Date.now(); // Réinitialiser le timer à 0
            
            initializeSystem(); // Démarrer le timer REC et les messages Dr. Halloween
        }
        function unlockStep2() {
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.remove('locked');
            document.getElementById('step2').classList.add('active');
            document.getElementById('quizModule').classList.remove('locked');
            showNotification('✓ ÉTAPE 1 COMPLÉTÉE - Énigme débloquée !', '#0f0');
        }

        // ==================== MEMORY GAME ====================
        const memorySymbols = ['🎃', '👻', '💀', '🦇', '🕷️', '🕸️', '🧙', '🧛'];
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let memoryMoves = 0;
        let memoryLives = 5;
        let memoryStartTime = 0;
        let memoryTimerInterval;
        let memorySolved = false;

        function startMemory() {
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            flippedCards = [];
            matchedPairs = 0;
            memoryMoves = 0;
            memoryLives = 9;
            memoryStartTime = Date.now();
            memorySolved = false;

            document.getElementById('memoryMoves').textContent = '0';
            document.getElementById('memoryPairs').textContent = '0/8';
            document.getElementById('memoryTime').textContent = '0s';
            document.getElementById('memoryLives').textContent = '❤️❤️❤️❤️❤️❤️❤️❤️❤️';
            document.getElementById('memoryLives').style.color = '#f00';
            document.getElementById('memoryResult').innerHTML = '';

            // Activer la grille
            grid.style.pointerEvents = 'auto';
            grid.style.opacity = '1';

            memoryCards = [...memorySymbols, ...memorySymbols]
                .sort(() => Math.random() - 0.5)
                .map((symbol, index) => ({
                    id: index,
                    symbol: symbol,
                    flipped: false,
                    matched: false
                }));

            memoryCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'memory-card';
                cardElement.innerHTML = `
                <span class="back">❓</span>
                <span class="front">${card.symbol}</span>
            `;
                cardElement.onclick = () => flipCard(index, cardElement);
                grid.appendChild(cardElement);
            });

            clearInterval(memoryTimerInterval);
            memoryTimerInterval = setInterval(updateMemoryTimer, 1000);
        }

        function updateMemoryTimer() {
            const elapsed = Math.floor((Date.now() - memoryStartTime) / 1000);
            document.getElementById('memoryTime').textContent = elapsed + 's';
        }

        function flipCard(index, element) {
            if (flippedCards.length >= 2) return;
            if (memoryCards[index].flipped || memoryCards[index].matched) return;

            memoryCards[index].flipped = true;
            element.classList.add('flipped');
            flippedCards.push({ index, element });

            if (flippedCards.length === 2) {
                memoryMoves++;
                document.getElementById('memoryMoves').textContent = memoryMoves;

                setTimeout(checkMemoryMatch, 600);
            }
        }

        function checkMemoryMatch() {
            const [card1, card2] = flippedCards;

            if (memoryCards[card1.index].symbol === memoryCards[card2.index].symbol) {
                // PAIRE TROUVÉE !
                memoryCards[card1.index].matched = true;
                memoryCards[card2.index].matched = true;
                card1.element.classList.add('matched');
                card2.element.classList.add('matched');

                matchedPairs++;
                document.getElementById('memoryPairs').textContent = matchedPairs + '/8';

                // VICTOIRE !
                if (matchedPairs === 8) {
                    clearInterval(memoryTimerInterval);
                    memorySolved = true;

                    const timeElapsed = document.getElementById('memoryTime').textContent;

                    setTimeout(() => {
                        document.getElementById('memoryResult').innerHTML = `
                        <div style="color: #0f0; font-size: 20px; animation: pulse 1s infinite; text-align: center; width: 100%;">
                            🎉 VICTOIRE ! 🎉<br>
                            <span style="font-size: 16px;">Temps: ${timeElapsed} | Coups: ${memoryMoves}</span>
                        </div>
                    `;

                        document.getElementById('memoryModule').style.borderColor = '#0f0';

                        setTimeout(() => {
                            document.getElementById('step3').classList.remove('active');
                            document.getElementById('step3').classList.add('completed');
                            document.getElementById('step4').classList.remove('locked');
                            document.getElementById('step4').classList.add('active');
                            document.getElementById('filesModule').classList.remove('locked');
                            stopDrMessageSystem(); // Arrêter les messages Dr Halloween
                            showNotification('✓ ÉTAPE 3 COMPLÉTÉE - Dossiers débloqués !', '#0f0');
                            setTimeout(() => {
                                document.getElementById('finalScreen').classList.add('active');
                            }, 1500);
                            triggerJumpscare();
                        }, 1000);
                    }, 300);
                }
            } else {
                // ERREUR - Perdre une vie
                memoryLives--;

                // Mettre à jour l'affichage des vies
                const heartsDisplay = '❤️'.repeat(memoryLives) + '🖤'.repeat(9 - memoryLives);
                document.getElementById('memoryLives').textContent = heartsDisplay;

                // Changer la couleur selon les vies restantes
                if (memoryLives <= 2) {
                    document.getElementById('memoryLives').style.color = '#ff6600';
                }
                if (memoryLives <= 1) {
                    document.getElementById('memoryLives').style.color = '#f00';
                }

                memoryCards[card1.index].flipped = false;
                memoryCards[card2.index].flipped = false;
                card1.element.classList.remove('flipped');
                card2.element.classList.remove('flipped');
                card1.element.classList.add('shake');
                card2.element.classList.add('shake');

                setTimeout(() => {
                    card1.element.classList.remove('shake');
                    card2.element.classList.remove('shake');
                }, 300);

                // GAME OVER après 5 erreurs
                if (memoryLives <= 0) {
                    clearInterval(memoryTimerInterval);

                    // Bloquer toutes les cartes
                    const grid = document.getElementById('memoryGrid');
                    grid.style.pointerEvents = 'none';
                    grid.style.opacity = '0.5';
                    triggerJumpscare();
                    document.getElementById('memoryResult').innerHTML = `
                    <div style="color: #f00; font-size: 18px;">
                        💀 GAME OVER !<br>
                        <span style="font-size: 14px;">Paires trouvées: ${matchedPairs}/8</span>
                    </div>
                `;

                    setTimeout(() => {
                        grid.style.pointerEvents = 'auto';
                        grid.style.opacity = '1';
                        startMemory();
                    }, 2000);
                }
            }

            flippedCards = [];
        }

        // ==================== ÉNIGMES DU LABORATOIRE ====================

        function updateQuizProgress() {
            let count = 0;
            if (quizAnswered) count++;
            if (enigmaAnswered) count++;

            document.getElementById('quizProgress').textContent = count + '/2 ✓';

            // Si les 2 questions sont résolues, débloquer le Pendu
            if (quizAnswered && enigmaAnswered) {
                document.getElementById('quizModule').style.borderColor = '#0f0';
                setTimeout(() => {
                    showNotification('✅ Toutes les énigmes résolues ! Pendu débloqué !', '#0f0');
                    unlockHangman();
                }, 1000);
            }
        }

        function checkQuizAnswer(answer) {
            const buttons = document.querySelectorAll('.quiz1-btn');
            buttons.forEach(btn => btn.disabled = true);

            if (answer === 'B') {
                quizAnswered = true;
                document.getElementById('quizResult').innerHTML = '<div style="color: #0f0;">✅ CORRECT ! 10 - 3 = 7; 7 x 12 = 84 citrouilles</div>';
                updateQuizProgress();
            } else {
                document.getElementById('quizResult').innerHTML = '<div style="color: #f00;">❌ INCORRECT ! Réessayez...</div>';
                setTimeout(() => {
                    buttons.forEach(btn => btn.disabled = false);
                    document.getElementById('quizResult').innerHTML = '';
                }, 2000);
            }
        }

        function checkEnigmaAnswer(answer) {
            const buttons = document.querySelectorAll('.quiz2-btn');
            buttons.forEach(btn => btn.disabled = true);

            if (answer === 'D') {
                enigmaAnswered = true;
                document.getElementById('enigmaResult').innerHTML = '<div style="color: #0f0;">✅ CORRECT ! 3×2×2×2×2×2 = 96 citrouilles après 5 nuits</div>';
                updateQuizProgress();
            } else {
                document.getElementById('enigmaResult').innerHTML = '<div style="color: #f00;">❌ INCORRECT ! Pensez à la duplication chaque nuit...</div>';
                setTimeout(() => {
                    buttons.forEach(btn => btn.disabled = false);
                    document.getElementById('enigmaResult').innerHTML = '';
                }, 2000);
            }
        }

        function unlockHangman() {
            document.getElementById('hangmanModule').classList.remove('locked');
            document.getElementById('hangmanModule').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // ==================== JEU DU PENDU ====================
        const hangmanWordsEasy = [
            { word: "CITROUILLE", hint: "🎃 CHARADE : Mon premier est le début de 'citer', mon second est une rouille, mon tout est orange et sourit à Halloween !" },
            { word: "FANTOME", hint: "👻 ÉNIGME : Je traverse les murs sans les casser, je fais 'Bouuuh' pour effrayer, je suis blanc et transparent. Qui suis-je ?" },
            { word: "SQUELETTE", hint: "💀 ÉNIGME : Je suis blanc et je cliquette, je n'ai plus de chair ni de peau, je suis fait uniquement d'os. Qui suis-je ?" },
            { word: "SORCIERE", hint: "🧙 CHARADE : Mon premier est un outil pour scier, mon second est un cri de douleur (AIE!), mon tout vole sur un balai magique !" },
            { word: "VAMPIRE", hint: "🧛 ÉNIGME : Je dors le jour dans un cercueil, je crains l'ail et les crucifix, je ne me reflète pas dans les miroirs. Qui suis-je ?" },
            { word: "CHAUVESOURIS", hint: "🦇 ÉNIGME : Je vole mais ne suis pas un oiseau, je dors la tête en bas, j'utilise les ultrasons pour voir dans le noir. Qui suis-je ?" },
            { word: "ARAIGNEE", hint: "🕷️ ÉNIGME : J'ai 8 pattes mais ne suis pas un meuble, je tisse ma maison, je piège les mouches. Qui suis-je ?" },
            { word: "LOUPGAROU", hint: "🐺 CHARADE : Mon premier est un animal qui hurle à la lune, mon second est un lieu avec de l'herbe (pré/gazon), mon tout se transforme les nuits de pleine lune !" },
            { word: "MONSTRE", hint: "👹 CHARADE : Mon premier suit le dimanche, mon second est un animal à longues oreilles, mon tout fait très peur aux enfants !" },
            { word: "ZOMBI", hint: "🧟 ÉNIGME : Je suis mort mais je marche encore, je mange des cerveaux, je grogne 'Graaaaah'. Qui suis-je ?" },
            { word: "CERCUEIL", hint: "⚰️ ÉNIGME : Je suis une boîte pour dormir éternellement, souvent en bois, on m'enterre sous terre. Qui suis-je ?" },
            { word: "CIMETIERE", hint: "🪦 CHARADE : Mon premier se trouve au bout du pied (orteil), mon second est caché dans 'matière', mon tout est le lieu de repos des morts !" },
            { word: "TOMBE", hint: "💐 ÉNIGME : Je commence comme 'tomber', je rime avec 'bombe', je marque l'endroit où repose un défunt. Qui suis-je ?" },
            { word: "BALAI", hint: "🧹 ÉNIGME : On me chevauche pour voler la nuit, j'ai des brindilles à mon bout, les sorcières m'adorent pour voyager. Qui suis-je ?" },
            { word: "CHAUDRON", hint: "🔮 ÉNIGME : Je suis rond et noir, je bouillonne sur le feu, les sorcières y préparent leurs potions magiques. Qui suis-je ?" },
            { word: "POTION", hint: "🧪 ÉNIGME : Je suis un liquide magique coloré, on me boit pour se transformer, les sorcières me préparent avec des ingrédients bizarres. Qui suis-je ?" },
            { word: "MALEDICTION", hint: "🪄 CHARADE : Mon premier est un synonyme de 'mauvais', mon second vient après 'neuf', mon tout est un sort qui porte malheur !" },
            { word: "EPOUVANTAIL", hint: "🌾 CHARADE : Mon premier exprime la peur intense (épouvante), mon second protège un château, mon tout fait fuir les oiseaux dans les champs !" },
            { word: "BONBONS", hint: "🍬 CHARADE : Mon premier signifie 'bien', mon second est caché dans 'bondir', mon tout est ce qu'on récolte en criant 'Trick or Treat' !" },
            { word: "TOILE", hint: "🕸️ ÉNIGME : Je suis collante et argentée, une créature à 8 pattes me fabrique, je piège les insectes volants. Qui suis-je ?" }
        ];

        const allHangmanWords = [
            { word: "NECROMANCIE", hint: "🔮 CHARADE : Mon premier est une négation, mon second est le cri du corbeau, mon troisième pratique la magie. Mon tout invoque les défunts." },
            { word: "PUTREFACTION", hint: "💀 ÉNIGME : Processus inexorable qui transforme la chair en poussière. Sans moi, point de renaissance. Les vers sont mes ouvriers. Je suis..." },
            { word: "EXORCISME", hint: "⛪ CHARADE : Mon premier sort du corps, mon second est un courant philosophique, mon tout chasse les démons." },
            { word: "MEMENTO-MORI", hint: "☠️ ÉNIGME : Locution latine gravée sur les vanités. Je te rappelle l'inéluctable. Les moines me murmurent. Souviens-toi que tu..." },
            { word: "LINCEUL", hint: "⚰️ CHARADE : Mon premier est un tissu précieux, mon second est le contraire de 'lent', mon tout enveloppe les morts dans leur dernier voyage." },
            { word: "CROQUE-MORT", hint: "🎩 ÉNIGME : Mon métier est d'accompagner ceux qui ne reviendront jamais. Je porte le noir avec solennité. On dit que je 'croque' symboliquement pour vérifier le trépas..." },
            { word: "THANATOLOGIE", hint: "📚 CHARADE : Mon premier est le dieu grec de la mort, mon second est une science. Mon tout étudie la mort sous tous ses aspects." },
            { word: "CATACOMBES", hint: "🏛️ ÉNIGME : Labyrinthe souterrain tapissé d'ossements. À Paris ou Rome, je garde les secrets des siècles. Les touristes me visitent, les morts m'habitent." },
            { word: "POLTERGEIST", hint: "👻 ÉNIGME : Mot allemand signifiant 'esprit frappeur'. Je déplace les objets, claque les portes. Les parapsychologues m'étudient, les sceptiques me nient." },
            { word: "LYCANTHROPIE", hint: "🐺 CHARADE : Mon premier est un canidé, mon second vient du grec 'anthropos' (homme). Mon tout est une transformation maudite sous la pleine lune." },
            { word: "NOSFERATU", hint: "🧛 ÉNIGME : Nom roumain du vampire, popularisé par Murnau en 1922. Je suis l'ombre qui boit la vie, le non-mort par excellence..." },
            { word: "APOCALYPSE", hint: "🔥 CHARADE : Mon premier cache quelque chose, mon second est un astre, mon troisième est un fleuve français. Mon tout annonce la fin des temps." },
            { word: "INCANTATION", hint: "🪄 ÉNIGME : Formule magique prononcée avec solennité. Les sorcières me psalmodient, les druides me chantent. Abracadabra est ma cousine..." },
            { word: "SEPULTURE", hint: "🪦 CHARADE : Mon premier est un chiffre, mon second est un verbe à l'infinitif, mon tout est l'acte d'inhumer un corps." },
            { word: "GRIMOIRE", hint: "📖 ÉNIGME : Livre de magie défendu, relié de cuir sombre. Mes pages contiennent sorts et rituels oubliés. Faust me consultait..." },
            { word: "ECTOPLASME", hint: "👻 CHARADE : Mon premier est un préfixe grec signifiant 'extérieur', mon second est la matière vivante. Mon tout est la substance spectrale des fantômes." },
            { word: "MAUSOLEE", hint: "🏛️ ÉNIGME : Monument funéraire grandiose tirant mon nom du roi Mausole. Je suis plus qu'une tombe, je suis une œuvre d'art mortuaire." },
            { word: "FLAGELLATION", hint: "⛓️ CHARADE : Mon premier est un drapeau, mon second termine 'nation'. Mon tout est une punition par le fouet, pratiquée aussi en pénitence." },
            { word: "SACRIFICE", hint: "🗡️ ÉNIGME : Offrande aux dieux, souvent sanglante. Les Aztèques me pratiquaient au sommet des pyramides. Je rends sacré ce qui est immolé..." },
            { word: "TOURMENTE", hint: "🌪️ CHARADE : Mon premier fait le tour, mon second vient de 'mentir'. Mon tout est une souffrance psychique intense ou une tempête violente." },
            { word: "MALEDICTION", hint: "🪄 CHARADE : Mon premier est un synonyme de 'mauvais', mon second vient après 'neuf', mon tout est un sort qui porte malheur !" },
            { word: "NECROPHAGE", hint: "🦴 CHARADE : Mon premier désigne la mort (nécro), mon second vient de 'manger' en grec. Mon tout se nourrit de cadavres." },
            { word: "TRANSMUTATION", hint: "⚗️ ÉNIGME : Transformation alchimique de la matière. Les alchimistes cherchaient à changer le plomb en or par mon processus..." },
            { word: "HALLUCINATION", hint: "👁️ ÉNIGME : Perception sans objet réel. Je peux être visuelle, auditive ou tactile. La fièvre et la folie me provoquent..." },
            { word: "METAMORPHOSE", hint: "🦋 CHARADE : Mon premier vient du grec 'meta' (au-delà), mon second est la forme. Mon tout est une transformation complète." },
            { word: "ALCHIMIE", hint: "⚗️ ÉNIGME : Science occulte médiévale cherchant la pierre philosophale. Je suis l'ancêtre de la chimie moderne..." },
            { word: "PENTAGONE", hint: "⭐ CHARADE : Mon premier signifie 'cinq' en grec, mon second est un polygone. Mon tout a 5 côtés et protège contre le mal." },
            { word: "PARCHEMIN", hint: "📜 ÉNIGME : Support d'écriture fait de peau animale. Les grimoires anciens étaient écrits sur moi. Je suis plus précieux que le papier..." },
            { word: "CRYPTE", hint: "⚰️ ÉNIGME : Caveau souterrain d'une église où reposent les morts illustres. Je suis froide, humide et inquiétante..." },
            { word: "EXSANGUE", hint: "💉 ÉNIGME : Adjectif désignant quelqu'un qui a perdu tout son sang. Je suis pâle, vidé de ma substance vitale..." },
            { word: "MALEDICTION", hint: "💀 ÉNIGME : Sort jeté pour causer du malheur. Les pharaons en plaçaient sur leurs tombeaux. Je pèse sur les générations..." },
            { word: "OUIJA", hint: "🔮 ÉNIGME : Planche spirite utilisée pour communiquer avec les esprits. Mon nom vient de 'oui' en français et allemand..." },
            { word: "SPECTRE", hint: "👻 ÉNIGME : Apparition fantomatique d'un mort. Je hante les vivants, je suis une ombre du passé qui refuse de partir..." },
            { word: "SUPPLICE", hint: "😱 ÉNIGME : Torture physique ou morale intense. Au Moyen-Âge, j'étais infligé publiquement. La roue et l'écartèlement sont mes formes..." },
            { word: "RITUEL", hint: "🕯️ ÉNIGME : Ensemble de gestes et paroles codifiés pour une cérémonie. Je peux être religieux, magique ou funéraire..." },
            { word: "POSSEDEE", hint: "😈 ÉNIGME : État d'une personne habitée par un esprit malin. L'exorcisme tente de me libérer du démon qui me contrôle..." },
            { word: "CAUCHEMAR", hint: "😱 CHARADE : Mon premier vient du latin 'calcare' (presser), mon second est la jument. Mon tout est un rêve terrifiant." },
            { word: "MACABRE", hint: "💀 ÉNIGME : Adjectif qualifiant ce qui évoque la mort de manière sinistre. La danse des squelettes est ma danse..." },
            { word: "TENEBRES", hint: "🌑 ÉNIGME : Obscurité profonde et inquiétante. Je suis plus que la nuit, je suis l'absence totale de lumière..." },
            { word: "DIABOLIQUE", hint: "😈 CHARADE : Mon premier est un préfixe grec, mon second vient de 'balle'. Mon tout qualifie ce qui est démoniaque." }
        ];

        let hangmanDifficulty = 'hard'; // 'easy' ou 'hard'
        let usedHangmanWords = [];
        let hangmanCurrentWord = '';
        let hangmanGuessedLetters = [];
        let hangmanErrors = 0;
        let hangmanWins = 0;
        let hangmanMaxErrors = 6;
        let hangmanActive = false;

        const hangmanStages = ['🎃', '😨', '😱', '💀', '☠️', '⚰️', '🪦'];

        function getUniqueWord() {
            // Choisir la liste selon la difficulté
            const wordList = hangmanDifficulty === 'easy' ? hangmanWordsEasy : allHangmanWords;

            // Filtrer les mots déjà utilisés
            const availableWords = wordList.filter(w => !usedHangmanWords.includes(w.word));

            // Si tous les mots sont utilisés, réinitialiser
            if (availableWords.length === 0) {
                usedHangmanWords = [];
                return wordList[Math.floor(Math.random() * wordList.length)];
            }

            // Choisir un mot aléatoire parmi les disponibles
            const randomIndex = Math.floor(Math.random() * availableWords.length);
            const selected = availableWords[randomIndex];
            usedHangmanWords.push(selected.word);
            return selected;
        }

        function startHangmanGame() {
            if (hangmanWins >= 6) return;

            const selected = getUniqueWord();
            hangmanCurrentWord = selected.word.toUpperCase();
            hangmanGuessedLetters = [];
            hangmanErrors = 0;
            hangmanActive = true;

            document.getElementById('hangmanErrorsDisplay').textContent = '0/' + hangmanMaxErrors;
            document.getElementById('hangmanDrawing').textContent = hangmanStages[0];
            document.getElementById('hangmanHint').innerHTML = '💡 ' + selected.hint;
            document.getElementById('hangmanMessage').innerHTML = '';
            document.getElementById('hangmanStartBtn').style.display = 'none';

            createHangmanKeyboard();
            updateHangmanWord();
        }

        function createHangmanKeyboard() {
            const keyboard = document.getElementById('hangmanKeyboard');
            keyboard.innerHTML = '';

            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ-'.split('');

            letters.forEach(letter => {
                const btn = document.createElement('button');
                btn.textContent = letter;
                btn.style.cssText = `
                        width: 38px;
                        height: 38px;
                        margin: 2px;
                        padding: 3px;
                        background: rgba(255, 102, 0, 0.3);
                        border: 2px solid #ff6600;
                        color: #ff6600;
                        font-family: 'Courier New', monospace;
                        font-size: 16px;
                        font-weight: bold;
                        cursor: pointer;
                        border-radius: 5px;
                        transition: all 0.3s;
                        min-width: 38px;
                        flex-shrink: 0;
                    `;
                btn.onmouseover = () => {
                    if (!btn.disabled) {
                        btn.style.background = '#ff6600';
                        btn.style.color = '#000';
                    }
                };
                btn.onmouseout = () => {
                    if (!btn.disabled) {
                        btn.style.background = 'rgba(255, 102, 0, 0.3)';
                        btn.style.color = '#ff6600';
                    }
                };
                btn.onclick = () => guessLetter(letter, btn);
                keyboard.appendChild(btn);
            });
        }

        function guessLetter(letter, button) {
            if (!hangmanActive || hangmanGuessedLetters.includes(letter)) return;

            hangmanGuessedLetters.push(letter);
            button.disabled = true;
            button.style.opacity = '0.3';
            button.style.cursor = 'not-allowed';

            if (hangmanCurrentWord.includes(letter)) {
                button.style.background = '#0f0';
                button.style.borderColor = '#0f0';
                button.style.color = '#000';
                updateHangmanWord();
            } else {
                button.style.background = '#f00';
                button.style.borderColor = '#f00';
                button.style.color = '#000';
                hangmanErrors++;
                document.getElementById('hangmanErrorsDisplay').textContent = hangmanErrors + '/' + hangmanMaxErrors;
                document.getElementById('hangmanDrawing').textContent = hangmanStages[hangmanErrors];

                if (hangmanErrors >= hangmanMaxErrors) {
                    hangmanLose();
                }
            }
        }

        function updateHangmanWord() {
            const display = hangmanCurrentWord
                .split('')
                .map(letter => {
                    if (letter === '-') return '-';
                    return hangmanGuessedLetters.includes(letter) ? letter : '_';
                })
                .join(' ');

            document.getElementById('hangmanWord').textContent = display;

            // Vérifier la victoire
            const won = hangmanCurrentWord.split('').every(letter =>
                letter === '-' || hangmanGuessedLetters.includes(letter)
            );

            if (won) {
                hangmanWin();
            }
        }

        function hangmanWin() {
            hangmanActive = false;
            hangmanWins++;

            document.getElementById('hangmanProgress').textContent = hangmanWins + '/6';
            document.getElementById('hangmanMessage').innerHTML = `
                    <div style="color: #0f0; font-size: 18px; animation: pulse 1s infinite;">
                        ✅ CORRECT ! (${hangmanWins}/6)
                    </div>
                `;

            const keyboard = document.getElementById('hangmanKeyboard');
            keyboard.style.opacity = '0.3';
            keyboard.style.pointerEvents = 'none';

            if (hangmanWins >= 6) {
                setTimeout(() => {
                    document.getElementById('hangmanMessage').innerHTML = `
                            <div style="color: #0f0; font-size: 20px; animation: pulse 1s infinite; text-align: center; width: 100%;">
                                🎉 PROTOCOLE COMPLÉTÉ !<br>
                                <span style="font-size: 14px;">Déverrouillage de l'étape 3...</span>
                            </div>
                        `;
                    document.getElementById('hangmanModule').style.borderColor = '#0f0';

                    setTimeout(() => {
                        unlockStep3();
                    }, 2000);
                }, 1000);
            } else {
                // Passer automatiquement à l'énigme suivante après 2 secondes
                setTimeout(() => {
                    keyboard.style.opacity = '1';
                    keyboard.style.pointerEvents = 'auto';
                    startHangmanGame();
                }, 2000);
            }
        }

        function hangmanLose() {
            hangmanActive = false;

            const word = hangmanCurrentWord;
            document.getElementById('hangmanWord').textContent = word;
            document.getElementById('hangmanMessage').innerHTML = `
                    <div style="color: #f00; font-size: 16px;">
                        💀 PERDU ! Le mot était : ${word}<br>
                        <span style="font-size: 14px;">Progression conservée (${hangmanWins}/6)</span>
                    </div>
                `;

            const keyboard = document.getElementById('hangmanKeyboard');
            keyboard.style.opacity = '0.3';
            keyboard.style.pointerEvents = 'none';

            triggerJumpscare();

            setTimeout(() => {
                document.getElementById('hangmanStartBtn').textContent = '🔄 NOUVELLE ÉNIGME';
                document.getElementById('hangmanStartBtn').style.display = 'block';
                keyboard.style.opacity = '1';
                keyboard.style.pointerEvents = 'auto';
            }, 2000);
        }

        function unlockStep3() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.remove('locked');
            document.getElementById('step3').classList.add('active');
            document.getElementById('codeModule').classList.remove('locked');
            showNotification('✓ ÉTAPE 2 COMPLÉTÉE - Code de sécurité débloqué !', '#0f0');
        }



        let simonPlaying = false;
        let simonWaitingForInput = false;
        let simonNeedNewLevel = true;

        function startSimon() {
            if (simonPlaying) return;

            const btnText = document.getElementById('simonStartBtn').textContent;

            if (btnText === 'NIVEAU SUIVANT' || simonNeedNewLevel) {
                simonRound++;
                simonSequence.push(Math.floor(Math.random() * 4));
                document.getElementById('simonLevel').textContent = simonRound;
                simonNeedNewLevel = false;
            }

            simonPlayerSequence = [];
            simonWaitingForInput = false;
            simonPlaying = true;
            document.getElementById('simonStartBtn').disabled = true;
            document.getElementById('simonStartBtn').textContent = 'REGARDEZ LA SÉQUENCE...';
            playSimonSequence();
        }

        function playSimonSequence() {
            let index = 0;
            const interval = setInterval(() => {
                if (index < simonSequence.length) {
                    const btn = document.querySelector(`.simon-button[data-icon="${simonSequence[index]}"]`);
                    btn.classList.add('active');
                    setTimeout(() => btn.classList.remove('active'), 400);
                    index++;
                } else {
                    clearInterval(interval);
                    simonPlaying = false;
                    simonWaitingForInput = true;
                    document.getElementById('simonStartBtn').disabled = false;
                    document.getElementById('simonStartBtn').textContent = 'REJOUER LA SÉQUENCE';
                }
            }, 600);
        }

        function simonClick(icon) {
            if (simonPlaying || !simonWaitingForInput) return;

            simonPlayerSequence.push(icon);
            const btn = document.querySelector(`.simon-button[data-icon="${icon}"]`);
            btn.classList.add('active');
            setTimeout(() => btn.classList.remove('active'), 200);

            const currentIndex = simonPlayerSequence.length - 1;

            if (simonPlayerSequence[currentIndex] !== simonSequence[currentIndex]) {
                document.getElementById('simonResult').innerHTML = '<p style="color: #f00; font-weight: bold;">✗ ERREUR ! Recommencez ce niveau</p>';
                simonPlayerSequence = [];
                simonWaitingForInput = false;
                document.getElementById('simonStartBtn').textContent = 'REJOUER LA SÉQUENCE';
                triggerJumpscare();
                setTimeout(() => document.getElementById('simonResult').innerHTML = '', 2000);
            } else if (simonPlayerSequence.length === simonSequence.length) {
                simonWaitingForInput = false;
                if (simonRound >= 8) {
                    document.getElementById('simonResult').innerHTML = '<p style="color: #0f0; font-weight: bold;">🎉 SÉQUENCE COMPLÉTÉE - 8 NIVEAUX RÉUSSIS !</p>';
                    document.getElementById('simonModule').style.borderColor = '#0f0';
                    document.getElementById('puzzleModule').classList.remove('locked');
                    document.getElementById('simonStartBtn').disabled = true;
                    document.getElementById('simonStartBtn').textContent = '✓ TERMINÉ';
                    showNotification('✓ Simon Says réussi - Puzzle débloqué !', '#0f0');
                    initPuzzle();
                } else {
                    document.getElementById('simonResult').innerHTML = '<p style="color: #0f0;">✓ Niveau ' + simonRound + ' réussi !</p>';
                    simonPlayerSequence = [];
                    simonNeedNewLevel = true;
                    document.getElementById('simonStartBtn').textContent = 'NIVEAU SUIVANT';
                    setTimeout(() => {
                        document.getElementById('simonResult').innerHTML = '';
                    }, 1000);
                }
            }
        }

        function generatePuzzleImage() {
            const canvas = document.createElement('canvas');
            canvas.width = 900;  // Augmenté pour meilleure qualité
            canvas.height = 900;
            const ctx = canvas.getContext('2d');

            // Fond dégradé Halloween
            const gradient = ctx.createRadialGradient(450, 450, 100, 450, 450, 600);
            gradient.addColorStop(0, '#ff6600');
            gradient.addColorStop(0.5, '#ff3300');
            gradient.addColorStop(1, '#8B0000');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 900, 900);

            // Texture de fond
            for (let i = 0; i < 200; i++) {
                ctx.fillStyle = `rgba(0, 0, 0, ${Math.random() * 0.1})`;
                ctx.fillRect(Math.random() * 900, Math.random() * 900, Math.random() * 50, Math.random() * 50);
            }

            // Grande citrouille centrale avec détails
            ctx.save();
            ctx.translate(450, 450);

            // Ombre de la citrouille
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.beginPath();
            ctx.ellipse(0, 280, 280, 40, 0, 0, Math.PI * 2);
            ctx.fill();

            // Corps de la citrouille avec dégradé
            const pumpkinGradient = ctx.createRadialGradient(0, 0, 50, 0, 0, 300);
            pumpkinGradient.addColorStop(0, '#ffa500');
            pumpkinGradient.addColorStop(0.7, '#ff8800');
            pumpkinGradient.addColorStop(1, '#ff6600');
            ctx.fillStyle = pumpkinGradient;
            ctx.beginPath();
            ctx.arc(0, 0, 280, 0, Math.PI * 2);
            ctx.fill();

            // Rainures verticales (plus détaillées)
            ctx.strokeStyle = '#cc6600';
            ctx.lineWidth = 12;
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 10;
            for (let i = -3; i <= 3; i++) {
                ctx.beginPath();
                ctx.moveTo(i * 50, -280);
                ctx.bezierCurveTo(
                    i * 50 - 20, -100,
                    i * 50 + 20, 100,
                    i * 70, 280
                );
                ctx.stroke();
            }
            ctx.shadowBlur = 0;

            // Reflets sur la citrouille
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.beginPath();
            ctx.ellipse(-80, -100, 60, 100, -0.5, 0, Math.PI * 2);
            ctx.fill();

            // Yeux triangulaires avec ombres
            ctx.fillStyle = '#000';
            ctx.shadowColor = 'rgba(255, 102, 0, 0.8)';
            ctx.shadowBlur = 20;

            // Œil gauche
            ctx.beginPath();
            ctx.moveTo(-110, -50);
            ctx.lineTo(-60, 0);
            ctx.lineTo(-160, 0);
            ctx.closePath();
            ctx.fill();

            // Œil droit
            ctx.beginPath();
            ctx.moveTo(110, -50);
            ctx.lineTo(160, 0);
            ctx.lineTo(60, 0);
            ctx.closePath();
            ctx.fill();

            ctx.shadowBlur = 0;

            // Nez triangulaire
            ctx.beginPath();
            ctx.moveTo(0, 20);
            ctx.lineTo(-30, 80);
            ctx.lineTo(30, 80);
            ctx.closePath();
            ctx.fill();

            // Bouche effrayante avec dents
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 15;
            ctx.beginPath();
            ctx.arc(0, 100, 120, 0, Math.PI);
            ctx.stroke();

            // Dents
            ctx.fillStyle = '#000';
            for (let i = -3; i <= 3; i++) {
                const x = i * 30;
                ctx.fillRect(x - 8, 100 + Math.sqrt(120 * 120 - x * x) - 5, 16, 30);
            }

            // Tige (plus détaillée)
            ctx.fillStyle = '#228B22';
            ctx.fillRect(-35, -350, 70, 100);

            // Texture de la tige
            ctx.strokeStyle = '#1a6b1a';
            ctx.lineWidth = 3;
            for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                ctx.moveTo(-35, -350 + i * 10);
                ctx.lineTo(35, -340 + i * 10);
                ctx.stroke();
            }

            // Feuille sur la tige
            ctx.fillStyle = '#32CD32';
            ctx.beginPath();
            ctx.moveTo(35, -300);
            ctx.bezierCurveTo(100, -320, 120, -280, 100, -250);
            ctx.bezierCurveTo(80, -260, 60, -270, 35, -280);
            ctx.closePath();
            ctx.fill();

            ctx.restore();

            // Étoiles et particules Halloween
            ctx.fillStyle = '#ffff00';
            for (let i = 0; i < 30; i++) {
                const x = Math.random() * 900;
                const y = Math.random() * 900;
                const size = Math.random() * 3 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }

            // Texte "PROJET CITROUILLE" en haut
            ctx.font = 'bold 48px Arial';
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.strokeStyle = '#ff6600';
            ctx.lineWidth = 3;
            ctx.strokeText('PROJET CITROUILLE', 450, 80);
            ctx.fillText('PROJET CITROUILLE', 450, 80);

            return canvas;
        }

        function initPuzzle() {
            puzzlePieces = [1, 2, 3, 4, 5, 6, 7, 8, 0];
            showNumbers = false;
            masterCanvas = generatePuzzleImage();
            shufflePuzzle();
        }

        function shufflePuzzle() {
            do {
                for (let i = puzzlePieces.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [puzzlePieces[i], puzzlePieces[j]] = [puzzlePieces[j], puzzlePieces[i]];
                }
            } while (!isSolvable() || isSolved());

            puzzleSolved = false;
            document.getElementById('puzzleResult').innerHTML = '';
            renderPuzzle();
        }

        function isSolvable() {
            let inversions = 0;
            for (let i = 0; i < puzzlePieces.length - 1; i++) {
                for (let j = i + 1; j < puzzlePieces.length; j++) {
                    if (puzzlePieces[i] && puzzlePieces[j] && puzzlePieces[i] > puzzlePieces[j]) {
                        inversions++;
                    }
                }
            }
            return inversions % 2 === 0;
        }

        function isSolved() {
            for (let i = 0; i < puzzlePieces.length - 1; i++) {
                if (puzzlePieces[i] !== i + 1) return false;
            }
            return puzzlePieces[puzzlePieces.length - 1] === 0;
        }

        function renderPuzzle() {
            const container = document.getElementById('puzzleContainer');
            container.innerHTML = '';

            const pieceSize = 300; // 900 / 3 (haute résolution)

            puzzlePieces.forEach((piece, index) => {
                const div = document.createElement('div');
                div.className = 'puzzle-piece';

                if (piece === 0) {
                    div.classList.add('empty');
                } else {
                    const canvas = document.createElement('canvas');
                    canvas.width = pieceSize;
                    canvas.height = pieceSize;
                    const ctx = canvas.getContext('2d');

                    const correctRow = Math.floor((piece - 1) / 3);
                    const correctCol = (piece - 1) % 3;

                    const sx = correctCol * pieceSize;
                    const sy = correctRow * pieceSize;

                    ctx.drawImage(
                        masterCanvas,
                        sx, sy, pieceSize, pieceSize,
                        0, 0, pieceSize, pieceSize
                    );

                    div.appendChild(canvas);

                    const numberSpan = document.createElement('span');
                    numberSpan.className = 'puzzle-piece-number';
                    numberSpan.textContent = piece;
                    div.appendChild(numberSpan);
                }

                div.onclick = () => movePuzzlePiece(index);
                container.appendChild(div);
            });
        }

        function movePuzzlePiece(index) {
            const emptyIndex = puzzlePieces.indexOf(0);

            const validMoves = [
                emptyIndex - 1,
                emptyIndex + 1,
                emptyIndex - 3,
                emptyIndex + 3
            ].filter(i => {
                if (i < 0 || i > 8) return false;
                if (emptyIndex % 3 === 0 && i === emptyIndex - 1) return false;
                if (emptyIndex % 3 === 2 && i === emptyIndex + 1) return false;
                return true;
            });

            if (validMoves.includes(index)) {
                [puzzlePieces[index], puzzlePieces[emptyIndex]] =
                    [puzzlePieces[emptyIndex], puzzlePieces[index]];

                renderPuzzle();
                checkPuzzle();
            } else {
                const piece = document.querySelectorAll('.puzzle-piece')[index];
                if (!piece.classList.contains('empty')) {
                    piece.style.animation = 'shake 0.3s';
                    setTimeout(() => piece.style.animation = '', 300);
                }
            }
        }

        function checkPuzzle() {
            if (isSolved() && !puzzleSolved) {
                puzzleSolved = true;

                document.getElementById('puzzleResult').innerHTML =
                    '<p style="color: #0f0; font-weight: bold; font-size: 18px;">✓ PUZZLE RÉSOLU !</p>';

                const pieces = document.querySelectorAll('.puzzle-piece');
                pieces.forEach((piece, i) => {
                    setTimeout(() => {
                        piece.style.borderColor = '#0f0';
                        piece.style.boxShadow = '0 0 20px rgba(0, 255, 0, 0.8)';
                        piece.style.animation = 'successPulse 0.5s';
                    }, i * 50);
                });

                // Déclencher le faux crash après 1 seconde
                setTimeout(() => {
                    triggerFakeCrash();
                }, 1000);
            }
        }

        // ========== FAUX CRASH TERRIFIANT ==========
        function triggerFakeCrash() {
            const crashScreen = document.getElementById('crashScreen');
            const text1 = document.getElementById('crashText1');
            const text2 = document.getElementById('crashText2');
            const text3 = document.getElementById('crashText3');
            const errorMsg = document.getElementById('crashError');

            // Afficher l'écran noir
            crashScreen.classList.add('active');

            // Messages à écrire
            const messages = [
                'ERREUR SYSTÈME...',
                'VOUS N\'AURIEZ PAS DÛ',
                'VENIR ICI...'
            ];

            // Fonction pour écrire le texte lettre par lettre
            function typeWriter(element, text, speed, callback) {
                let i = 0;
                element.textContent = '';
                
                function type() {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                        setTimeout(type, speed);
                    } else if (callback) {
                        setTimeout(callback, 500);
                    }
                }
                type();
            }

            // Effet sonore de glitch (facultatif, simulé visuellement)
            function glitchEffect() {
                crashScreen.style.animation = 'glitch 0.3s';
                setTimeout(() => {
                    crashScreen.style.animation = '';
                }, 300);
            }

            // Séquence du crash
            setTimeout(() => {
                // Message 1
                typeWriter(text1, messages[0], 80, () => {
                    glitchEffect();
                    // Message 2
                    setTimeout(() => {
                        typeWriter(text2, messages[1], 100, () => {
                            // Message 3
                            setTimeout(() => {
                                typeWriter(text3, messages[2], 120, () => {
                                    // Afficher le message d'erreur
                                    setTimeout(() => {
                                        errorMsg.style.opacity = '1';
                                        
                                        // Après 3 secondes, tout revient à la normale
                                        setTimeout(() => {
                                            // Effet de fondu
                                            crashScreen.style.transition = 'opacity 1s';
                                            crashScreen.style.opacity = '0';
                                            
                                            setTimeout(() => {
                                                crashScreen.classList.remove('active');
                                                crashScreen.style.opacity = '1';
                                                crashScreen.style.transition = '';
                                                
                                                // Réinitialiser les textes
                                                text1.textContent = '';
                                                text2.textContent = '';
                                                text3.textContent = '';
                                                errorMsg.style.opacity = '0.5';
                                                
                                                // Débloquer le labyrinthe normalement
                                                document.getElementById('puzzleModule').style.borderColor = '#0f0';
                                                document.getElementById('mazeModule').classList.remove('locked');
                                                showNotification('✓ Puzzle complété - Labyrinthe débloqué !', '#0f0');
                                                initMaze();
                                            }, 1000);
                                        }, 3000);
                                    }, 500);
                                });
                            }, 300);
                        });
                    }, 500);
                });
            }, 300);
        }

        function togglePuzzleNumbers() {
            showNumbers = !showNumbers;
            const container = document.getElementById('puzzleContainer');

            if (showNumbers) {
                container.classList.add('show-numbers');
            } else {
                container.classList.remove('show-numbers');
            }
        }
        // ========== LABYRINTHE DANS LE NOIR ==========
        let mazeActive = false;
        let mazeCompleted = false;
        let mazeHP = 3;
        let mazePlayer = { x: 1, y: 1 };
        let mazeExit = { x: 0, y: 0 };
        let mazeGrid = [];
        let mazeSize = 15;
        let mazeCellSize = 33;
        let mazeCanvas, mazeCtx;
        let mazeTraps = [];
        let mazeStartTime = 0;
        let mazeTimerInterval;
        let mazeKeys = {};

        function startMaze() {
            mazeActive = true;
            mazeCompleted = false;
            mazeHP = 3;
            mazeStartTime = Date.now();

            // Initialiser canvas
            mazeCanvas = document.getElementById('mazeCanvas');
            mazeCtx = mazeCanvas.getContext('2d');

            // Activer les boutons de déplacement
            const mazeButtons = ['mazeBtnUp', 'mazeBtnDown', 'mazeBtnLeft', 'mazeBtnRight'];
            mazeButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) btn.disabled = false;
            });

            // Générer labyrinthe
            generateMaze();

            // Position de départ
            mazePlayer = { x: 1, y: 1 };

            // Position de sortie (coin opposé)
            mazeExit = { x: mazeSize - 2, y: mazeSize - 2 };

            // Générer des pièges
            generateTraps();

            // Affichage
            document.getElementById('mazeHP').textContent = '❤️'.repeat(mazeHP);
            document.getElementById('mazeProgress').textContent = '0%';
            document.getElementById('mazeTime').textContent = '0s';
            document.getElementById('mazeHint').textContent = '🔦 Trouvez la sortie ! Évitez les pièges invisibles...';
            document.getElementById('mazeHint').style.color = '#0f0';
            document.getElementById('mazeMessage').innerHTML = '';

            // Timer
            clearInterval(mazeTimerInterval);
            mazeTimerInterval = setInterval(() => {
                if (mazeActive) {
                    const elapsed = Math.floor((Date.now() - mazeStartTime) / 1000);
                    document.getElementById('mazeTime').textContent = elapsed + 's';
                }
            }, 1000);

            // Dessiner
            drawMaze();
        }

        function generateMaze() {
            // Créer grille vide (1 = mur, 0 = chemin)
            mazeGrid = [];
            for (let y = 0; y < mazeSize; y++) {
                mazeGrid[y] = [];
                for (let x = 0; x < mazeSize; x++) {
                    mazeGrid[y][x] = 1;
                }
            }

            // Algorithme de génération simple (DFS)
            const stack = [];
            const startX = 1, startY = 1;
            mazeGrid[startY][startX] = 0;
            stack.push({ x: startX, y: startY });

            const directions = [
                { dx: 2, dy: 0 },
                { dx: -2, dy: 0 },
                { dx: 0, dy: 2 },
                { dx: 0, dy: -2 }
            ];

            while (stack.length > 0) {
                const current = stack[stack.length - 1];
                const neighbors = [];

                // Chercher voisins non visités
                directions.forEach(dir => {
                    const nx = current.x + dir.dx;
                    const ny = current.y + dir.dy;

                    if (nx > 0 && nx < mazeSize - 1 && ny > 0 && ny < mazeSize - 1 && mazeGrid[ny][nx] === 1) {
                        neighbors.push({ x: nx, y: ny, dx: dir.dx, dy: dir.dy });
                    }
                });

                if (neighbors.length > 0) {
                    // Choisir voisin aléatoire
                    const next = neighbors[Math.floor(Math.random() * neighbors.length)];

                    // Creuser chemin
                    mazeGrid[next.y][next.x] = 0;
                    mazeGrid[current.y + next.dy / 2][current.x + next.dx / 2] = 0;

                    stack.push({ x: next.x, y: next.y });
                } else {
                    stack.pop();
                }
            }
        }

        function generateTraps() {
            mazeTraps = [];

            // Trouver le chemin optimal avec BFS
            const optimalPath = findPath(mazePlayer.x, mazePlayer.y, mazeExit.x, mazeExit.y);

            if (!optimalPath) {
                console.error("Pas de chemin trouvé !");
                return;
            }

            // Créer un Set des positions du chemin optimal pour accès rapide
            const pathSet = new Set(optimalPath.map(p => `${p.x},${p.y}`));

            // Calculer combien de pièges on peut mettre sur le chemin (max 2 pour rester jouable avec 3 vies)
            const maxTrapsOnPath = 2;
            let trapsOnPath = 0;

            // Placer 10-15 pièges au total
            let trapCount = 10 + Math.floor(Math.random() * 6);

            for (let i = 0; i < trapCount; i++) {
                let x, y;
                let isOnPath = false;
                let attempts = 0;

                do {
                    x = Math.floor(Math.random() * mazeSize);
                    y = Math.floor(Math.random() * mazeSize);
                    isOnPath = pathSet.has(`${x},${y}`);
                    attempts++;

                    // Si on a essayé trop de fois, forcer un placement hors chemin
                    if (attempts > 100) break;

                } while (
                    mazeGrid[y][x] === 1 || // Mur
                    (x === 1 && y === 1) || // Départ
                    (x === mazeExit.x && y === mazeExit.y) || // Sortie
                    mazeTraps.some(t => t.x === x && t.y === y) || // Déjà un piège
                    (isOnPath && trapsOnPath >= maxTrapsOnPath) // Trop de pièges sur le chemin
                );

                if (attempts > 100) continue; // Skip si impossible

                if (isOnPath) {
                    trapsOnPath++;
                }

                mazeTraps.push({
                    x, y,
                    triggered: false,
                    type: Math.random() > 0.5 ? 'spike' : 'hole'
                });
            }
        }

        // BFS pour trouver le chemin optimal
        function findPath(startX, startY, endX, endY) {
            const queue = [{ x: startX, y: startY, path: [{ x: startX, y: startY }] }];
            const visited = new Set([`${startX},${startY}`]);

            const directions = [
                { dx: 0, dy: -1 }, // Haut
                { dx: 0, dy: 1 },  // Bas
                { dx: -1, dy: 0 }, // Gauche
                { dx: 1, dy: 0 }   // Droite
            ];

            while (queue.length > 0) {
                const current = queue.shift();

                // Arrivée !
                if (current.x === endX && current.y === endY) {
                    return current.path;
                }

                // Explorer voisins
                for (const dir of directions) {
                    const newX = current.x + dir.dx;
                    const newY = current.y + dir.dy;
                    const key = `${newX},${newY}`;

                    // Vérifier validité
                    if (newX >= 0 && newX < mazeSize &&
                        newY >= 0 && newY < mazeSize &&
                        mazeGrid[newY][newX] === 0 &&
                        !visited.has(key)) {

                        visited.add(key);
                        queue.push({
                            x: newX,
                            y: newY,
                            path: [...current.path, { x: newX, y: newY }]
                        });
                    }
                }
            }

            return null; // Pas de chemin trouvé
        }

        function drawMaze() {
            if (!mazeActive) return;

            // Fond noir
            mazeCtx.fillStyle = '#000';
            mazeCtx.fillRect(0, 0, mazeCanvas.width, mazeCanvas.height);

            // Ne dessiner que ce qui est visible dans le rayon de la lampe
            const visionRadius = 2.5; // Cellules visibles autour du joueur

            for (let y = 0; y < mazeSize; y++) {
                for (let x = 0; x < mazeSize; x++) {
                    const distance = Math.sqrt(
                        Math.pow(x - mazePlayer.x, 2) +
                        Math.pow(y - mazePlayer.y, 2)
                    );

                    if (distance <= visionRadius) {
                        const opacity = Math.max(0, 1 - distance / visionRadius);

                        // Dessiner cellule
                        if (mazeGrid[y][x] === 1) {
                            // Mur
                            mazeCtx.fillStyle = `rgba(139, 69, 19, ${opacity})`;
                        } else {
                            // Chemin
                            mazeCtx.fillStyle = `rgba(40, 40, 40, ${opacity})`;
                        }

                        mazeCtx.fillRect(
                            x * mazeCellSize,
                            y * mazeCellSize,
                            mazeCellSize - 1,
                            mazeCellSize - 1
                        );

                        // Dessiner pièges déclenchés
                        const trap = mazeTraps.find(t => t.x === x && t.y === y && t.triggered);
                        if (trap) {
                            mazeCtx.fillStyle = `rgba(139, 0, 0, ${opacity})`;
                            mazeCtx.font = '20px Arial';
                            mazeCtx.fillText(
                                trap.type === 'spike' ? '🗡️' : '🕳️',
                                x * mazeCellSize + 6,
                                y * mazeCellSize + 24
                            );
                        }
                    }
                }
            }

            // Dessiner sortie si visible
            const exitDistance = Math.sqrt(
                Math.pow(mazeExit.x - mazePlayer.x, 2) +
                Math.pow(mazeExit.y - mazePlayer.y, 2)
            );

            if (exitDistance <= visionRadius) {
                const opacity = Math.max(0, 1 - exitDistance / visionRadius);
                mazeCtx.fillStyle = `rgba(0, 255, 0, ${opacity * 0.5})`;
                mazeCtx.fillRect(
                    mazeExit.x * mazeCellSize,
                    mazeExit.y * mazeCellSize,
                    mazeCellSize - 1,
                    mazeCellSize - 1
                );

                mazeCtx.font = '24px Arial';
                mazeCtx.fillStyle = `rgba(0, 255, 0, ${opacity})`;
                mazeCtx.fillText('🚪', mazeExit.x * mazeCellSize + 4, mazeExit.y * mazeCellSize + 25);
            }

            // Dessiner joueur
            mazeCtx.font = '28px Arial';
            mazeCtx.fillStyle = '#FFD700';
            mazeCtx.fillText('🔦', mazePlayer.x * mazeCellSize + 2, mazePlayer.y * mazeCellSize + 26);

            // Positionner la lampe torche (responsive et centrée)
            const flashlight = document.getElementById('mazeFlashlight');
            const containerRect = mazeCanvas.getBoundingClientRect();
            const flashlightSize = containerRect.width * 0.3; // 30% de la largeur

            // Calculer la position relative du joueur sur le canvas affiché
            const playerScreenX = (mazePlayer.x * mazeCellSize / 500) * containerRect.width;
            const playerScreenY = (mazePlayer.y * mazeCellSize / 500) * containerRect.height;

            // Centrer la lampe sur le joueur
            flashlight.style.left = (playerScreenX - flashlightSize / 2) + 'px';
            flashlight.style.top = (playerScreenY - flashlightSize / 2) + 'px';

            // Calculer progression
            const totalDistance = Math.sqrt(
                Math.pow(mazeExit.x - 1, 2) +
                Math.pow(mazeExit.y - 1, 2)
            );
            const currentDistance = Math.sqrt(
                Math.pow(mazeExit.x - mazePlayer.x, 2) +
                Math.pow(mazeExit.y - mazePlayer.y, 2)
            );
            const progress = Math.max(0, Math.min(100, Math.floor((1 - currentDistance / totalDistance) * 100)));
            document.getElementById('mazeProgress').textContent = progress + '%';

            requestAnimationFrame(drawMaze);
        }

        // Fonction pour les boutons tactiles
        function moveMazePlayerButton(direction) {
            if (!mazeActive || mazeCompleted) return;

            let dx = 0, dy = 0;

            switch (direction) {
                case 'up':
                    dy = -1;
                    break;
                case 'down':
                    dy = 1;
                    break;
                case 'left':
                    dx = -1;
                    break;
                case 'right':
                    dx = 1;
                    break;
            }

            // Appeler la fonction de mouvement existante
            moveMazePlayer(dx, dy);

            // Animation du bouton
            const buttonIds = {
                'up': 'mazeBtnUp',
                'down': 'mazeBtnDown',
                'left': 'mazeBtnLeft',
                'right': 'mazeBtnRight'
            };

            const btn = document.getElementById(buttonIds[direction]);
            if (btn) {
                btn.classList.add('pressed');
                setTimeout(() => btn.classList.remove('pressed'), 200);
            }
        }

        function moveMazePlayer(dx, dy) {
            if (!mazeActive || mazeCompleted) return;

            const newX = mazePlayer.x + dx;
            const newY = mazePlayer.y + dy;

            // Vérifier limites et murs
            if (newX < 0 || newX >= mazeSize || newY < 0 || newY >= mazeSize) return;
            if (mazeGrid[newY][newX] === 1) {
                // Collision avec mur
                document.getElementById('mazeHint').textContent = '🧱 Vous heurtez un mur !';
                document.getElementById('mazeHint').style.color = '#ff6600';
                return;
            }

            // Déplacer
            mazePlayer.x = newX;
            mazePlayer.y = newY;

            // Vérifier piège
            const trap = mazeTraps.find(t => t.x === newX && t.y === newY && !t.triggered);
            if (trap) {
                trap.triggered = true;
                mazeHP--;
                document.getElementById('mazeHP').textContent = '❤️'.repeat(Math.max(0, mazeHP)) + '🖤'.repeat(3 - mazeHP);

                const trapEmoji = trap.type === 'spike' ? '🗡️' : '🕳️';
                const trapName = trap.type === 'spike' ? 'Piques' : 'Fosse';

                document.getElementById('mazeHint').textContent = `${trapEmoji} ${trapName} ! -1 vie`;
                document.getElementById('mazeHint').style.color = '#f00';

                // Flash rouge
                mazeCanvas.style.background = 'rgba(255, 0, 0, 0.3)';
                setTimeout(() => {
                    mazeCanvas.style.background = '#000';
                }, 200);

                if (mazeHP <= 0) {
                    loseMaze();
                    return;
                }
            }

            // Vérifier sortie
            if (mazePlayer.x === mazeExit.x && mazePlayer.y === mazeExit.y) {
                winMaze();
            }
        }

        function winMaze() {
            mazeActive = false;
            mazeCompleted = true;
            clearInterval(mazeTimerInterval);

            const time = Math.floor((Date.now() - mazeStartTime) / 1000);
            const trapsHit = 3 - mazeHP;

            // Désactiver les boutons
            const mazeButtons = ['mazeBtnUp', 'mazeBtnDown', 'mazeBtnLeft', 'mazeBtnRight'];
            mazeButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) btn.disabled = true;
            });

            document.getElementById('mazeMessage').innerHTML = `
                    <div style="color: #0f0; font-size: 18px;">
                        🎉 SORTIE TROUVÉE !<br>
                        <span style="font-size: 14px;">Temps: ${time}s | Pièges: ${trapsHit}/3 | Vies: ${mazeHP}❤️</span>
                    </div>
                `;

            document.getElementById('mazeHint').textContent = '🚪 Vous avez échappé au labyrinthe !';
            document.getElementById('mazeHint').style.color = '#0f0';
            
            // INTEGRATION AVEC LES MECANIQUES EXISTANTES
            document.getElementById('mazeModule').style.borderColor = '#0f0';
            document.getElementById('memoryModule').classList.remove('locked');
            showNotification('✓ Labyrinthe terminé - Memory débloqué !', '#0f0');
        }

        function loseMaze() {
            mazeActive = false;
            mazeCompleted = false;
            clearInterval(mazeTimerInterval);

            // Désactiver les boutons
            const mazeButtons = ['mazeBtnUp', 'mazeBtnDown', 'mazeBtnLeft', 'mazeBtnRight'];
            mazeButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) btn.disabled = true;
            });

            document.getElementById('mazeMessage').innerHTML = `
                    <div style="color: #f00; font-size: 18px;">
                        💀 VOUS ÊTES PERDU...<br>
                        <span style="font-size: 14px;">Vous avez succombé aux pièges du labyrinthe</span>
                    </div>
                `;

            document.getElementById('mazeHint').textContent = '☠️ Trop de blessures... Réessayez !';
            document.getElementById('mazeHint').style.color = '#f00';
        }


        // MODIFICATION : Utiliser le système de gestion d'événement existant pour le labyrinthe
        // Ajouter cette fonction qui sera appelée quand le module est débloqué
        function initMaze() {
            // Cette fonction est appelée quand le puzzle est complété
            // On ne démarre pas automatiquement, le joueur doit cliquer sur "NOUVELLE PARTIE"
            mazeCompleted = false;
        }
        
        // Contrôles clavier du labyrinthe
        document.addEventListener('keydown', (e) => {
            if (!mazeActive || mazeCompleted) return;

            switch (e.key) {
                case 'ArrowUp':
                case 'z':
                case 'Z':
                    e.preventDefault();
                    moveMazePlayer(0, -1);
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    e.preventDefault();
                    moveMazePlayer(0, 1);
                    break;
                case 'ArrowLeft':
                case 'q':
                case 'Q':
                    e.preventDefault();
                    moveMazePlayer(-1, 0);
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    e.preventDefault();
                    moveMazePlayer(1, 0);
                    break;
            }
        });


        function closeFinalScreen() {
            document.getElementById('finalScreen').classList.remove('active');
            // Scroll vers les dossiers
            document.getElementById('filesModule').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function checkCode() {
            const input = document.getElementById('codeInput').value;
            const result = document.getElementById('codeResult');

            if (input === '124') {
                result.innerHTML = '<p style="color: #0f0; margin-top: 10px;">✓ CODE CORRECT !</p>';

                setTimeout(() => {
                    document.getElementById('codeModule').style.borderColor = '#0f0';
                    document.getElementById('simonModule').classList.remove('locked');
                    showNotification('✓ Code validé - Simon Says débloqué !', '#0f0');
                }, 1000);
            } else {
                result.innerHTML = '<p style="color: #f00; margin-top: 10px;">✗ INCORRECT</p>';
                triggerJumpscare();
                setTimeout(() => result.innerHTML = '', 2000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const codeInput = document.getElementById('codeInput');
            if (codeInput) {
                codeInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') checkCode();
                });
            }
        });

        function showNotification(message, color) {
            const notif = document.createElement('div');
            notif.style.cssText = 'position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.9); border: 2px solid ' + color + '; color: ' + color + '; padding: 20px; border-radius: 5px; z-index: 10000; font-family: Courier New, monospace; box-shadow: 0 0 30px ' + color + '; animation: slideIn 0.5s;';
            notif.textContent = message;
            document.body.appendChild(notif);

            setTimeout(() => {
                notif.style.animation = 'slideOut 0.5s';
                setTimeout(() => notif.remove(), 500);
            }, 3000);
        }

        function openFile(type) {
            const modal = document.getElementById('imageModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');

            // CAS SPÉCIAL : SPECIMEN 001
            if (type === 'specimen') {
                // Vérifier si le scan a été effectué
                const orangeCarScanned = localStorage.getItem('orangeCarScanned') === 'true';

                if (orangeCarScanned) {
                    // Si le scan est fait, ouvrir normalement avec l'image
                    title.textContent = '🧪 DOSSIER SPECIMEN 001';
                    content.innerHTML = '<p style="color: #0f0;">Classification: TOP SECRET</p><img src="SPECIMEN001.png" alt="Specimen"><p style="color: #ff6600; margin-top: 15px;">Sujet: Citrouille génétiquement modifiée</p><p style="color: #f00;">Statut: CONFINEMENT ROMPU</p>';
                    modal.style.display = 'flex';
                    window.filesOpened.add(type);

                    // Vérifier si tous les fichiers sont ouverts
                    if (window.filesOpened.size === 4) {
                        setTimeout(() => {
                            document.getElementById('step4').classList.remove('active');
                            document.getElementById('step4').classList.add('completed');
                            showNotification('🎉 MISSION COMPLÉTÉE !', '#ff6600');
                            triggerJumpscare();
                        }, 1000);
                    }
                    return;
                }

                // Sinon, afficher la popup de scan
                const otherFilesViewed = window.filesOpened.has('secret') &&
                    window.filesOpened.has('lab') &&
                    window.filesOpened.has('warning');

                title.textContent = '🧪 DOSSIER SPECIMEN 001 - ACCÈS RESTREINT';

                let scanButtonHtml = '';
                let scanButtonDisabled = '';
                let buttonStyle = 'background: #0f0; color: #000;';
                let statusMessage = '';

                if (!otherFilesViewed) {
                    scanButtonDisabled = 'disabled';
                    buttonStyle = 'background: #666; color: #333; cursor: not-allowed;';
                    statusMessage = '<p style="color: #f00; font-weight: bold; margin-bottom: 20px;">⚠️ PROTOCOLE DE SÉCURITÉ ACTIVÉ</p><p style="color: #ff6600; margin-bottom: 20px;">Vous devez consulter les 3 autres documents pour découvrir l\'emplacement de <span style="color: #0f0;">l\'outil d\'accès</span> nécessaire.</p>';
                } else {
                    statusMessage = '<p style="color: #0f0; font-weight: bold; margin-bottom: 20px;">✅ DOCUMENTS ANALYSÉS</p><p style="color: #ff6600; margin-bottom: 20px;">Les indices sont en votre possession. Vous pouvez maintenant procéder à la localisation du SPECIMEN 001.</p>';
                }

                content.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 64px; margin-bottom: 20px;">🧪</div>
                            <p style="color: #f00; font-size: 14px; letter-spacing: 3px; margin-bottom: 20px;">CLASSIFICATION: TOP SECRET</p>

                            ${statusMessage}

                            <div style="background: rgba(255, 102, 0, 0.1); border: 2px solid #ff6600; border-radius: 10px; padding: 20px; margin: 20px 0;">
                                <h3 style="color: #ff6600; margin-bottom: 15px;">BRIEFING MISSION</h3>
                                <p style="color: #0f0; text-align: left; line-height: 1.6;">
                                    Le SPECIMEN 001 est la fameuse création du Dr. Halloween issue du Projet Citrouille.
                                    <br><br>
                                    <span style="color: #ff6600;">⚠️ PROTOCOLE D'ACCÈS EN 3 PHASES :</span>
                                    <br><br>
                                    <span style="color: #667eea;">PHASE 1 :</span> Utilisez les 3 documents pour localiser et déverrouiller <span style="color: #0f0;">l'outil d'accès</span> caché sur le terrain.
                                    <br>
                                    <span style="color: #667eea;">PHASE 2 :</span> Identifiez le SPECIMEN 001 grâce au scanner de terrain.
                                    <br>
                                    <span style="color: #667eea;">PHASE 3 :</span> L'outil d'accès ne fonctionnera qu'après identification du spécimen.
                                </p>
                            </div>

                            <button
                                onclick="launchSpecimenScan()"
                                ${scanButtonDisabled}
                                style="width: 100%; padding: 20px; font-size: 18px; font-weight: bold; border: none; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; ${buttonStyle} margin-top: 20px;">
                                📡 LANCER LE SCAN DU TERRAIN
                            </button>

                            ${!otherFilesViewed ? '<p style="color: #666; font-size: 12px; margin-top: 15px;">Documents restants à consulter : ' + (3 - window.filesOpened.size) + '/3</p>' : ''}
                        </div>
                    `;

                modal.style.display = 'flex';
                return;
            }

            // AUTRES FICHIERS (comportement normal)
            const files = {
                lab: {
                    title: '🔐 COFFRE D\' ACCES AU PROJET CITROUILLE - DERNIÈRES PHOTOS',
                    content: '<p style="color: #0f0;">Horodatage: 31/10/2025 23:42</p><img src="BOITECLEF.png" alt="Lab"><p style="color: #f00; margin-top: 15px;">⚠️ Aucun personnel détecté aux environs.</p>'
                },
                warning: {
                    title: '⚠️ AVERTISSEMENT FINAL ⚠️🔦',
                    content: '<div style="background: rgba(255,0,0,0.2); padding: 20px; border: 2px solid #f00;"><p style="color: #f00; font-size: 20px; font-weight: bold;">ÉQUIPEZ-VOUS IMMÉDIATEMENT</p><img src="UVLight.png" alt="Warning"><p style="color: #ff6600; margin-top: 15px;">Les citrouilles ont pris le contrôle.</p><p style="color: #f00;">NE VOUS DEPLACEZ PAS SANS LUMIERE POUR VOUS DEFENDRE ! </p></div>'
                },
                secret: {
                    title: '🎃 PROJET CITROUILLE - PLANS',
                    content: '<p style="color: #0f0;">Document confidentiel - Dr. Halloween</p><img src="PROJETCITROUILLE.png" alt="Plans"><p style="color: #ff6600; margin-top: 15px;">Phase 1: Création ✓</p><p style="color: #ff6600;">Phase 2: Évolution ✓</p><p style="color: #f00;">Phase 3: LIBÉRATION ✓</p><p style="color: #0f0; margin-top: 15px;">Code d\'arrêt: <span style="color: #ff6600;">HALLOWEEN-666</span></p>'
                }
            };

            title.textContent = files[type].title;
            content.innerHTML = files[type].content;
            modal.style.display = 'flex';

            window.filesOpened.add(type);

            if (window.filesOpened.size === 4) {
                setTimeout(() => {
                    document.getElementById('step4').classList.remove('active');
                    document.getElementById('step4').classList.add('completed');
                    showNotification('🎉 MISSION COMPLÉTÉE !', '#ff6600');
                    triggerJumpscare();
                }, 1000);
            }
        }

        // Fonction pour lancer le scan du SPECIMEN 001
        function launchSpecimenScan() {
            // Ouvrir la page de scan dans un nouvel onglet
            window.open('Specimen-001.html', '_blank');
            closeModal();
            showNotification('📡 Scanner de terrain activé - Nouvelle fenêtre ouverte', '#0f0');
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        document.getElementById('imageModal').addEventListener('click', (e) => {
            if (e.target.id === 'imageModal') closeModal();
        });
        // ============================================
        // SYSTÈME D'ADMINISTRATION
        // ============================================

        const ADMIN_PASSWORD = "MECANICIEN"; // Changez ce mot de passe !
        let isAdminAuthenticated = false;

        // Toggle panneau admin
        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                // Réinitialiser l'authentification à chaque ouverture
                isAdminAuthenticated = false;
                document.getElementById('adminAuth').style.display = 'block';
                document.getElementById('adminControls').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminAuthError').textContent = '';

                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        // Vérification mot de passe admin
        function checkAdminPassword() {
            const input = document.getElementById('adminPassword').value;
            const error = document.getElementById('adminAuthError');

            if (input === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                document.getElementById('adminAuth').style.display = 'none';
                document.getElementById('adminControls').style.display = 'block';
                updateGameStatus();
            } else {
                error.textContent = '❌ Code incorrect';
                document.getElementById('adminPassword').value = '';
                setTimeout(() => error.textContent = '', 2000);
            }
        }

        // Mise à jour de l'état du jeu
        function updateGameStatus() {
            const status = document.getElementById('gameStatus');
            if (!status) return;

            const steps = [
                { id: 'step1', name: 'Cadenas Audio' },
                { id: 'step2', name: 'Quiz + Pendu' },
                { id: 'step3', name: 'Mini-jeux' },
                { id: 'step4', name: 'Dossiers Finaux' }
            ];

            let html = '';
            steps.forEach(step => {
                const elem = document.getElementById(step.id);
                let state = '⚪ Verrouillé';
                let color = '#666';

                if (elem.classList.contains('completed')) {
                    state = '✅ Complété';
                    color = '#0f0';
                } else if (elem.classList.contains('active')) {
                    state = '🔵 En cours';
                    color = '#667eea';
                }

                html += `<div style="color: ${color};">${state} - ${step.name}</div>`;
            });

            status.innerHTML = html;
        }



        // Réinitialiser tout le jeu
        function adminResetGame() {
            // Confirmation retirée pour compatibilité sandbox

            // Reset des étapes
            ['step1', 'step2', 'step3', 'step4'].forEach(id => {
                const elem = document.getElementById(id);
                elem.classList.remove('active', 'completed');
                elem.classList.add('locked');
            });

            // Réactiver étape 1
            document.getElementById('step1').classList.remove('locked');
            document.getElementById('step1').classList.add('active');

            // Verrouiller tous les modules
            ['quizModule', 'hangmanModule', 'codeModule', 'simonModule', 'puzzleModule', 'mazeModule', 'memoryModule', 'filesModule'].forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.classList.add('locked');
                    elem.style.borderColor = ''; // Réinitialiser la couleur de bordure
                }
            });

            // Reset des variables
            wheelValues = [0, 0, 0, 0];
            quizAnswered = false;
            enigmaAnswered = false;
            window.filesOpened = new Set();
            window.errorCount = 0;
            simonSequence = [];
            simonRound = 0;
            puzzleSolved = false;
            memorySolved = false;
            mazeCompleted = false;
            mazeActive = false;

            // Reset du Puzzle
            if (document.getElementById('puzzleContainer')) {
                document.getElementById('puzzleContainer').innerHTML = '';
            }
            if (document.getElementById('puzzleResult')) {
                document.getElementById('puzzleResult').innerHTML = '';
            }

            // Reset du Labyrinthe
            clearInterval(mazeTimerInterval);
            if (document.getElementById('mazeHP')) {
                document.getElementById('mazeHP').textContent = '❤️❤️❤️';
            }
            if (document.getElementById('mazeProgress')) {
                document.getElementById('mazeProgress').textContent = '0%';
            }
            if (document.getElementById('mazeTime')) {
                document.getElementById('mazeTime').textContent = '0s';
            }
            if (document.getElementById('mazeMessage')) {
                document.getElementById('mazeMessage').innerHTML = '';
            }
            if (document.getElementById('mazeHint')) {
                document.getElementById('mazeHint').textContent = 'Utilisez les flèches du clavier ou les boutons ci-dessous';
                document.getElementById('mazeHint').style.color = '#0f0';
            }
            // Désactiver les boutons du labyrinthe
            ['mazeBtnUp', 'mazeBtnDown', 'mazeBtnLeft', 'mazeBtnRight'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) btn.disabled = true;
            });
            // Nettoyer le canvas
            const mazeCanvas = document.getElementById('mazeCanvas');
            if (mazeCanvas) {
                const mazeCtx = mazeCanvas.getContext('2d');
                mazeCtx.clearRect(0, 0, mazeCanvas.width, mazeCanvas.height);
                mazeCtx.fillStyle = '#000';
                mazeCtx.fillRect(0, 0, mazeCanvas.width, mazeCanvas.height);
            }

            // Reset du Pendu
            hangmanWins = 0;
            if (document.getElementById('hangmanProgress')) {
                document.getElementById('hangmanProgress').textContent = '0/6';
            }
            if (document.getElementById('hangmanMessage')) {
                document.getElementById('hangmanMessage').innerHTML = '';
            }

            // Reset des affichages
            document.querySelectorAll('.wheel-numbers').forEach((wheel, index) => {
                updateWheelDisplay(index);
            });

            document.getElementById('lockResult').innerHTML = '';
            document.getElementById('codeInput').value = '';

            // Reset des énigmes
            document.getElementById('quizResult').innerHTML = '';
            document.getElementById('enigmaResult').innerHTML = '';
            document.getElementById('quizProgress').textContent = '0/2 ✓';
            document.querySelectorAll('.quiz1-btn, .quiz2-btn').forEach(btn => btn.disabled = false);

            // Reset du Memory
            if (document.getElementById('memoryGrid')) {
                document.getElementById('memoryGrid').innerHTML = '';
            }
            if (document.getElementById('memoryMoves')) {
                document.getElementById('memoryMoves').textContent = '0';
            }
            if (document.getElementById('memoryPairs')) {
                document.getElementById('memoryPairs').textContent = '0/8';
            }
            if (document.getElementById('memoryLives')) {
                document.getElementById('memoryLives').textContent = '❤️❤️❤️❤️❤️❤️❤️❤️❤️';
            }
            if (document.getElementById('memoryTime')) {
                document.getElementById('memoryTime').textContent = '0s';
            }
            if (document.getElementById('memoryResult')) {
                document.getElementById('memoryResult').innerHTML = '';
            }

            // Reset du Simon
            if (document.getElementById('simonResult')) {
                document.getElementById('simonResult').innerHTML = '';
            }
            if (document.getElementById('simonStartBtn')) {
                document.getElementById('simonStartBtn').textContent = 'DÉMARRER NIVEAU 1';
            }

            // Fermer l'écran final si ouvert
            document.getElementById('finalScreen').classList.remove('active');

            // Fermer le crash screen si ouvert
            const crashScreen = document.getElementById('crashScreen');
            if (crashScreen) {
                crashScreen.classList.remove('active');
                crashScreen.style.opacity = '1';
                crashScreen.style.transition = '';
            }

            console.log('✅ Jeu réinitialisé !'); showNotification('✅ Jeu réinitialisé !', '#0f0');
            updateGameStatus();
        }

        // Débloquer toutes les étapes
        function adminUnlockAll() {
            // Confirmation retirée pour compatibilité sandbox

            ['step1', 'step2', 'step3', 'step4'].forEach(id => {
                const elem = document.getElementById(id);
                elem.classList.remove('locked', 'active');
                elem.classList.add('completed');
            });

            ['quizModule', 'hangmanModule', 'codeModule', 'simonModule', 'puzzleModule', 'mazeModule', 'memoryModule', 'filesModule'].forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.classList.remove('locked');
                    elem.style.borderColor = '#0f0';
                }
            });

            // Compléter les énigmes pour débloquer le Pendu
            quizAnswered = true;
            enigmaAnswered = true;
            updateQuizProgress();

            // NOTE: Le Pendu est débloqué mais PAS complété - le joueur doit jouer
            // hangmanWins reste à 0 pour permettre au joueur de faire le jeu

            console.log('✅ Toutes les étapes débloquées !'); showNotification('✅ Toutes les étapes débloquées !', '#0f0');
            stopDrMessageSystem(); // Arrêter les messages Dr Halloween quand on débloque via admin
            updateGameStatus();
        }

        // Aller directement aux dossiers finaux
        function adminSkipToFiles() {
            adminUnlockAll();
            document.getElementById('finalScreen').classList.add('active');

            setTimeout(() => {
                document.getElementById('filesModule').scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }, 500);
        }
        // Débloquer une étape spécifique
        function adminUnlockStep(stepName) {
            const modules = {
                'quiz': { module: 'quizModule', step: 'step2', prev: 'step1' },
                'hangman': { module: 'hangmanModule', step: 'step2', prev: 'step1' },
                'code': { module: 'codeModule', step: 'step3', prev: 'step2' },
                'simon': { module: 'simonModule', step: 'step3', prev: 'step2' },
                'puzzle': { module: 'puzzleModule', step: 'step3', prev: 'step2' },
                'maze': { module: 'mazeModule', step: 'step3', prev: 'step2' },
                'memory': { module: 'memoryModule', step: 'step3', prev: 'step2' },
                'files': { module: 'filesModule', step: 'step4', prev: 'step3' }
            };

            const config = modules[stepName];
            if (!config) return;

            // Débloquer le module
            const moduleElem = document.getElementById(config.module);
            if (moduleElem) {
                moduleElem.classList.remove('locked');
                moduleElem.style.borderColor = '#ff6600';

                // Scroller vers le module
                moduleElem.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // Mettre à jour les étapes de progression
            const stepElem = document.getElementById(config.step);
            if (stepElem) {
                stepElem.classList.remove('locked');
                stepElem.classList.add('active');
            }

            // Compléter l'étape précédente
            const prevElem = document.getElementById(config.prev);
            if (prevElem && !prevElem.classList.contains('completed')) {
                prevElem.classList.remove('active');
                prevElem.classList.add('completed');
            }

            // Initialiser les jeux si nécessaire
            if (stepName === 'puzzle' && !puzzleSolved) {
                initPuzzle();
            }
            if (stepName === 'maze') {
                initMaze();
            }

            // Arrêter les messages Dr Halloween si on débloque les dossiers finaux
            if (stepName === 'files') {
                stopDrMessageSystem();
            }

            console.log('✅ Module débloqué !'); showNotification('✅ Module débloqué !', '#0f0');
            updateGameStatus();
            closeAdminPanel();
        }


        function adminToggleHangmanDifficulty() {
            if (hangmanDifficulty === 'hard') {
                hangmanDifficulty = 'easy';
                document.getElementById('hangmanDifficultyBtn').textContent = '🔄 Mode: FACILE → DIFFICILE';
                document.getElementById('hangmanDifficultyBtn').style.background = '#0f0';
                document.getElementById('hangmanModeDisplay').textContent = 'FACILE';
                document.getElementById('hangmanModeDisplay').style.color = '#0f0';
                console.log('✅ Mode FACILE activé !'); showNotification('✅ Mode FACILE activé !', '#0f0');
            } else {
                hangmanDifficulty = 'hard';
                document.getElementById('hangmanDifficultyBtn').textContent = '🔄 Mode: DIFFICILE → FACILE';
                document.getElementById('hangmanDifficultyBtn').style.background = '#ff6600';
                document.getElementById('hangmanModeDisplay').textContent = 'DIFFICILE';
                document.getElementById('hangmanModeDisplay').style.color = '#667eea';
                console.log('✅ Mode DIFFICILE activé !'); showNotification('✅ Mode DIFFICILE activé !', '#667eea');
            }

            // Réinitialiser les mots utilisés
            usedHangmanWords = [];

            // Si une partie est en cours, la redémarrer avec la nouvelle difficulté
            if (hangmanActive || document.getElementById('hangmanStartBtn').style.display !== 'none') {
                startHangmanGame();
            }

            closeAdminPanel();
        }

        // Raccourci clavier admin (Ctrl + Shift + A)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                toggleAdminPanel();
            }
        });

        // Clic sur le fond pour fermer
        document.getElementById('adminPanel').addEventListener('click', (e) => {
            if (e.target.id === 'adminPanel') {
                closeAdminPanel();
            }
        });

    </script>
    <div class="final-screen" id="finalScreen">
        <div class="final-box">
            <h1>✓ TESTS COMPLÉTÉS AVEC SUCCÈS ✓</h1>

            <div class="intro-message">
                <p style="margin-bottom: 20px;">
                    "Impressionnant. Vous auriez fait un excellent assistant.
                    Vos compétences sont... remarquables.
                </p>

                <p style="margin-bottom: 20px; color: #ff6600;">
                    Malheureusement, il est trop tard maintenant.
                    Mes autres assistants n'ont pas eu votre chance...
                </p>

                <p style="margin-bottom: 20px;">
                    Les documents sont déverrouillés.
                    Vous y trouverez ce que vous cherchez.
                </p>

                <p style="margin-bottom: 20px; color: #ff6600; font-weight: bold;">
                    Découvrez la <span class="glitch">VÉRITÉ</span>.
                    Découvrez, Trouvez et Domptez ma <span class="glitch">CRÉATION</span>.
                </p>
            </div>

            <div class="warning-box" style="border-color: #0f0; color: #0f0; background: rgba(0, 255, 0, 0.2);">
                ✓ ACCÈS DOSSIER ACCORDÉ ✓
            </div>

            <button onclick="closeFinalScreen()" style="background: #0f0; font-size: 18px; padding: 15px;">
                ACCÉDER AUX DOCUMENTS FINAUX
            </button>
        </div>
    </div>

    <!-- Faux Crash Screen -->
    <div class="crash-screen" id="crashScreen">
        <div class="crash-static"></div>
        <div class="crash-text crash-glitch" id="crashText1" style="animation-delay: 0s;"></div>
        <div class="crash-text" id="crashText2" style="animation-delay: 0.2s;"></div>
        <div class="crash-text" id="crashText3" style="animation-delay: 0.4s;"></div>
        <div class="crash-error" id="crashError">
            ERROR 0x8B000666 - UNAUTHORIZED_ACCESS<br>
            System memory compromised...<br>
            Terminating connection...
        </div>
    </div>
</body>
</html>